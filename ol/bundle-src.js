!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=10)}({0:function(t,e,i){"use strict";t.exports=s,t.exports.default=s;var n=i(9);function s(t,e){if(!(this instanceof s))return new s(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function r(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1}function o(t,e){a(t,0,t.children.length,e,t)}function a(t,e,i,n,s){s||(s=p(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var r,o=e;o<i;o++)r=t.children[o],h(s,t.leaf?n(r):r);return s}function h(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function c(t,e){return t.minY-e.minY}function u(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function d(t){return t.maxX-t.minX+(t.maxY-t.minY)}function g(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function _(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,e,i,s,r){for(var o,a=[e,i];a.length;)(i=a.pop())-(e=a.pop())<=s||(o=e+Math.ceil((i-e)/s/2)*s,n(t,o,e,i,r),a.push(e,o,o,i))}s.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!_(t,e))return i;for(var s,r,o,a,h=[];e;){for(s=0,r=e.children.length;s<r;s++)o=e.children[s],_(t,a=e.leaf?n(o):o)&&(e.leaf?i.push(o):g(t,a)?this._all(o,i):h.push(o));e=h.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!_(t,e))return!1;for(var n,s,r,o,a=[];e;){for(n=0,s=e.children.length;n<s;n++)if(r=e.children[n],_(t,o=e.leaf?i(r):r)){if(e.leaf||g(t,o))return!0;a.push(r)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var s=this.data;this.data=n,n=s}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=p([]),this},remove:function(t,e){if(!t)return this;for(var i,n,s,o,a=this.data,h=this.toBBox(t),l=[],c=[];a||l.length;){if(a||(a=l.pop(),n=l[l.length-1],i=c.pop(),o=!0),a.leaf&&-1!==(s=r(t,a.children,e)))return a.children.splice(s,1),l.push(a),this._condense(l),this;o||a.leaf||!g(a,h)?n?(i++,a=n.children[i],o=!1):a=null:(l.push(a),c.push(i),i=0,n=a,a=a.children[0])}return this},toBBox:function(t){return t},compareMinX:l,compareMinY:c,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},_build:function(t,e,i,n){var s,r=i-e+1,a=this._maxEntries;if(r<=a)return o(s=p(t.slice(e,i+1)),this.toBBox),s;n||(n=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,n-1))),(s=p([])).leaf=!1,s.height=n;var h,l,c,u,d=Math.ceil(r/a),g=d*Math.ceil(Math.sqrt(a));for(f(t,e,i,g,this.compareMinX),h=e;h<=i;h+=g)for(f(t,h,c=Math.min(h+g-1,i),d,this.compareMinY),l=h;l<=c;l+=d)u=Math.min(l+d-1,c),s.children.push(this._build(t,l,u,n-1));return o(s,this.toBBox),s},_chooseSubtree:function(t,e,i,n){for(var s,r,o,a,h,l,c,d,g,_;n.push(e),!e.leaf&&n.length-1!==i;){for(c=d=1/0,s=0,r=e.children.length;s<r;s++)h=u(o=e.children[s]),g=t,_=o,(l=(Math.max(_.maxX,g.maxX)-Math.min(_.minX,g.minX))*(Math.max(_.maxY,g.maxY)-Math.min(_.minY,g.minY))-h)<d?(d=l,c=h<c?h:c,a=o):l===d&&h<c&&(c=h,a=o);e=a||e.children[0]}return e},_insert:function(t,e,i){var n=this.toBBox,s=i?t:n(t),r=[],o=this._chooseSubtree(s,this.data,e,r);for(o.children.push(t),h(o,s);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(s,r,e)},_split:function(t,e){var i=t[e],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);var r=this._chooseSplitIndex(i,s,n),a=p(i.children.splice(r,i.children.length-r));a.height=i.height,a.leaf=i.leaf,o(i,this.toBBox),o(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},_splitRoot:function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var n,s,r,o,h,l,c,d,g,_,p,f,m,v;for(l=c=1/0,n=e;n<=i-e;n++)s=a(t,0,n,this.toBBox),r=a(t,n,i,this.toBBox),g=s,_=r,p=void 0,f=void 0,m=void 0,v=void 0,p=Math.max(g.minX,_.minX),f=Math.max(g.minY,_.minY),m=Math.min(g.maxX,_.maxX),v=Math.min(g.maxY,_.maxY),o=Math.max(0,m-p)*Math.max(0,v-f),h=u(s)+u(r),o<l?(l=o,d=n,c=h<c?h:c):o===l&&h<c&&(c=h,d=n);return d},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:l,s=t.leaf?this.compareMinY:c;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,s)&&t.children.sort(n)},_allDistMargin:function(t,e,i,n){t.children.sort(n);var s,r,o=this.toBBox,l=a(t,0,e,o),c=a(t,i-e,i,o),u=d(l)+d(c);for(s=e;s<i-e;s++)r=t.children[s],h(l,t.leaf?o(r):r),u+=d(l);for(s=i-e-1;s>=e;s--)r=t.children[s],h(c,t.leaf?o(r):r),u+=d(c);return u},_adjustParentBBoxes:function(t,e,i){for(var n=i;n>=0;n--)h(e[n],t)},_condense:function(t){for(var e,i=t.length-1;i>=0;i--)0===t[i].children.length?i>0?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():o(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},10:function(t,e,i){"use strict";function n(){return function(){throw new Error("Unimplemented abstract method.")}()}i.r(e);let s=0;function r(t){return t.ol_uid||(t.ol_uid=String(++s))}const o="latest";var a=class extends Error{constructor(t){const e="Assertion failed. See https://openlayers.org/en/"+("latest"===o?o:"v"+o.split("-")[0])+"/doc/errors/#"+t+" for details.";super(e),this.code=t,this.name="AssertionError",this.message=e}},h={ADD:"add",REMOVE:"remove"},l={PROPERTYCHANGE:"propertychange"};const c="function"==typeof Object.assign?Object.assign:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");const i=Object(t);for(let t=1,e=arguments.length;t<e;++t){const e=arguments[t];if(null!=e)for(const t in e)e.hasOwnProperty(t)&&(i[t]=e[t])}return i};function u(t){for(const e in t)delete t[e]}const d="function"==typeof Object.values?Object.values:function(t){const e=[];for(const i in t)e.push(t[i]);return e};function g(t){let e;for(e in t)return!1;return!e}function _(t,e,i,n){let s;for(let r=0,o=t.length;r<o;++r)if((s=t[r]).listener===e&&s.bindTo===i)return n&&(s.deleteIndex=r),s}function p(t,e){const i=f(t);return i?i[e]:void 0}function f(t,e){let i=t.ol_lm;return!i&&e&&(i=t.ol_lm={}),i}function m(t,e){const i=p(t,e);if(i){for(let n=0,s=i.length;n<s;++n)t.removeEventListener(e,i[n].boundListener),u(i[n]);i.length=0;const n=f(t);n&&(delete n[e],0===Object.keys(n).length&&function(t){delete t.ol_lm}(t))}}function v(t,e,i,n,s){const r=f(t,!0);let o=r[e];o||(o=r[e]=[]);let a=_(o,i,n,!1);return a?s||(a.callOnce=!1):(a={bindTo:n,callOnce:!!s,listener:i,target:t,type:e},t.addEventListener(e,function(t){const e=function(e){const i=t.listener,n=t.bindTo||t.target;return t.callOnce&&x(t),i.call(n,e)};return t.boundListener=e,e}(a)),o.push(a)),a}function y(t,e,i,n){return v(t,e,i,n,!0)}function E(t,e,i,n){const s=p(t,e);if(s){const t=_(s,i,n,!0);t&&x(t)}}function x(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);const e=p(t.target,t.type);if(e){const i="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==i&&e.splice(i,1),0===e.length&&m(t.target,t.type)}u(t)}}var T=class{constructor(){this.disposed_=!1}dispose(){this.disposed_||(this.disposed_=!0,this.disposeInternal())}disposeInternal(){}};function C(){return!0}function R(){return!1}function S(){}var I=class{constructor(t){this.propagationStopped,this.type=t,this.target=null}preventDefault(){this.propagationStopped=!0}stopPropagation(){this.propagationStopped=!0}};var w=class extends T{constructor(){super(),this.pendingRemovals_={},this.dispatching_={},this.listeners_={}}addEventListener(t,e){let i=this.listeners_[t];i||(i=this.listeners_[t]=[]),-1===i.indexOf(e)&&i.push(e)}dispatchEvent(t){const e="string"==typeof t?new I(t):t,i=e.type;e.target=this;const n=this.listeners_[i];let s;if(n){i in this.dispatching_||(this.dispatching_[i]=0,this.pendingRemovals_[i]=0),++this.dispatching_[i];for(let t=0,i=n.length;t<i;++t)if(!1===n[t].call(this,e)||e.propagationStopped){s=!1;break}if(--this.dispatching_[i],0===this.dispatching_[i]){let t=this.pendingRemovals_[i];for(delete this.pendingRemovals_[i];t--;)this.removeEventListener(i,S);delete this.dispatching_[i]}return s}}disposeInternal(){!function(t){const e=f(t);if(e)for(const i in e)m(t,i)}(this)}getListeners(t){return this.listeners_[t]}hasListener(t){return t?t in this.listeners_:Object.keys(this.listeners_).length>0}removeEventListener(t,e){const i=this.listeners_[t];if(i){const n=i.indexOf(e);t in this.pendingRemovals_?(i[n]=S,++this.pendingRemovals_[t]):(i.splice(n,1),0===i.length&&delete this.listeners_[t])}}},L={CHANGE:"change",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"};var M=class extends w{constructor(){super(),this.revision_=0}changed(){++this.revision_,this.dispatchEvent(L.CHANGE)}getRevision(){return this.revision_}on(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=v(this,t[s],e);return n}return v(this,t,e)}once(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=y(this,t[s],e);return n}return y(this,t,e)}un(t,e){if(Array.isArray(t))for(let i=0,n=t.length;i<n;++i)E(this,t[i],e);else E(this,t,e)}};class O extends I{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}const P={};function F(t){return P.hasOwnProperty(t)?P[t]:P[t]="change:"+t}var D=class extends M{constructor(t){super(),r(this),this.values_={},void 0!==t&&this.setProperties(t)}get(t){let e;return this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return Object.keys(this.values_)}getProperties(){return c({},this.values_)}notify(t,e){let i;i=F(t),this.dispatchEvent(new O(i,t,e)),i=l.PROPERTYCHANGE,this.dispatchEvent(new O(i,t,e))}set(t,e,i){if(i)this.values_[t]=e;else{const i=this.values_[t];this.values_[t]=e,i!==e&&this.notify(t,i)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}unset(t,e){if(t in this.values_){const i=this.values_[t];delete this.values_[t],e||this.notify(t,i)}}};const A={LENGTH:"length"};class b extends I{constructor(t,e,i){super(t),this.element=e,this.index=i}}var N=class extends D{constructor(t,e){super();const i=e||{};if(this.unique_=!!i.unique,this.array_=t||[],this.unique_)for(let t=0,e=this.array_.length;t<e;++t)this.assertUnique_(this.array_[t],t);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(A.LENGTH)}insertAt(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new b(h.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new b(h.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t<i){this.unique_&&this.assertUnique_(e,t);const i=this.array_[t];this.array_[t]=e,this.dispatchEvent(new b(h.REMOVE,i,t)),this.dispatchEvent(new b(h.ADD,e,t))}else{for(let e=i;e<t;++e)this.insertAt(e,void 0);this.insertAt(t,e)}}updateLength_(){this.set(A.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new a(58)}};var G=class extends I{constructor(t,e,i){super(t),this.map=e,this.frameState=void 0!==i?i:null}};var k=class extends G{constructor(t,e,i,n,s){super(t,e,s),this.originalEvent=i,this.pixel=e.getEventPixel(i),this.coordinate=e.getCoordinateFromPixel(this.pixel),this.dragging=void 0!==n&&n}preventDefault(){super.preventDefault(),this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),this.originalEvent.stopPropagation()}};const Y="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",X=-1!==Y.indexOf("firefox"),K=-1!==Y.indexOf("safari")&&-1==Y.indexOf("chrom"),U=-1!==Y.indexOf("webkit")&&-1==Y.indexOf("edge"),W=-1!==Y.indexOf("macintosh"),z=window.devicePixelRatio||1,B=(navigator,"ontouchstart"in window),Z="PointerEvent"in window,V=!!navigator.msPointerEnabled;var j={SINGLECLICK:"singleclick",CLICK:L.CLICK,DBLCLICK:L.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var H=class extends k{constructor(t,e,i,n,s){super(t,e,i.originalEvent,n,s),this.pointerEvent=i}},q={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var J=class{constructor(t,e){this.dispatcher=t,this.mapping_=e}getEvents(){return Object.keys(this.mapping_)}getHandlerForEvent(t){return this.mapping_[t]}};const Q=1,$="mouse",tt=25;function et(t){if(!this.isEventSimulatedFromTouch_(t)){Q.toString()in this.pointerMap&&this.cancel(t);const e=ot(t,this.dispatcher);this.pointerMap[Q.toString()]=t,this.dispatcher.down(e,t)}}function it(t){if(!this.isEventSimulatedFromTouch_(t)){const e=ot(t,this.dispatcher);this.dispatcher.move(e,t)}}function nt(t){if(!this.isEventSimulatedFromTouch_(t)){const e=this.pointerMap[Q.toString()];if(e&&e.button===t.button){const e=ot(t,this.dispatcher);this.dispatcher.up(e,t),this.cleanupMouse()}}}function st(t){if(!this.isEventSimulatedFromTouch_(t)){const e=ot(t,this.dispatcher);this.dispatcher.enterOver(e,t)}}function rt(t){if(!this.isEventSimulatedFromTouch_(t)){const e=ot(t,this.dispatcher);this.dispatcher.leaveOut(e,t)}}function ot(t,e){const i=e.cloneEvent(t,t),n=i.preventDefault;return i.preventDefault=function(){t.preventDefault(),n()},i.pointerId=Q,i.isPrimary=!0,i.pointerType=$,i}var at=class extends J{constructor(t){super(t,{mousedown:et,mousemove:it,mouseup:nt,mouseover:st,mouseout:rt}),this.pointerMap=t.pointerMap,this.lastTouches=[]}isEventSimulatedFromTouch_(t){const e=this.lastTouches,i=t.clientX,n=t.clientY;for(let t,s=0,r=e.length;s<r&&(t=e[s]);s++){const e=Math.abs(i-t[0]),s=Math.abs(n-t[1]);if(e<=tt&&s<=tt)return!0}return!1}cancel(t){const e=ot(t,this.dispatcher);this.dispatcher.cancel(e,t),this.cleanupMouse()}cleanupMouse(){delete this.pointerMap[Q.toString()]}};const ht=["","unavailable","touch","pen","mouse"];function lt(t){this.pointerMap[t.pointerId.toString()]=t;const e=this.prepareEvent_(t);this.dispatcher.down(e,t)}function ct(t){const e=this.prepareEvent_(t);this.dispatcher.move(e,t)}function ut(t){const e=this.prepareEvent_(t);this.dispatcher.up(e,t),this.cleanup(t.pointerId)}function dt(t){const e=this.prepareEvent_(t);this.dispatcher.leaveOut(e,t)}function gt(t){const e=this.prepareEvent_(t);this.dispatcher.enterOver(e,t)}function _t(t){const e=this.prepareEvent_(t);this.dispatcher.cancel(e,t),this.cleanup(t.pointerId)}function pt(t){const e=this.dispatcher.makeEvent("lostpointercapture",t,t);this.dispatcher.dispatchEvent(e)}function ft(t){const e=this.dispatcher.makeEvent("gotpointercapture",t,t);this.dispatcher.dispatchEvent(e)}var mt=class extends J{constructor(t){super(t,{MSPointerDown:lt,MSPointerMove:ct,MSPointerUp:ut,MSPointerOut:dt,MSPointerOver:gt,MSPointerCancel:_t,MSGotPointerCapture:ft,MSLostPointerCapture:pt}),this.pointerMap=t.pointerMap}prepareEvent_(t){let e=t;return"number"==typeof t.pointerType&&((e=this.dispatcher.cloneEvent(t,t)).pointerType=ht[t.pointerType]),e}cleanup(t){delete this.pointerMap[t.toString()]}};function vt(t){this.dispatcher.fireNativeEvent(t)}function yt(t){this.dispatcher.fireNativeEvent(t)}function Et(t){this.dispatcher.fireNativeEvent(t)}function xt(t){this.dispatcher.fireNativeEvent(t)}function Tt(t){this.dispatcher.fireNativeEvent(t)}function Ct(t){this.dispatcher.fireNativeEvent(t)}function Rt(t){this.dispatcher.fireNativeEvent(t)}function St(t){this.dispatcher.fireNativeEvent(t)}var It=class extends J{constructor(t){super(t,{pointerdown:vt,pointermove:yt,pointerup:Et,pointerout:xt,pointerover:Tt,pointercancel:Ct,gotpointercapture:St,lostpointercapture:Rt})}};let wt=!1;!function(){try{const t=new MouseEvent("click",{buttons:1});wt=1===t.buttons}catch(t){}}();var Lt=class extends I{constructor(t,e,i){super(t),this.originalEvent=e;const n=i||{};this.buttons=function(t){let e;if(t.buttons||wt)e=t.buttons;else switch(t.which){case 1:e=1;break;case 2:e=4;break;case 3:e=2;break;default:e=0}return e}(n),this.pressure=function(t,e){let i=0;return i=t.pressure?t.pressure:e?.5:0}(n,this.buttons),this.bubbles="bubbles"in n&&n.bubbles,this.cancelable="cancelable"in n&&n.cancelable,this.view="view"in n?n.view:null,this.detail="detail"in n?n.detail:null,this.screenX="screenX"in n?n.screenX:0,this.screenY="screenY"in n?n.screenY:0,this.clientX="clientX"in n?n.clientX:0,this.clientY="clientY"in n?n.clientY:0,this.ctrlKey="ctrlKey"in n&&n.ctrlKey,this.altKey="altKey"in n&&n.altKey,this.shiftKey="shiftKey"in n&&n.shiftKey,this.metaKey="metaKey"in n&&n.metaKey,this.button="button"in n?n.button:0,this.relatedTarget="relatedTarget"in n?n.relatedTarget:null,this.pointerId="pointerId"in n?n.pointerId:0,this.width="width"in n?n.width:0,this.height="height"in n?n.height:0,this.tiltX="tiltX"in n?n.tiltX:0,this.tiltY="tiltY"in n?n.tiltY:0,this.pointerType="pointerType"in n?n.pointerType:"",this.hwTimestamp="hwTimestamp"in n?n.hwTimestamp:0,this.isPrimary="isPrimary"in n&&n.isPrimary,e.preventDefault&&(this.preventDefault=function(){e.preventDefault()})}};function Mt(t,e){return t>e?1:t<e?-1:0}function Ot(t,e,i){const n=t.length;if(t[0]<=e)return 0;if(e<=t[n-1])return n-1;{let s;if(i>0){for(s=1;s<n;++s)if(t[s]<e)return s-1}else if(i<0){for(s=1;s<n;++s)if(t[s]<=e)return s}else for(s=1;s<n;++s){if(t[s]==e)return s;if(t[s]<e)return t[s-1]-e<e-t[s]?s-1:s}return n-1}}function Pt(t,e,i){for(;e<i;){const n=t[e];t[e]=t[i],t[i]=n,++e,--i}}function Ft(t,e){const i=Array.isArray(e)?e:[e],n=i.length;for(let e=0;e<n;e++)t[t.length]=i[e]}function Dt(t,e){const i=t.length;if(i!==e.length)return!1;for(let n=0;n<i;n++)if(t[n]!==e[n])return!1;return!0}const At=200,bt="touch";function Nt(t){this.vacuumTouches_(t),this.setPrimaryTouch_(t.changedTouches[0]),this.dedupSynthMouse_(t),this.clickCount_++,this.processTouches_(t,this.overDown_)}function Gt(t){this.processTouches_(t,this.moveOverOut_)}function kt(t){this.dedupSynthMouse_(t),this.processTouches_(t,this.upOut_)}function Yt(t){this.processTouches_(t,this.cancelOut_)}var Xt=class extends J{constructor(t,e){super(t,{touchstart:Nt,touchmove:Gt,touchend:kt,touchcancel:Yt}),this.pointerMap=t.pointerMap,this.mouseSource=e,this.firstTouchId_=void 0,this.clickCount_=0,this.resetId_,this.dedupTimeout_=2500}isPrimaryTouch_(t){return this.firstTouchId_===t.identifier}setPrimaryTouch_(t){const e=Object.keys(this.pointerMap).length;(0===e||1===e&&Q.toString()in this.pointerMap)&&(this.firstTouchId_=t.identifier,this.cancelResetClickCount_())}removePrimaryPointer_(t){t.isPrimary&&(this.firstTouchId_=void 0,this.resetClickCount_())}resetClickCount_(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),At)}resetClickCountHandler_(){this.clickCount_=0,this.resetId_=void 0}cancelResetClickCount_(){void 0!==this.resetId_&&clearTimeout(this.resetId_)}touchToPointer_(t,e){const i=this.dispatcher.cloneEvent(t,e);return i.pointerId=e.identifier+2,i.bubbles=!0,i.cancelable=!0,i.detail=this.clickCount_,i.button=0,i.buttons=1,i.width=e.radiusX||0,i.height=e.radiusY||0,i.pressure=e.force||.5,i.isPrimary=this.isPrimaryTouch_(e),i.pointerType=bt,i.clientX=e.clientX,i.clientY=e.clientY,i.screenX=e.screenX,i.screenY=e.screenY,i}processTouches_(t,e){const i=Array.prototype.slice.call(t.changedTouches),n=i.length;function s(){t.preventDefault()}for(let r=0;r<n;++r){const n=this.touchToPointer_(t,i[r]);n.preventDefault=s,e.call(this,t,n)}}findTouch_(t,e){const i=t.length;for(let n=0;n<i;n++)if(t[n].identifier===e)return!0;return!1}vacuumTouches_(t){const e=t.touches,i=Object.keys(this.pointerMap),n=i.length;if(n>=e.length){const s=[];for(let t=0;t<n;++t){const n=Number(i[t]),r=this.pointerMap[n];n==Q||this.findTouch_(e,n-2)||s.push(r.out)}for(let e=0;e<s.length;++e)this.cancelOut_(t,s[e])}}overDown_(t,e){this.pointerMap[e.pointerId]={target:e.target,out:e,outTarget:e.target},this.dispatcher.over(e,t),this.dispatcher.enter(e,t),this.dispatcher.down(e,t)}moveOverOut_(t,e){const i=e,n=this.pointerMap[i.pointerId];if(!n)return;const s=n.out,r=n.outTarget;this.dispatcher.move(i,t),s&&r!==i.target&&(s.relatedTarget=i.target,i.relatedTarget=r,s.target=r,i.target?(this.dispatcher.leaveOut(s,t),this.dispatcher.enterOver(i,t)):(i.target=r,i.relatedTarget=null,this.cancelOut_(t,i))),n.out=i,n.outTarget=i.target}upOut_(t,e){this.dispatcher.up(e,t),this.dispatcher.out(e,t),this.dispatcher.leave(e,t),this.cleanUpPointer_(e)}cancelOut_(t,e){this.dispatcher.cancel(e,t),this.dispatcher.out(e,t),this.dispatcher.leave(e,t),this.cleanUpPointer_(e)}cleanUpPointer_(t){delete this.pointerMap[t.pointerId],this.removePrimaryPointer_(t)}dedupSynthMouse_(t){const e=this.mouseSource.lastTouches,i=t.changedTouches[0];if(this.isPrimaryTouch_(i)){const t=[i.clientX,i.clientY];e.push(t),setTimeout(function(){!function(t,e){const i=t.indexOf(e),n=i>-1;n&&t.splice(i,1)}(e,t)},this.dedupTimeout_)}}};const Kt=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]];var Ut=class extends w{constructor(t){super(),this.element_=t,this.pointerMap={},this.eventMap_={},this.eventSourceList_=[],this.registerSources()}registerSources(){if(Z)this.registerSource("native",new It(this));else if(V)this.registerSource("ms",new mt(this));else{const t=new at(this);this.registerSource("mouse",t),B&&this.registerSource("touch",new Xt(this,t))}this.register_()}registerSource(t,e){const i=e,n=i.getEvents();n&&(n.forEach(function(t){const e=i.getHandlerForEvent(t);e&&(this.eventMap_[t]=e.bind(i))}.bind(this)),this.eventSourceList_.push(i))}register_(){const t=this.eventSourceList_.length;for(let e=0;e<t;e++){const t=this.eventSourceList_[e];this.addEvents_(t.getEvents())}}unregister_(){const t=this.eventSourceList_.length;for(let e=0;e<t;e++){const t=this.eventSourceList_[e];this.removeEvents_(t.getEvents())}}eventHandler_(t){const e=t.type,i=this.eventMap_[e];i&&i(t)}addEvents_(t){t.forEach(function(t){v(this.element_,t,this.eventHandler_,this)}.bind(this))}removeEvents_(t){t.forEach(function(t){E(this.element_,t,this.eventHandler_,this)}.bind(this))}cloneEvent(t,e){const i={};for(let n=0,s=Kt.length;n<s;n++){const s=Kt[n][0];i[s]=t[s]||e[s]||Kt[n][1]}return i}down(t,e){this.fireEvent(q.POINTERDOWN,t,e)}move(t,e){this.fireEvent(q.POINTERMOVE,t,e)}up(t,e){this.fireEvent(q.POINTERUP,t,e)}enter(t,e){t.bubbles=!1,this.fireEvent(q.POINTERENTER,t,e)}leave(t,e){t.bubbles=!1,this.fireEvent(q.POINTERLEAVE,t,e)}over(t,e){t.bubbles=!0,this.fireEvent(q.POINTEROVER,t,e)}out(t,e){t.bubbles=!0,this.fireEvent(q.POINTEROUT,t,e)}cancel(t,e){this.fireEvent(q.POINTERCANCEL,t,e)}leaveOut(t,e){this.out(t,e),this.contains_(t.target,t.relatedTarget)||this.leave(t,e)}enterOver(t,e){this.over(t,e),this.contains_(t.target,t.relatedTarget)||this.enter(t,e)}contains_(t,e){return!(!t||!e)&&t.contains(e)}makeEvent(t,e,i){return new Lt(t,i,e)}fireEvent(t,e,i){const n=this.makeEvent(t,e,i);this.dispatchEvent(n)}fireNativeEvent(t){const e=this.makeEvent(t.type,t,t);this.dispatchEvent(e)}wrapMouseEvent(t,e){return this.makeEvent(t,ot(e,this),e)}disposeInternal(){this.unregister_(),super.disposeInternal()}};var Wt=class extends w{constructor(t,e){super(),this.map_=t,this.clickTimeoutId_,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e?e*z:z,this.down_=null;const i=this.map_.getViewport();this.activePointers_=0,this.trackedTouches_={},this.pointerEventHandler_=new Ut(i),this.documentPointerEventHandler_=null,this.pointerdownListenerKey_=v(this.pointerEventHandler_,q.POINTERDOWN,this.handlePointerDown_,this),this.relayedListenerKey_=v(this.pointerEventHandler_,q.POINTERMOVE,this.relayEvent_,this)}emulateClick_(t){let e=new H(j.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new H(j.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;const e=new H(j.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}.bind(this),250)}updateActivePointers_(t){const e=t;e.type==j.POINTERUP||e.type==j.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==j.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length}handlePointerUp_(t){this.updateActivePointers_(t);const e=new H(j.POINTERUP,this.map_,t);this.dispatchEvent(e),e.propagationStopped||this.dragging_||!this.isMouseActionButton_(t)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(x),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null,this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.updateActivePointers_(t);const e=new H(j.POINTERDOWN,this.map_,t);this.dispatchEvent(e),this.down_=t,0===this.dragListenerKeys_.length&&(this.documentPointerEventHandler_=new Ut(document),this.dragListenerKeys_.push(v(this.documentPointerEventHandler_,j.POINTERMOVE,this.handlePointerMove_,this),v(this.documentPointerEventHandler_,j.POINTERUP,this.handlePointerUp_,this),v(this.pointerEventHandler_,j.POINTERCANCEL,this.handlePointerUp_,this)))}handlePointerMove_(t){if(this.isMoving_(t)){this.dragging_=!0;const e=new H(j.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}t.preventDefault()}relayEvent_(t){const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new H(t.type,this.map_,t,e))}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(x(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(x(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(x),this.dragListenerKeys_.length=0,this.documentPointerEventHandler_&&(this.documentPointerEventHandler_.dispose(),this.documentPointerEventHandler_=null),this.pointerEventHandler_&&(this.pointerEventHandler_.dispose(),this.pointerEventHandler_=null),super.disposeInternal()}},zt={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},Bt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Zt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Vt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};function jt(t,e){if(!t)throw new a(e)}const Ht=1/0;var qt=class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,u(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(t){jt(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=Ht&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,n=e.length,s=e[t],r=i[t],o=t;for(;t<n>>1;){const s=this.getLeftChildIndex_(t),r=this.getRightChildIndex_(t),o=r<n&&i[r]<i[s]?r:s;e[t]=e[o],i[t]=i[o],t=o}e[t]=s,i[t]=r,this.siftDown_(o,t)}siftDown_(t,e){const i=this.elements_,n=this.priorities_,s=i[e],r=n[e];for(;e>t;){const t=this.getParentIndex_(e);if(!(n[t]>r))break;i[e]=i[t],n[e]=n[t],e=t}i[e]=s,n[e]=r}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let n=0;const s=e.length;let r,o,a;for(o=0;o<s;++o)(a=t(r=e[o]))==Ht?delete this.queuedElements_[this.keyFunction_(r)]:(i[n]=a,e[n++]=r);e.length=n,i.length=n,this.heapify_()}};var Jt=class extends qt{constructor(t,e){super(function(e){return t.apply(null,e)},function(t){return t[0].getKey()}),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&v(t[0],L.CHANGE,this.handleTileChange,this),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(e.hifi&&i===Vt.LOADED||i===Vt.ERROR||i===Vt.EMPTY||i===Vt.ABORT){E(e,L.CHANGE,this.handleTileChange,this);const t=e.getKey();t in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[t],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i,n,s,r=0,o=!1;for(;this.tilesLoading_<t&&r<e&&this.getCount()>0;)s=(n=this.dequeue()[0]).getKey(),(i=n.getState())===Vt.ABORT?o=!0:i!==Vt.IDLE||s in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++r,n.load());0===r&&o&&this.tileChangeCallback_()}};const Qt=42,$t=256;function te(t,e,i){return Math.min(Math.max(t,e),i)}const ee=function(){let t;return t="cosh"in Math?Math.cosh:function(t){const e=Math.exp(t);return(e+1/e)/2}}();function ie(t,e,i,n,s,r){const o=s-i,a=r-n;if(0!==o||0!==a){const h=((t-i)*o+(e-n)*a)/(o*o+a*a);h>1?(i=s,n=r):h>0&&(i+=o*h,n+=a*h)}return ne(t,e,i,n)}function ne(t,e,i,n){const s=i-t,r=n-e;return s*s+r*r}function se(t){return t*Math.PI/180}function re(t,e){const i=t%e;return i*e<0?i+e:i}function oe(t,e,i){return t+i*(e-t)}function ae(t){return t}var he={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},le={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function ce(t){const e=ve();for(let i=0,n=t.length;i<n;++i)Re(e,t[i]);return e}function ue(t,e,i){return i?(i[0]=t[0]-e,i[1]=t[1]-e,i[2]=t[2]+e,i[3]=t[3]+e,i):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function de(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t.slice()}function ge(t,e,i){let n,s;return(n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*n+(s=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0)*s}function _e(t,e){return fe(t,e[0],e[1])}function pe(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function fe(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function me(t,e){const i=t[0],n=t[1],s=t[2],r=t[3],o=e[0],a=e[1];let h=le.UNKNOWN;return o<i?h|=le.LEFT:o>s&&(h|=le.RIGHT),a<n?h|=le.BELOW:a>r&&(h|=le.ABOVE),h===le.UNKNOWN&&(h=le.INTERSECTING),h}function ve(){return[1/0,1/0,-1/0,-1/0]}function ye(t,e,i,n,s){return s?(s[0]=t,s[1]=e,s[2]=i,s[3]=n,s):[t,e,i,n]}function Ee(t){return ye(1/0,1/0,-1/0,-1/0,t)}function xe(t,e){const i=t[0],n=t[1];return ye(i,n,i,n,e)}function Te(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function Ce(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function Re(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Se(t,e){for(let i=0,n=e.length;i<n;++i)Re(t,e[i]);return t}function Ie(t,e,i,n,s){for(;i<n;i+=s)we(t,e[i],e[i+1]);return t}function we(t,e,i){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],i),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],i)}function Le(t){let e=0;return Xe(t)||(e=ke(t)*Ae(t)),e}function Me(t){return[t[0],t[1]]}function Oe(t){return[t[2],t[1]]}function Pe(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Fe(t,e){let i;return e===he.BOTTOM_LEFT?i=Me(t):e===he.BOTTOM_RIGHT?i=Oe(t):e===he.TOP_LEFT?i=Ne(t):e===he.TOP_RIGHT?i=Ge(t):jt(!1,13),i}function De(t,e,i,n,s){const r=e*n[0]/2,o=e*n[1]/2,a=Math.cos(i),h=Math.sin(i),l=r*a,c=r*h,u=o*a,d=o*h,g=t[0],_=t[1],p=g-l+d,f=g-l-d,m=g+l-d,v=g+l+d,y=_-c-u,E=_-c+u,x=_+c+u,T=_+c-u;return ye(Math.min(p,f,m,v),Math.min(y,E,x,T),Math.max(p,f,m,v),Math.max(y,E,x,T),s)}function Ae(t){return t[3]-t[1]}function be(t,e,i){const n=i||[1/0,1/0,-1/0,-1/0];return Ye(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):Ee(n),n}function Ne(t){return[t[0],t[3]]}function Ge(t){return[t[2],t[3]]}function ke(t){return t[2]-t[0]}function Ye(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function Xe(t){return t[2]<t[0]||t[3]<t[1]}function Ke(t,e,i){const n=ke(e)/i[0],s=Ae(e)/i[1];return Math.min(t,Math.min(n,s))}function Ue(t,e,i){let n=Math.min(t,e);return n*=Math.log(1+50*Math.max(0,t/e-1))/50+1,i&&(n=Math.max(n,i),n/=Math.log(1+50*Math.max(0,i/t-1))/50+1),te(n,i/2,2*e)}function We(t,e,i,n){return function(s,r,o,a){if(void 0!==s){const r=n?Ke(t,n,o):t;return(void 0===i||i)&&a?Ue(s,r,e):te(s,e,r)}}}function ze(t){return void 0!==t?0:void 0}function Be(t){return void 0!==t?t:void 0}var Ze={ANIMATING:0,INTERACTING:1},Ve={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function je(t,e){const i=t[0],n=t[1],s=e[0],r=e[1],o=s[0],a=s[1],h=r[0],l=r[1],c=h-o,u=l-a,d=0===c&&0===u?0:(c*(i-o)+u*(n-a))/(c*c+u*u||0);let g,_;return d<=0?(g=o,_=a):d>=1?(g=h,_=l):(g=o+d*c,_=a+d*u),[g,_]}function He(t,e){let i=!0;for(let n=t.length-1;n>=0;--n)if(t[n]!=e[n]){i=!1;break}return i}function qe(t,e){const i=Math.cos(e),n=Math.sin(e),s=t[0]*i-t[1]*n,r=t[1]*i+t[0]*n;return t[0]=s,t[1]=r,t}function Je(t,e){const i=t[0]-e[0],n=t[1]-e[1];return i*i+n*n}function Qe(t,e){return Math.sqrt(Je(t,e))}function $e(t){return Math.pow(t,3)}function ti(t){return 1-$e(1-t)}function ei(t){return 3*t*t-2*t*t*t}function ii(t){return t}var ni={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},si={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function ri(t,e,i,n,s,r){const o=r||[];let a=0;for(let r=e;r<i;r+=n){const e=t[r],i=t[r+1];o[a++]=s[0]*e+s[2]*i+s[4],o[a++]=s[1]*e+s[3]*i+s[5]}return r&&o.length!=a&&(o.length=a),o}
/**
 * @license
 * Latitude/longitude spherical geodesy formulae taken from
 * http://www.movable-type.co.uk/scripts/latlong.html
 * Licensed under CC-BY-3.0.
 */
const oi=6371008.8;function ai(t,e,i){const n=i||oi,s=se(t[1]),r=se(e[1]),o=(r-s)/2,a=se(e[0]-t[0])/2,h=Math.sin(o)*Math.sin(o)+Math.sin(a)*Math.sin(a)*Math.cos(s)*Math.cos(r);return 2*n*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))}const hi={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},li={};li[hi.DEGREES]=2*Math.PI*6370997/360,li[hi.FEET]=.3048,li[hi.METERS]=1,li[hi.USFEET]=1200/3937;var ci=hi;var ui=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=void 0!==t.extent?t.extent:null,this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null,this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu",this.global_=void 0!==t.global&&t.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||li[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const di=6378137,gi=Math.PI*di,_i=[-gi,-gi,gi,gi],pi=[-180,-85,180,85];class fi extends ui{constructor(t){super({code:t,units:ci.METERS,extent:_i,global:!0,worldExtent:pi,getPointResolution:function(t,e){return t/ee(e[1]/di)}})}}const mi=[new fi("EPSG:3857"),new fi("EPSG:102100"),new fi("EPSG:102113"),new fi("EPSG:900913"),new fi("urn:ogc:def:crs:EPSG:6.18:3:3857"),new fi("urn:ogc:def:crs:EPSG::3857"),new fi("http://www.opengis.net/gml/srs/epsg.xml#3857")];function vi(t,e,i){const n=t.length,s=i>1?i:2;let r=e;void 0===r&&(r=s>2?t.slice():new Array(n));const o=gi;for(let e=0;e<n;e+=s){r[e]=o*t[e]/180;let i=di*Math.log(Math.tan(Math.PI*(+t[e+1]+90)/360));i>o?i=o:i<-o&&(i=-o),r[e+1]=i}return r}function yi(t,e,i){const n=t.length,s=i>1?i:2;let r=e;void 0===r&&(r=s>2?t.slice():new Array(n));for(let e=0;e<n;e+=s)r[e]=180*t[e]/gi,r[e+1]=360*Math.atan(Math.exp(t[e+1]/di))/Math.PI-90;return r}const Ei=[-180,-90,180,90],xi=6378137*Math.PI/180;class Ti extends ui{constructor(t,e){super({code:t,units:ci.DEGREES,extent:Ei,axisOrientation:e,global:!0,metersPerUnit:xi,worldExtent:Ei})}}const Ci=[new Ti("CRS:84"),new Ti("EPSG:4326","neu"),new Ti("urn:ogc:def:crs:EPSG::4326","neu"),new Ti("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new Ti("urn:ogc:def:crs:OGC:1.3:CRS84"),new Ti("urn:ogc:def:crs:OGC:2:84"),new Ti("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Ti("urn:x-ogc:def:crs:EPSG:4326","neu")];let Ri={};let Si={};function Ii(t,e,i){const n=t.getCode(),s=e.getCode();n in Si||(Si[n]={}),Si[n][s]=i}function wi(t,e,i){let n;if(void 0!==e){for(let i=0,n=t.length;i<n;++i)e[i]=t[i];n=e}else n=t.slice();return n}function Li(t,e,i){if(void 0!==e&&t!==e){for(let i=0,n=t.length;i<n;++i)e[i]=t[i];t=e}return t}function Mi(t){!function(t,e){Ri[t]=e}(t.getCode(),t),Ii(t,t,wi)}function Oi(t){return"string"==typeof t?Ri[t]||null:t||null}function Pi(t,e,i,n){let s;const r=(t=Oi(t)).getPointResolutionFunc();if(r){if(s=r(e,i),n&&n!==t.getUnits()){const e=t.getMetersPerUnit();e&&(s=s*e/li[n])}}else{if(t.getUnits()==ci.DEGREES&&!n||n==ci.DEGREES)s=e;else{const r=bi(t,Oi("EPSG:4326"));let o=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2];s=(ai((o=r(o,o,2)).slice(0,2),o.slice(2,4))+ai(o.slice(4,6),o.slice(6,8)))/2;const a=n?li[n]:t.getMetersPerUnit();void 0!==a&&(s/=a)}}return s}function Fi(t){!function(t){t.forEach(Mi)}(t),t.forEach(function(e){t.forEach(function(t){e!==t&&Ii(e,t,wi)})})}function Di(t,e){return t?"string"==typeof t?Oi(t):t:Oi(e)}function Ai(t,e){if(t===e)return!0;const i=t.getUnits()===e.getUnits();if(t.getCode()===e.getCode())return i;return bi(t,e)===wi&&i}function bi(t,e){let i=function(t,e){let i;return t in Si&&e in Si[t]&&(i=Si[t][e]),i}(t.getCode(),e.getCode());return i||(i=Li),i}function Ni(t,e){return bi(Oi(t),Oi(e))}function Gi(t,e,i){return Ni(e,i)(t,void 0,t.length)}var ki,Yi,Xi;Fi(mi),Fi(Ci),ki=mi,Yi=vi,Xi=yi,Ci.forEach(function(t){ki.forEach(function(e){Ii(t,e,Yi),Ii(e,t,Xi)})});new Array(6);function Ki(t,e,i,n,s,r,o){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t[4]=r,t[5]=o,t}function Ui(t,e){const i=e[0],n=e[1];return e[0]=t[0]*i+t[2]*n+t[4],e[1]=t[1]*i+t[3]*n+t[5],e}function Wi(t,e,i,n,s,r,o,a){const h=Math.sin(r),l=Math.cos(r);return t[0]=n*l,t[1]=s*h,t[2]=-n*h,t[3]=s*l,t[4]=o*n*l-a*n*h+e,t[5]=o*s*h+a*s*l+i,t}function zi(t,e){const i=(n=e)[0]*n[3]-n[1]*n[2];var n;jt(0!==i,32);const s=e[0],r=e[1],o=e[2],a=e[3],h=e[4],l=e[5];return t[0]=a/i,t[1]=-r/i,t[2]=-o/i,t[3]=s/i,t[4]=(o*l-a*h)/i,t[5]=-(s*l-r*h)/i,t}function Bi(t){return"matrix("+t.join(", ")+")"}const Zi=[1,0,0,1,0,0];var Vi=class extends D{constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryCache={},this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0}clone(){return n()}closestPointXY(t,e,i,s){return n()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){const i=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],i,1/0),i}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return n()}getExtent(t){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)}rotate(t,e){n()}scale(t,e,i){n()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return n()}getType(){return n()}applyTransform(t){n()}intersectsExtent(t){return n()}translate(t,e){n()}transform(t,e){const i=Oi(t),n=i.getUnits()==ci.TILE_PIXELS?function(t,n,s){const r=i.getExtent(),o=i.getWorldExtent(),a=Ae(o)/Ae(r);return Wi(Zi,o[0],o[3],a,-a,0,0,0),ri(t,0,t.length,s,Zi,n),Ni(i,e)(t,n,s)}:Ni(i,e);return this.applyTransform(n),this}};function ji(t){let e;return t==si.XY?e=2:t==si.XYZ||t==si.XYM?e=3:t==si.XYZM&&(e=4),e}var Hi=class extends Vi{constructor(){super(),this.layout=si.XY,this.stride=2,this.flatCoordinates=null}computeExtent(t){return e=this.flatCoordinates,i=0,n=this.flatCoordinates.length,s=this.stride,Ie(Ee(t),e,i,n,s);var e,i,n,s}getCoordinates(){return n()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!=this.getRevision()&&(u(this.simplifiedGeometryCache),this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(e))return this.simplifiedGeometryCache[e];{const i=this.getSimplifiedGeometryInternal(t);return i.getFlatCoordinates().length<this.flatCoordinates.length?(this.simplifiedGeometryCache[e]=i,i):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=ji(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){n()}setLayout(t,e,i){let n;if(t)n=ji(t);else{for(let t=0;t<i;++t){if(0===e.length)return this.layout=si.XY,void(this.stride=2);e=e[0]}t=function(t){let e;return 2==t?e=si.XY:3==t?e=si.XYZ:4==t&&(e=si.XYZM),e}(n=e.length)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();!function(t,e,i,n,s,r,o){const a=o||[],h=Math.cos(s),l=Math.sin(s),c=r[0],u=r[1];let d=0;for(let s=e;s<i;s+=n){const e=t[s]-c,i=t[s+1]-u;a[d++]=c+e*h-i*l,a[d++]=u+e*l+i*h;for(let e=s+2;e<s+n;++e)a[d++]=t[e]}o&&a.length!=d&&(a.length=d)}(i,0,i.length,n,t,e,i),this.changed()}}scale(t,e,i){let n=e;void 0===n&&(n=t);let s=i;s||(s=Pe(this.getExtent()));const r=this.getFlatCoordinates();if(r){const e=this.getStride();!function(t,e,i,n,s,r,o,a){const h=a||[],l=o[0],c=o[1];let u=0;for(let o=e;o<i;o+=n){const e=t[o]-l,i=t[o+1]-c;h[u++]=l+s*e,h[u++]=c+r*i;for(let e=o+2;e<o+n;++e)h[u++]=t[e]}a&&h.length!=u&&(h.length=u)}(r,0,r.length,e,t,n,s,r),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();!function(t,e,i,n,s,r,o){const a=o||[];let h=0;for(let o=e;o<i;o+=n){a[h++]=t[o]+s,a[h++]=t[o+1]+r;for(let e=o+2;e<o+n;++e)a[h++]=t[e]}o&&a.length!=h&&(a.length=h)}(i,0,i.length,n,t,e,i),this.changed()}}};function qi(t,e,i,n){let s=0,r=t[i-n],o=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];s+=o*i-r*n,r=i,o=n}return s/2}function Ji(t,e,i,n){let s=0;for(let r=0,o=i.length;r<o;++r){const o=i[r];s+=qi(t,e,o,n),e=o}return s}function Qi(t,e,i,n,s,r,o){const a=t[e],h=t[e+1],l=t[i]-a,c=t[i+1]-h;let u;if(0===l&&0===c)u=e;else{const d=((s-a)*l+(r-h)*c)/(l*l+c*c);if(d>1)u=i;else{if(d>0){for(let s=0;s<n;++s)o[s]=oe(t[e+s],t[i+s],d);return void(o.length=n)}u=e}}for(let e=0;e<n;++e)o[e]=t[u+e];o.length=n}function $i(t,e,i,n,s){let r=t[e],o=t[e+1];for(e+=n;e<i;e+=n){const i=t[e],n=t[e+1],a=ne(r,o,i,n);a>s&&(s=a),r=i,o=n}return s}function tn(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){const o=i[r];s=$i(t,e,o,n,s),e=o}return s}function en(t,e,i,n,s,r,o,a,h,l,c){if(e==i)return l;let u,d;if(0===s){if((d=ne(o,a,t[e],t[e+1]))<l){for(u=0;u<n;++u)h[u]=t[e+u];return h.length=n,d}return l}const g=c||[NaN,NaN];let _=e+n;for(;_<i;)if(Qi(t,_-n,_,n,o,a,g),(d=ne(o,a,g[0],g[1]))<l){for(l=d,u=0;u<n;++u)h[u]=g[u];h.length=n,_+=n}else _+=n*Math.max((Math.sqrt(d)-Math.sqrt(l))/s|0,1);if(r&&(Qi(t,i-n,e,n,o,a,g),(d=ne(o,a,g[0],g[1]))<l)){for(l=d,u=0;u<n;++u)h[u]=g[u];h.length=n}return l}function nn(t,e,i,n,s,r,o,a,h,l,c){const u=c||[NaN,NaN];for(let c=0,d=i.length;c<d;++c){const d=i[c];l=en(t,e,d,n,s,r,o,a,h,l,u),e=d}return l}function sn(t,e,i,n){for(let s=0,r=i.length;s<r;++s){const r=i[s];for(let i=0;i<n;++i)t[e++]=r[i]}return e}function rn(t,e,i,n,s){const r=s||[];let o=0;for(let s=0,a=i.length;s<a;++s){const a=sn(t,e,i[s],n);r[o++]=a,e=a}return r.length=o,r}function on(t,e,i,n,s){const r=void 0!==s?s:[];let o=0;for(let s=e;s<i;s+=n)r[o++]=t.slice(s,s+n);return r.length=o,r}function an(t,e,i,n,s){const r=void 0!==s?s:[];let o=0;for(let s=0,a=i.length;s<a;++s){const a=i[s];r[o++]=on(t,e,a,n,r[o]),e=a}return r.length=o,r}function hn(t,e,i,n,s){const r=void 0!==s?s:[];let o=0;for(let s=0,a=i.length;s<a;++s){const a=i[s];r[o++]=an(t,e,a,n,r[o]),e=a[a.length-1]}return r.length=o,r}function ln(t,e,i,n,s,r,o){const a=(i-e)/n;if(a<3){for(;e<i;e+=n)r[o++]=t[e],r[o++]=t[e+1];return o}const h=new Array(a);h[0]=1,h[a-1]=1;const l=[e,i-n];let c=0;for(;l.length>0;){const i=l.pop(),r=l.pop();let o=0;const a=t[r],u=t[r+1],d=t[i],g=t[i+1];for(let e=r+n;e<i;e+=n){const i=ie(t[e],t[e+1],a,u,d,g);i>o&&(c=e,o=i)}o>s&&(h[(c-e)/n]=1,r+n<c&&l.push(r,c),c+n<i&&l.push(c,i))}for(let i=0;i<a;++i)h[i]&&(r[o++]=t[e+i*n],r[o++]=t[e+i*n+1]);return o}function cn(t,e){return e*Math.round(t/e)}function un(t,e,i,n,s,r,o){if(e==i)return o;let a,h,l=cn(t[e],s),c=cn(t[e+1],s);e+=n,r[o++]=l,r[o++]=c;do{if(a=cn(t[e],s),h=cn(t[e+1],s),(e+=n)==i)return r[o++]=a,r[o++]=h,o}while(a==l&&h==c);for(;e<i;){const i=cn(t[e],s),u=cn(t[e+1],s);if(e+=n,i==a&&u==h)continue;const d=a-l,g=h-c,_=i-l,p=u-c;d*p==g*_&&(d<0&&_<d||d==_||d>0&&_>d)&&(g<0&&p<g||g==p||g>0&&p>g)?(a=i,h=u):(r[o++]=a,r[o++]=h,l=a,c=h,a=i,h=u)}return r[o++]=a,r[o++]=h,o}function dn(t,e,i,n,s,r,o,a){for(let h=0,l=i.length;h<l;++h){const l=i[h];o=un(t,e,l,n,s,r,o),a.push(o),e=l}return o}class gn extends Hi{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new gn(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<ge(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($i(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),en(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))}getArea(){return qi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return on(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=ln(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new gn(e,si.XY)}getType(){return ni.LINEAR_RING}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=sn(this.flatCoordinates,0,t,this.stride),this.changed()}}var _n=gn;class pn extends Hi{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){return new pn(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){const s=this.flatCoordinates,r=ne(t,e,s[0],s[1]);if(r<n){const t=this.stride;for(let e=0;e<t;++e)i[e]=s[e];return i.length=t,r}return n}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return xe(this.flatCoordinates,t)}getType(){return ni.POINT}intersectsExtent(t){return fe(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(t,e,i,n){for(let n=0,s=i.length;n<s;++n)t[e++]=i[n];return e}(this.flatCoordinates,0,t,this.stride),this.changed()}}var fn=pn;function mn(t,e,i,n,s){return!function(t,e){let i;return(i=e(Me(t)))?i:(i=e(Oe(t)))?i:(i=e(Ge(t)))?i:(i=e(Ne(t)))||!1}(s,function(s){return!vn(t,e,i,n,s[0],s[1])})}function vn(t,e,i,n,s,r){let o=0,a=t[i-n],h=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];h<=r?n>r&&(i-a)*(r-h)-(s-a)*(n-h)>0&&o++:n<=r&&(i-a)*(r-h)-(s-a)*(n-h)<0&&o--,a=i,h=n}return 0!==o}function yn(t,e,i,n,s,r){if(0===i.length)return!1;if(!vn(t,e,i[0],n,s,r))return!1;for(let e=1,o=i.length;e<o;++e)if(vn(t,i[e-1],i[e],n,s,r))return!1;return!0}function En(t,e,i,n,s,r,o){let a,h,l,c,u,d,g;const _=s[r+1],p=[];for(let s=0,r=i.length;s<r;++s){const r=i[s];for(c=t[r-n],d=t[r-n+1],a=e;a<r;a+=n)u=t[a],g=t[a+1],(_<=d&&g<=_||d<=_&&_<=g)&&(l=(_-d)/(g-d)*(u-c)+c,p.push(l)),c=u,d=g}let f=NaN,m=-1/0;for(p.sort(Mt),c=p[0],a=1,h=p.length;a<h;++a){u=p[a];const s=Math.abs(u-c);s>m&&yn(t,e,i,n,l=(c+u)/2,_)&&(f=l,m=s),c=u}return isNaN(f)&&(f=s[r]),o?(o.push(f,_,m),o):[f,_,m]}function xn(t,e,i,n,s){const r=[t[e],t[e+1]],o=[];let a;for(;e+n<i;e+=n){if(o[0]=t[e+n],o[1]=t[e+n+1],a=s(r,o))return a;r[0]=o[0],r[1]=o[1]}return!1}function Tn(t,e,i,n,s){const r=Ie([1/0,1/0,-1/0,-1/0],t,e,i,n);return!!Ye(s,r)&&(!!pe(s,r)||(r[0]>=s[0]&&r[2]<=s[2]||(r[1]>=s[1]&&r[3]<=s[3]||xn(t,e,i,n,function(t,e){return function(t,e,i){let n=!1;const s=me(t,e),r=me(t,i);if(s===le.INTERSECTING||r===le.INTERSECTING)n=!0;else{const o=t[0],a=t[1],h=t[2],l=t[3],c=e[0],u=e[1],d=i[0],g=i[1],_=(g-u)/(d-c);let p,f;r&le.ABOVE&&!(s&le.ABOVE)&&(n=(p=d-(g-l)/_)>=o&&p<=h),n||!(r&le.RIGHT)||s&le.RIGHT||(n=(f=g-(d-h)*_)>=a&&f<=l),n||!(r&le.BELOW)||s&le.BELOW||(n=(p=d-(g-a)/_)>=o&&p<=h),n||!(r&le.LEFT)||s&le.LEFT||(n=(f=g-(d-o)*_)>=a&&f<=l)}return n}(s,t,e)}))))}function Cn(t,e,i,n,s){if(!function(t,e,i,n,s){return!!(Tn(t,e,i,n,s)||vn(t,e,i,n,s[0],s[1])||vn(t,e,i,n,s[0],s[3])||vn(t,e,i,n,s[2],s[1])||vn(t,e,i,n,s[2],s[3]))}(t,e,i[0],n,s))return!1;if(1===i.length)return!0;for(let e=1,r=i.length;e<r;++e)if(mn(t,i[e-1],i[e],n,s)&&!Tn(t,i[e-1],i[e],n,s))return!1;return!0}function Rn(t,e,i,n){for(;e<i-n;){for(let s=0;s<n;++s){const r=t[e+s];t[e+s]=t[i-n+s],t[i-n+s]=r}e+=n,i-=n}}function Sn(t,e,i,n){let s=0,r=t[i-n],o=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];s+=(i-r)*(n+o),r=i,o=n}return s>0}function In(t,e,i,n,s){const r=void 0!==s&&s;for(let s=0,o=i.length;s<o;++s){const o=i[s],a=Sn(t,e,o,n);if(0===s){if(r&&a||!r&&!a)return!1}else if(r&&!a||!r&&a)return!1;e=o}return!0}function wn(t,e,i,n,s){const r=void 0!==s&&s;for(let s=0,o=i.length;s<o;++s){const o=i[s],a=Sn(t,e,o,n);(0===s?r&&a||!r&&!a:r&&!a||!r&&a)&&Rn(t,e,o,n),e=o}return e}class Ln extends Hi{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Ft(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){return new Ln(this.flatCoordinates.slice(),this.layout,this.ends_.slice())}closestPointXY(t,e,i,n){return n<ge(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(tn(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),nn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return yn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Ji(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?wn(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,an(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Pe(this.getExtent());this.flatInteriorPoint_=En(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new fn(this.getFlatInteriorPoint(),si.XYM)}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new _n(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[];let s=0;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=new _n(e.slice(s,o),t);n.push(a),s=o}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;In(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=wn(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=dn(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new Ln(e,si.XY,i)}getType(){return ni.POLYGON}intersectsExtent(t){return Cn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=rn(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}var Mn=Ln;function On(t){const e=t[0],i=t[1],n=t[2],s=t[3],r=[e,i,e,s,n,s,n,i,e,i];return new Ln(r,si.XY,[r.length])}const Pn=0;function Fn(t,e){setTimeout(function(){t(e)},0)}function Dn(t){return!(t.sourceCenter&&t.targetCenter&&!He(t.sourceCenter,t.targetCenter))&&(t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation)}var An=class extends D{constructor(t){super();const e=c({},t);this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Di(e.projection,"EPSG:3857"),this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.applyOptions_(e)}applyOptions_(t){const e=function(t){let e,i,n,s=void 0!==t.minZoom?t.minZoom:Pn,r=void 0!==t.maxZoom?t.maxZoom:28;const o=void 0!==t.zoomFactor?t.zoomFactor:2,a=void 0!==t.multiWorld&&t.multiWorld,h=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint;if(void 0!==t.resolutions){const o=t.resolutions;i=o[s],n=void 0!==o[r]?o[r]:o[o.length-1],e=t.constrainResolution?function(t,e,i){return function(n,s,r,o){if(void 0!==n){const a=t[0],h=t[t.length-1],l=i?Ke(a,i,r):a;if(o)return void 0===e||e?Ue(n,l,h):te(n,h,l);const c=Math.min(l,n),u=Math.floor(Ot(t,c,s));return t[u]}}}(o,h,!t.constrainOnlyCenter&&t.extent):We(i,n,h,!t.constrainOnlyCenter&&t.extent)}else{const l=Di(t.projection,"EPSG:3857"),c=l.getExtent(),u=c?Math.max(ke(c),Ae(c)):360*li[ci.DEGREES]/l.getMetersPerUnit(),d=u/$t/Math.pow(2,Pn),g=d/Math.pow(2,28-Pn);if(void 0!==(i=t.maxResolution)?s=0:i=d/Math.pow(o,s),void 0===(n=t.minResolution)&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(o,r):d/Math.pow(o,r):g),r=s+Math.floor(Math.log(i/n)/Math.log(o)),n=i/Math.pow(o,r-s),t.constrainResolution)e=function(t,e,i,n,s){return function(r,o,a,h){if(void 0!==r){const l=s?Ke(e,s,a):e,c=void 0!==i?i:0;if(h)return void 0===n||n?Ue(r,l,c):te(r,c,l);const u=-o*(.5-1e-9)+.5,d=Math.min(l,r),g=Math.floor(Math.log(e/d)/Math.log(t)+u);return te(e/Math.pow(t,g),c,l)}}}(o,i,n,h,!t.constrainOnlyCenter&&t.extent);else{let s=t.constrainOnlyCenter,r=t.extent;a||r||!l.isGlobal()||(s=!1,r=l.getExtent()),e=We(i,n,h,!s&&r)}}return{constraint:e,maxResolution:i,minResolution:n,minZoom:s,zoomFactor:o}}(t);this.maxResolution_=e.maxResolution,this.minResolution_=e.minResolution,this.zoomFactor_=e.zoomFactor,this.resolutions_=t.resolutions,this.minZoom_=e.minZoom;const i=function(t){return void 0!==t.extent?(e=t.extent,i=t.constrainOnlyCenter,n=void 0===t.smoothExtentConstraint||t.smoothExtentConstraint,function(t,s,r,o){if(t){const a=i?0:r[0]*s,h=i?0:r[1]*s;let l=e[0]+a/2,c=e[2]-a/2,u=e[1]+h/2,d=e[3]-h/2;l>c&&(l=c=(c+l)/2),u>d&&(u=d=(d+u)/2);let g=te(t[0],l,c),_=te(t[1],u,d);const p=30*s;return o&&n&&(g+=-p*Math.log(1+Math.max(0,l-t[0])/p)+p*Math.log(1+Math.max(0,t[0]-c)/p),_+=-p*Math.log(1+Math.max(0,u-t[1])/p)+p*Math.log(1+Math.max(0,t[1]-d)/p)),[g,_]}}):ae;var e,i,n}(t),n=e.constraint,s=function(t){if(void 0===t.enableRotation||t.enableRotation){const e=t.constrainRotation;return void 0===e||!0===e?function(t){const e=t||se(5);return function(t,i){return i?t:void 0!==t?Math.abs(t)<=e?0:t:void 0}}():!1===e?Be:"number"==typeof e?function(t){const e=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/e+.5)*e:void 0}}(e):Be}return ze}(t);this.constraints_={center:i,resolution:n,rotation:s},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenter(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom),this.resolveConstraints(0),this.setProperties({}),this.options_=t}getUpdatedOptions_(t){const e=c({},this.options_);return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenter(),e.rotation=this.getRotation(),c({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0),this.animate_.apply(this,arguments)}animate_(t){let e,i=arguments.length;if(i>1&&"function"==typeof arguments[i-1]&&(e=arguments[i-1],--i),!this.isDef()){const t=arguments[i-1];return t.center&&this.setCenter(t.center),void 0!==t.zoom&&this.setZoom(t.zoom),void 0!==t.rotation&&this.setRotation(t.rotation),void(e&&Fn(e,!0))}let n=Date.now(),s=this.targetCenter_.slice(),r=this.targetResolution_,o=this.targetRotation_;const a=[];for(let t=0;t<i;++t){const i=arguments[t],h={start:n,complete:!1,anchor:i.anchor,duration:void 0!==i.duration?i.duration:1e3,easing:i.easing||ei,callback:e};if(i.center&&(h.sourceCenter=s,h.targetCenter=i.center.slice(),s=h.targetCenter),void 0!==i.zoom?(h.sourceResolution=r,h.targetResolution=this.getResolutionForZoom(i.zoom),r=h.targetResolution):i.resolution&&(h.sourceResolution=r,h.targetResolution=i.resolution,r=h.targetResolution),void 0!==i.rotation){h.sourceRotation=o;const t=re(i.rotation-o+Math.PI,2*Math.PI)-Math.PI;h.targetRotation=o+t,o=h.targetRotation}Dn(h)?h.complete=!0:n+=h.duration,a.push(h)}this.animations_.push(a),this.setHint(Ze.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ze.ANIMATING]>0}getInteracting(){return this.hints_[Ze.INTERACTING]>0}cancelAnimations(){this.setHint(Ze.ANIMATING,-this.hints_[Ze.ANIMATING]);for(let t=0,e=this.animations_.length;t<e;++t){const e=this.animations_[t];e[0].callback&&Fn(e[0].callback,!1)}this.animations_.length=0}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let s=!0;for(let i=0,r=n.length;i<r;++i){const r=n[i];if(r.complete)continue;const o=t-r.start;let a=r.duration>0?o/r.duration:1;a>=1?(r.complete=!0,a=1):s=!1;const h=r.easing(a);if(r.sourceCenter){const t=r.sourceCenter[0],e=r.sourceCenter[1],i=t+h*(r.targetCenter[0]-t),n=e+h*(r.targetCenter[1]-e);this.targetCenter_=[i,n]}if(r.sourceResolution&&r.targetResolution){const t=1===h?r.targetResolution:r.sourceResolution+h*(r.targetResolution-r.sourceResolution);if(r.anchor){const e=this.getSizeFromViewport_(this.getRotation()),i=this.constraints_.resolution(t,0,e,!0);this.targetCenter_=this.calculateCenterZoom(i,r.anchor)}this.targetResolution_=t,this.applyTargetState_(!0)}if(void 0!==r.sourceRotation&&void 0!==r.targetRotation){const t=1===h?re(r.targetRotation+Math.PI,2*Math.PI)-Math.PI:r.sourceRotation+h*(r.targetRotation-r.sourceRotation);if(r.anchor){const e=this.constraints_.rotation(t,!0);this.targetCenter_=this.calculateCenterRotate(e,r.anchor)}this.targetRotation_=t}if(this.applyTargetState_(!0),e=!0,!r.complete)break}if(s){this.animations_[i]=null,this.setHint(Ze.ANIMATING,-1);const t=n[0].callback;t&&Fn(t,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const n=this.getCenter();var s,r;return void 0!==n&&(qe(i=[n[0]-e[0],n[1]-e[1]],t-this.getRotation()),r=e,(s=i)[0]+=+r[0],s[1]+=+r[1]),i}calculateCenterZoom(t,e){let i;const n=this.getCenter(),s=this.getResolution();return void 0!==n&&void 0!==s&&(i=[e[0]-t*(e[0]-n[0])/s,e[1]-t*(e[1]-n[1])/s]),i}getSizeFromViewport_(t){const e=[100,100],i='.ol-viewport[data-view="'+r(this)+'"]',n=document.querySelector(i);if(n){const t=getComputedStyle(n);e[0]=parseInt(t.width,10),e[1]=parseInt(t.height,10)}if(t){const i=e[0],n=e[1];e[0]=Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),e[1]=Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t))}return e}getCenter(){return this.get(Ve.CENTER)}getConstraints(){return this.constraints_}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=t||this.getSizeFromViewport_(),i=this.getCenter();jt(i,1);const n=this.getResolution();jt(void 0!==n,2);const s=this.getRotation();return jt(void 0!==s,3),De(i,n,s,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Ve.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){const i=e||this.getSizeFromViewport_(),n=ke(t)/i[0],s=Ae(t)/i[1];return Math.max(n,s)}getResolutionForValueFunction(t){const e=t||2,i=this.maxResolution_,n=this.minResolution_,s=Math.log(i/n)/Math.log(e);return function(t){return i/Math.pow(e,t*s)}}getRotation(){return this.get(Ve.ROTATION)}getValueForResolutionFunction(t){const e=t||2,i=this.maxResolution_,n=this.minResolution_,s=Math.log(i/n)/Math.log(e);return function(t){return Math.log(i/t)/Math.log(e)/s}}getState(t){const e=this.getCenter(),i=this.getProjection(),n=this.getResolution(),s=this.getRotation();return{center:e.slice(0),projection:void 0!==i?i:null,resolution:n,rotation:s,zoom:this.getZoom()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e,i,n=this.minZoom_||0;if(this.resolutions_){const s=Ot(this.resolutions_,t,1);n=s,e=this.resolutions_[s],i=s==this.resolutions_.length-1?2:e/this.resolutions_[s+1]}else e=this.maxResolution_,i=this.zoomFactor_;return n+Math.log(e/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=te(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,te(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){const i=e||{};let n,s=i.size;s||(s=this.getSizeFromViewport_()),jt(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24),Array.isArray(t)?(jt(!Xe(t),25),n=On(t)):t.getType()===ni.CIRCLE?(n=On(t=t.getExtent())).rotate(this.getRotation(),Pe(t)):n=t;const r=void 0!==i.padding?i.padding:[0,0,0,0],o=void 0!==i.nearest&&i.nearest;let a;a=void 0!==i.minResolution?i.minResolution:void 0!==i.maxZoom?this.getResolutionForZoom(i.maxZoom):0;const h=n.getFlatCoordinates(),l=this.getRotation(),c=Math.cos(-l);let u=Math.sin(-l),d=1/0,g=1/0,_=-1/0,p=-1/0;const f=n.getStride();for(let t=0,e=h.length;t<e;t+=f){const e=h[t]*c-h[t+1]*u,i=h[t]*u+h[t+1]*c;d=Math.min(d,e),g=Math.min(g,i),_=Math.max(_,e),p=Math.max(p,i)}let m=this.getResolutionForExtent([d,g,_,p],[s[0]-r[1]-r[3],s[1]-r[0]-r[2]]);m=isNaN(m)?a:Math.max(m,a),m=this.getConstrainedResolution(m,o?0:1),u=-u;let v=(d+_)/2,y=(g+p)/2;const E=[(v+=(r[1]-r[3])/2*m)*c-(y+=(r[0]-r[2])/2*m)*u,y*c+v*u],x=i.callback?i.callback:S;void 0!==i.duration?this.animate_({resolution:m,center:this.getConstrainedCenter(E,m),duration:i.duration,easing:i.easing},x):(this.targetResolution_=m,this.targetCenter_=E,this.applyTargetState_(!1,!0),Fn(x,!0))}centerOn(t,e,i){const n=this.getRotation(),s=Math.cos(-n);let r=Math.sin(-n),o=t[0]*s-t[1]*r,a=t[1]*s+t[0]*r;const h=this.getResolution(),l=(o+=(e[0]/2-i[0])*h)*s-(a+=(i[1]-e[1]/2)*h)*(r=-r),c=a*s+o*r;this.setCenter([l,c])}isDef(){return!!this.getCenter()&&void 0!==this.getResolution()}adjustCenter(t){const e=this.targetCenter_;this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.getSizeFromViewport_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,n,i);void 0!==e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,i);void 0!==e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,i),s=this.getSizeFromViewport_(n),r=this.constraints_.resolution(this.targetResolution_,0,s,i),o=this.constraints_.center(this.targetCenter_,r,s,i);this.get(Ve.ROTATION)!==n&&this.set(Ve.ROTATION,n),this.get(Ve.RESOLUTION)!==r&&this.set(Ve.RESOLUTION,r),this.get(Ve.CENTER)&&He(this.get(Ve.CENTER),o)||this.set(Ve.CENTER,o),this.getAnimating()&&!t&&this.cancelAnimations()}resolveConstraints(t,e,i){const n=void 0!==t?t:200,s=e||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getSizeFromViewport_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),h=this.constraints_.center(this.targetCenter_,a,o);if(0===n)return this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=h,void this.applyTargetState_();this.getResolution()===a&&this.getRotation()===r&&this.getCenter()&&He(this.getCenter(),h)||(this.getAnimating()&&this.cancelAnimations(),this.animate_({rotation:r,center:h,resolution:a,duration:n,easing:ti,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ze.INTERACTING,1)}endInteraction(t,e,i){this.setHint(Ze.INTERACTING,-1),this.resolveConstraints(t,e,i)}getConstrainedCenter(t,e){const i=this.getSizeFromViewport_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i))}getConstrainedResolution(t,e){const i=e||0,n=this.getSizeFromViewport_(this.getRotation());return this.constraints_.resolution(t,i,n)}};function bn(t,e){const i=document.createElement("canvas");return t&&(i.width=t),e&&(i.height=e),i.getContext("2d")}function Nn(t,e){const i=e.parentNode;i&&i.replaceChild(t,e)}function Gn(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}var kn={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"};var Yn=class extends D{constructor(t){super();const e=c({},t);e[kn.OPACITY]=void 0!==t.opacity?t.opacity:1,e[kn.VISIBLE]=void 0===t.visible||t.visible,e[kn.Z_INDEX]=t.zIndex,e[kn.MAX_RESOLUTION]=void 0!==t.maxResolution?t.maxResolution:1/0,e[kn.MIN_RESOLUTION]=void 0!==t.minResolution?t.minResolution:0,this.className_=void 0!==e.className?t.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t};return e.opacity=te(Math.round(100*this.getOpacity())/100,0,1),e.sourceState=this.getSourceState(),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=this.getZIndex()||(!1===e.managed?1/0:0),e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),this.state_=e,e}getLayersArray(t){return n()}getLayerStatesArray(t){return n()}getExtent(){return this.get(kn.EXTENT)}getMaxResolution(){return this.get(kn.MAX_RESOLUTION)}getMinResolution(){return this.get(kn.MIN_RESOLUTION)}getOpacity(){return this.get(kn.OPACITY)}getSourceState(){return n()}getVisible(){return this.get(kn.VISIBLE)}getZIndex(){return this.get(kn.Z_INDEX)}setExtent(t){this.set(kn.EXTENT,t)}setMaxResolution(t){this.set(kn.MAX_RESOLUTION,t)}setMinResolution(t){this.set(kn.MIN_RESOLUTION,t)}setOpacity(t){this.set(kn.OPACITY,t)}setVisible(t){this.set(kn.VISIBLE,t)}setZIndex(t){this.set(kn.Z_INDEX,t)}},Xn={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"};const Kn={LAYERS:"layers"};var Un=class extends Yn{constructor(t){const e=t||{},i=c({},e);delete i.layers;let n=e.layers;super(i),this.layersListenerKeys_=[],this.listenerKeys_={},v(this,F(Kn.LAYERS),this.handleLayersChanged_,this),n?Array.isArray(n)?n=new N(n.slice(),{unique:!0}):jt("function"==typeof n.getArray,43):n=new N(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(x),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(v(t,h.ADD,this.handleLayersAdd_,this),v(t,h.REMOVE,this.handleLayersRemove_,this));for(const t in this.listenerKeys_)this.listenerKeys_[t].forEach(x);u(this.listenerKeys_);const e=t.getArray();for(let t=0,i=e.length;t<i;t++){const i=e[t];this.listenerKeys_[r(i)]=[v(i,l.PROPERTYCHANGE,this.handleLayerChange_,this),v(i,L.CHANGE,this.handleLayerChange_,this)]}this.changed()}handleLayersAdd_(t){const e=t.element;this.listenerKeys_[r(e)]=[v(e,l.PROPERTYCHANGE,this.handleLayerChange_,this),v(e,L.CHANGE,this.handleLayerChange_,this)],this.changed()}handleLayersRemove_(t){const e=r(t.element);this.listenerKeys_[e].forEach(x),delete this.listenerKeys_[e],this.changed()}getLayers(){return this.get(Kn.LAYERS)}setLayers(t){this.set(Kn.LAYERS,t)}getLayersArray(t){const e=void 0!==t?t:[];return this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(t){const e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(e)});const n=this.getLayerState();for(let t=i,s=e.length;t<s;t++){const i=e[t];i.opacity*=n.opacity,i.visible=i.visible&&n.visible,i.maxResolution=Math.min(i.maxResolution,n.maxResolution),i.minResolution=Math.max(i.minResolution,n.minResolution),void 0!==n.extent&&(void 0!==i.extent?i.extent=be(i.extent,n.extent):i.extent=n.extent)}return e}getSourceState(){return Xn.READY}};function Wn(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:e[0]=e[1]=t,e)}var zn=class extends D{constructor(t){super();const e=function(t){let e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);const i={},n=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new Un({layers:t.layers});let s,r,o;return i[Bt.LAYERGROUP]=n,i[Bt.TARGET]=t.target,i[Bt.VIEW]=void 0!==t.view?t.view:new An,void 0!==t.controls&&(Array.isArray(t.controls)?s=new N(t.controls.slice()):(jt("function"==typeof t.controls.getArray,47),s=t.controls)),void 0!==t.interactions&&(Array.isArray(t.interactions)?r=new N(t.interactions.slice()):(jt("function"==typeof t.interactions.getArray,48),r=t.interactions)),void 0!==t.overlays?Array.isArray(t.overlays)?o=new N(t.overlays.slice()):(jt("function"==typeof t.overlays.getArray,49),o=t.overlays):o=new N,{controls:s,interactions:r,keyboardEventTarget:e,overlays:o,values:i}}(t);this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:z,this.animationDelayKey_,this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+(B?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.viewport_.style.msTouchAction="none",this.viewport_.style.touchAction="none",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=new Wt(this,t.moveTolerance);for(const t in j)v(this.mapBrowserEventHandler_,j[t],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=e.keyboardEventTarget,this.keyHandlerKeys_=null,v(this.viewport_,L.CONTEXTMENU,this.handleBrowserEvent,this),v(this.viewport_,L.WHEEL,this.handleBrowserEvent,this),v(this.viewport_,L.MOUSEWHEEL,this.handleBrowserEvent,this),this.controls=e.controls||new N,this.interactions=e.interactions||new N,this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=this.createRenderer(),this.handleResize_,this.focus_=null,this.postRenderFunctions_=[],this.tileQueue_=new Jt(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.skippedFeatureUids_={},v(this,F(Bt.LAYERGROUP),this.handleLayerGroupChanged_,this),v(this,F(Bt.VIEW),this.handleViewChanged_,this),v(this,F(Bt.SIZE),this.handleSizeChanged_,this),v(this,F(Bt.TARGET),this.handleTargetChanged_,this),this.setProperties(e.values),this.controls.forEach(function(t){t.setMap(this)}.bind(this)),v(this.controls,h.ADD,function(t){t.element.setMap(this)},this),v(this.controls,h.REMOVE,function(t){t.element.setMap(null)},this),this.interactions.forEach(function(t){t.setMap(this)}.bind(this)),v(this.interactions,h.ADD,function(t){t.element.setMap(this)},this),v(this.interactions,h.REMOVE,function(t){t.element.setMap(null)},this),this.overlays_.forEach(this.addOverlayInternal_.bind(this)),v(this.overlays_,h.ADD,function(t){this.addOverlayInternal_(t.element)},this),v(this.overlays_,h.REMOVE,function(t){const e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)},this)}createRenderer(){throw new Error("Use a map type that has a createRenderer method")}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.mapBrowserEventHandler_.dispose(),E(this.viewport_,L.CONTEXTMENU,this.handleBrowserEvent,this),E(this.viewport_,L.WHEEL,this.handleBrowserEvent,this),E(this.viewport_,L.MOUSEWHEEL,this.handleBrowserEvent,this),void 0!==this.handleResize_&&(removeEventListener(L.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_)return;const n=this.getCoordinateFromPixel(t),s=void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance*this.frameState_.pixelRatio:0,r=void 0!==i.layerFilter?i.layerFilter:C;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,s,e,null,r,null)}getFeaturesAtPixel(t,e){let i=null;return this.forEachFeatureAtPixel(t,function(t){i||(i=[]),i.push(t)},e),i}forEachLayerAtPixel(t,e,i){if(!this.frameState_)return;const n=i||{},s=void 0!==n.hitTolerance?i.hitTolerance*this.frameState_.pixelRatio:0,r=n.layerFilter||C;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,s,e,r)}hasFeatureAtPixel(t,e){if(!this.frameState_)return!1;const i=this.getCoordinateFromPixel(t),n=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:C,s=void 0!==e.hitTolerance?e.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,s,n,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),i="changedTouches"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]}getTarget(){return this.get(Bt.TARGET)}getTargetElement(){const t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null}getCoordinateFromPixel(t){const e=this.frameState_;return e?Ui(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Bt.LAYERGROUP)}getLayers(){return this.getLayerGroup().getLayers()}getPixelFromCoordinate(t){const e=this.frameState_;return e?Ui(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Bt.SIZE)}getView(){return this.get(Bt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getTilePriority(t,e,i,n){const s=this.frameState_;if(!(s&&e in s.wantedTiles))return Ht;if(!s.wantedTiles[e][t.getKey()])return Ht;const r=i[0]-s.focus[0],o=i[1]-s.focus[1];return 65536*Math.log(n)+Math.sqrt(r*r+o*o)/n}handleBrowserEvent(t,e){const i=e||t.type,n=new k(i,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;let e=t.originalEvent.target;for(;e instanceof HTMLElement;){if(e.parentElement===this.overlayContainerStopEvent_)return;e=e.parentElement}this.focus_=t.coordinate,t.frameState=this.frameState_;const i=this.getInteractions().getArray();if(!1!==this.dispatchEvent(t))for(let e=i.length-1;e>=0;e--){const n=i[e];if(n.getActive()&&!n.handleEvent(t))break}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let i=this.maxTilesLoading_,n=i;if(t){const e=t.viewHints;if(e[Ze.ANIMATING]||e[Ze.INTERACTING]){const e=Date.now()-t.time>8;i=e?0:8,n=e?0:2}}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,n))}!t||!this.hasListener(Zt.RENDERCOMPLETE)||t.animate||this.tileQueue_.getTilesLoading()||function t(e){for(let i=0,n=e.length;i<n;++i){const n=e[i];if("function"==typeof n.getLayers)return t(n.getLayers().getArray());{const t=n.getSource();if(t&&t.loading)return!0}}return!1}(this.getLayers().getArray())||this.renderer_.dispatchRenderEvent(Zt.RENDERCOMPLETE,t);const i=this.postRenderFunctions_;for(let e=0,n=i.length;e<n;++e)i[e](this,t);i.length=0}handleSizeChanged_(){this.getView()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){let t;if(this.getTarget()&&(t=this.getTargetElement()),this.keyHandlerKeys_){for(let t=0,e=this.keyHandlerKeys_.length;t<e;++t)x(this.keyHandlerKeys_[t]);this.keyHandlerKeys_=null}if(t){t.appendChild(this.viewport_);const e=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[v(e,L.KEYDOWN,this.handleBrowserEvent,this),v(e,L.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),addEventListener(L.RESIZE,this.handleResize_,!1))}else this.renderer_.removeLayerRenderers(),Gn(this.viewport_),void 0!==this.handleResize_&&(removeEventListener(L.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(x(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(x(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.viewport_.setAttribute("data-view",r(t)),this.viewPropertyListenerKey_=v(t,l.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=v(t,L.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(x),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.layerGroupPropertyListenerKeys_=[v(t,l.PROPERTYCHANGE,this.render,this),v(t,L.CHANGE,this.render,this)]),this.render()}isRendered(){return!!this.frameState_}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}render(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){let e;const i=this.getSize(),n=this.getView(),s=[1/0,1/0,-1/0,-1/0],r=this.frameState_;let o=null;if(void 0!==i&&function(t){return t[0]>0&&t[1]>0}(i)&&n&&n.isDef()){const a=n.getHints(this.frameState_?this.frameState_.viewHints:void 0);e=n.getState(this.pixelRatio_),o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterItems:r?r.declutterItems:[],extent:s,focus:this.focus_?this.focus_:e.center,index:this.frameIndex_++,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:e,viewHints:a,wantedTiles:{}}}o&&(o.extent=De(e.center,e.resolution,e.rotation,o.size,s)),this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),r&&(!this.previousExtent_||!Xe(this.previousExtent_)&&!Te(o.extent,this.previousExtent_))&&(this.dispatchEvent(new G(zt.MOVESTART,this,r)),this.previousExtent_=Ee(this.previousExtent_)),this.previousExtent_&&!o.viewHints[Ze.ANIMATING]&&!o.viewHints[Ze.INTERACTING]&&!Te(o.extent,this.previousExtent_)&&(this.dispatchEvent(new G(zt.MOVEEND,this,o)),de(o.extent,this.previousExtent_))),this.dispatchEvent(new G(zt.POSTRENDER,this,o)),setTimeout(this.handlePostRender.bind(this),0)}setLayerGroup(t){this.set(Bt.LAYERGROUP,t)}setSize(t){this.set(Bt.SIZE,t)}setTarget(t){this.set(Bt.TARGET,t)}setView(t){this.set(Bt.VIEW,t)}skipFeature(t){this.skippedFeatureUids_[r(t)]=!0,this.render()}updateSize(){const t=this.getTargetElement();if(t){const e=getComputedStyle(t);this.setSize([t.offsetWidth-parseFloat(e.borderLeftWidth)-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderRightWidth),t.offsetHeight-parseFloat(e.borderTopWidth)-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom)-parseFloat(e.borderBottomWidth)])}else this.setSize(void 0)}unskipFeature(t){delete this.skippedFeatureUids_[r(t)],this.render()}};var Bn=class extends D{constructor(t){super(),this.element=t.element?t.element:null,this.target_=null,this.map_=null,this.listenerKeys=[],this.render=t.render?t.render:S,t.target&&this.setTarget(t.target)}disposeInternal(){Gn(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Gn(this.element);for(let t=0,e=this.listenerKeys.length;t<e;++t)x(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=t,this.map_&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==S&&this.listenerKeys.push(v(t,zt.POSTRENDER,this.render,this)),t.render())}setTarget(t){this.target_="string"==typeof t?document.getElementById(t):t}};const Zn="ol-hidden",Vn="ol-unselectable",jn="ol-control",Hn="ol-collapsed",qn=function(){let t;const e={};return function(i){if(t||(t=document.createElement("div").style),!(i in e)){t.font=i;const n=t.fontFamily;if(t.font="",!n)return null;e[i]=n.split(/,\s?/)}return e[i]}}();function Jn(t,e){return t.visible&&e>=t.minResolution&&e<t.maxResolution}var Qn=class extends Yn{constructor(t){const e=c({},t);delete e.source,super(e),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),v(this,F(kn.SOURCE),this.handleSourcePropertyChange_,this);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){const e=t||[];return e.push(this),e}getLayerStatesArray(t){const e=t||[];return e.push(this.getLayerState()),e}getSource(){return this.get(kn.SOURCE)||null}getSourceState(){const t=this.getSource();return t?t.getState():Xn.UNDEFINED}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(x(this.sourceChangeKey_),this.sourceChangeKey_=null);const t=this.getSource();t&&(this.sourceChangeKey_=v(t,L.CHANGE,this.handleSourceChange_,this)),this.changed()}render(t){const e=this.getRenderer(),i=this.getLayerState();if(e.prepareFrame(t,i))return e.renderFrame(t,i)}setMap(t){this.mapPrecomposeKey_&&(x(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(x(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=v(t,Zt.PRECOMPOSE,function(t){t.frameState.layerStatesArray.push(this.getLayerState(!1))},this),this.mapRenderKey_=v(this,L.CHANGE,t.render,t),this.changed())}setSource(t){this.set(kn.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}createRenderer(){return null}};function $n(t){this.updateElement_(t.frameState)}var ts=class extends Bn{constructor(t){const e=t||{};super({element:document.createElement("div"),render:e.render||$n,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===e.collapsed||e.collapsed,this.overrideCollapsible_=void 0!==e.collapsible,this.collapsible_=void 0===e.collapsible||e.collapsible,this.collapsible_||(this.collapsed_=!1);const i=void 0!==e.className?e.className:"ol-attribution",n=void 0!==e.tipLabel?e.tipLabel:"Attributions",s=void 0!==e.collapseLabel?e.collapseLabel:"";"string"==typeof s?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s):this.collapseLabel_=s;const r=void 0!==e.label?e.label:"i";"string"==typeof r?(this.label_=document.createElement("span"),this.label_.textContent=r):this.label_=r;const o=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=n,a.appendChild(o),v(a,L.CLICK,this.handleClick_,this);const h=i+" "+Vn+" "+jn+(this.collapsed_&&this.collapsible_?" "+Hn:"")+(this.collapsible_?"":" ol-uncollapsible"),l=this.element;l.className=h,l.appendChild(this.ulElement_),l.appendChild(a),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},i=[],n=t.layerStatesArray,s=t.viewState.resolution;for(let r=0,o=n.length;r<o;++r){const o=n[r];if(!Jn(o,s))continue;const a=o.layer.getSource();if(!a)continue;const h=a.getAttributions();if(!h)continue;const l=h(t);if(l)if(this.overrideCollapsible_||!1!==a.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(l))for(let t=0,n=l.length;t<n;++t)l[t]in e||(i.push(l[t]),e[l[t]]=!0);else l in e||(i.push(l),e[l]=!0)}return i}updateElement_(t){if(!t)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Dt(e,this.renderedAttributions_)){!function(t){for(;t.lastChild;)t.removeChild(t.lastChild)}(this.ulElement_);for(let t=0,i=e.length;t<i;++t){const i=document.createElement("li");i.innerHTML=e[t],this.ulElement_.appendChild(i)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Hn),this.collapsed_?Nn(this.collapseLabel_,this.label_):Nn(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),!t&&this.collapsed_&&this.handleToggle_())}setCollapsed(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}};function es(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const t="rotate("+i+"rad)";if(this.autoHide_){const t=this.element.classList.contains(Zn);t||0!==i?t&&0!==i&&this.element.classList.remove(Zn):this.element.classList.add(Zn)}this.label_.style.transform=t}this.rotation_=i}var is=class extends Bn{constructor(t){const e=t||{};super({element:document.createElement("div"),render:e.render||es,target:e.target});const i=void 0!==e.className?e.className:"ol-rotate",n=void 0!==e.label?e.label:"";this.label_=null,"string"==typeof n?(this.label_=document.createElement("span"),this.label_.className="ol-compass",this.label_.textContent=n):(this.label_=n,this.label_.classList.add("ol-compass"));const s=e.tipLabel?e.tipLabel:"Reset rotation",r=document.createElement("button");r.className=i+"-reset",r.setAttribute("type","button"),r.title=s,r.appendChild(this.label_),v(r,L.CLICK,this.handleClick_,this);const o=i+" "+Vn+" "+jn,a=this.element;a.className=o,a.appendChild(r),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=void 0!==e.duration?e.duration:250,this.autoHide_=void 0===e.autoHide||e.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Zn)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();t&&void 0!==t.getRotation()&&(this.duration_>0?t.animate({rotation:0,duration:this.duration_,easing:ti}):t.setRotation(0))}};var ns=class extends Bn{constructor(t){const e=t||{};super({element:document.createElement("div"),target:e.target});const i=void 0!==e.className?e.className:"ol-zoom",n=void 0!==e.delta?e.delta:1,s=void 0!==e.zoomInLabel?e.zoomInLabel:"+",r=void 0!==e.zoomOutLabel?e.zoomOutLabel:"",o=void 0!==e.zoomInTipLabel?e.zoomInTipLabel:"Zoom in",a=void 0!==e.zoomOutTipLabel?e.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=i+"-in",h.setAttribute("type","button"),h.title=o,h.appendChild("string"==typeof s?document.createTextNode(s):s),v(h,L.CLICK,this.handleClick_.bind(this,n));const l=document.createElement("button");l.className=i+"-out",l.setAttribute("type","button"),l.title=a,l.appendChild("string"==typeof r?document.createTextNode(r):r),v(l,L.CLICK,this.handleClick_.bind(this,-n));const c=i+" "+Vn+" "+jn,u=this.element;u.className=c,u.appendChild(h),u.appendChild(l),this.duration_=void 0!==e.duration?e.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const i=e.getZoom();if(void 0!==i){const n=e.getConstrainedZoom(i+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:n,duration:this.duration_,easing:ti})):e.setZoom(n)}}};var ss=class{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;const s=this.points_[e]-this.points_[i],r=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(r,s),this.initialVelocity_=Math.sqrt(s*s+r*r)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},rs={ACTIVE:"active"};function os(t,e,i,n){const s=t.getZoom();if(void 0===s)return;const r=t.getConstrainedZoom(s+e),o=t.getResolutionForZoom(r);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:o,anchor:i,duration:void 0!==n?n:250,easing:ti})}var as=class extends D{constructor(t){super(),t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(rs.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(rs.ACTIVE,t)}setMap(t){this.map_=t}};function hs(t){let e=!1;if(t.type==j.DBLCLICK){const i=t.originalEvent,n=t.map,s=t.coordinate,r=i.shiftKey?-this.delta_:this.delta_;os(n.getView(),r,s,this.duration_),t.preventDefault(),e=!0}return!e}var ls=class extends as{constructor(t){super({handleEvent:hs});const e=t||{};this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:250}};const cs=function(t){const e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},us=function(t){const e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},ds=function(t){return t.target.getTargetElement()===document.activeElement},gs=C,_s=function(t){const e=t.originalEvent;return 0==e.button&&!(U&&W&&e.ctrlKey)},ps=function(t){return t.type==j.SINGLECLICK},fs=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},ms=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},vs=function(t){const e=t.originalEvent.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e},ys=function(t){const e=t.pointerEvent;return jt(void 0!==e,56),"mouse"==e.pointerType},Es=function(t){const e=t.pointerEvent;return jt(void 0!==e,56),e.isPrimary&&0===e.button};function xs(t){const e=t.length;let i=0,n=0;for(let s=0;s<e;s++)i+=t[s].clientX,n+=t[s].clientY;return[i/e,n/e]}var Ts=class extends as{constructor(t){const e=t||{};super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.trackedPointers_={},this.targetPointers=[]}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.pointerEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==j.POINTERDRAG)this.handleDragEvent(t);else if(t.type==j.POINTERUP){const e=this.handleUpEvent(t);this.handlingDownUpSequence=e&&this.targetPointers.length>0}}else if(t.type==j.POINTERDOWN){const i=this.handleDownEvent(t);i&&t.preventDefault(),this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==j.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){if(function(t){const e=t.type;return e===j.POINTERDOWN||e===j.POINTERDRAG||e===j.POINTERUP}(t)){const e=t.pointerEvent,i=e.pointerId.toString();t.type==j.POINTERUP?delete this.trackedPointers_[i]:t.type==j.POINTERDOWN?this.trackedPointers_[i]=e:i in this.trackedPointers_&&(this.trackedPointers_[i]=e),this.targetPointers=d(this.trackedPointers_)}}};var Cs=class extends Ts{constructor(t){super({stopDown:R});const e=t||{};this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1,this.condition_=e.condition?e.condition:fs,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,i=xs(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const e=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],r=t.map.getView();n=e,s=r.getResolution(),n[0]*=s,n[1]*=s,qe(e,r.getRotation()),r.adjustCenter(e)}}else this.kinetic_&&this.kinetic_.begin();var n,s;this.lastCentroid=i,this.lastPointersCount_=e.length}handleUpEvent(t){const e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const t=this.kinetic_.getDistance(),n=this.kinetic_.getAngle(),s=i.getCenter(),r=e.getPixelFromCoordinate(s),o=e.getCoordinateFromPixel([r[0]-t*Math.cos(n),r[1]-t*Math.sin(n)]);i.animate({center:i.getConstrainedCenter(o),duration:500,easing:ti})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}};var Rs=class extends Ts{constructor(t){const e=t||{};super({stopDown:R}),this.condition_=e.condition?e.condition:us,this.lastAngle_=void 0,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(t){if(!ys(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===ze)return;const n=e.getSize(),s=t.pixel,r=Math.atan2(n[1]/2-s[1],s[0]-n[0]/2);if(void 0!==this.lastAngle_){const t=r-this.lastAngle_;i.adjustRotation(-t)}this.lastAngle_=r}handleUpEvent(t){return!ys(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!!ys(t)&&(!(!_s(t)||!this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))}};var Ss=class extends T{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i=this.element_.style;i.left=Math.min(t[0],e[0])+"px",i.top=Math.min(t[1],e[1])+"px",i.width=Math.abs(e[0]-t[0])+"px",i.height=Math.abs(e[1]-t[1])+"px"}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left=t.top=t.width=t.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixel,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new Mn([i])}getGeometry(){return this.geometry_}};const Is={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"};class ws extends I{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}var Ls=class extends Ts{constructor(t){super();const e=t||{};this.box_=new Ss(e.className||"ol-dragbox"),this.minArea_=void 0!==e.minArea?e.minArea:64,this.onBoxEnd_=e.onBoxEnd?e.onBoxEnd:S,this.startPixel_=null,this.condition_=e.condition?e.condition:gs,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const n=i[0]-e[0],s=i[1]-e[1];return n*n+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){ys(t)&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new ws(Is.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){return!ys(t)||(this.box_.setMap(null),this.boxEndCondition_(t,this.startPixel_,t.pixel)&&(this.onBoxEnd_(t),this.dispatchEvent(new ws(Is.BOXEND,t.coordinate,t))),!1)}handleDownEvent(t){return!(!ys(t)||!_s(t)||!this.condition_(t)||(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ws(Is.BOXSTART,t.coordinate,t)),0))}};function Ms(){const t=this.getMap(),e=t.getView(),i=t.getSize();let n=this.getGeometry().getExtent();if(this.out_){const o=e.calculateExtent(i),a=(s=[t.getPixelFromCoordinate(Me(n)),t.getPixelFromCoordinate(Ge(n))],Se(Ee(r),s));!function(t,e){const i=(t[2]-t[0])/2*(e-1),n=(t[3]-t[1])/2*(e-1);t[0]-=i,t[2]+=i,t[1]-=n,t[3]+=n}(o,1/e.getResolutionForExtent(a,i)),n=o}var s,r;const o=e.getConstrainedResolution(e.getResolutionForExtent(n,i)),a=e.getConstrainedCenter(Pe(n),o);e.animate({resolution:o,center:a,duration:this.duration_,easing:ti})}var Os=class extends Ls{constructor(t){const e=t||{};super({condition:e.condition?e.condition:ms,className:e.className||"ol-dragzoom",onBoxEnd:Ms}),this.duration_=void 0!==e.duration?e.duration:200,this.out_=void 0!==e.out&&e.out}},Ps={LEFT:37,UP:38,RIGHT:39,DOWN:40};function Fs(t){let e=!1;if(t.type==L.KEYDOWN){const i=t.originalEvent.keyCode;if(this.condition_(t)&&(i==Ps.DOWN||i==Ps.LEFT||i==Ps.RIGHT||i==Ps.UP)){const n=t.map.getView(),s=n.getResolution()*this.pixelDelta_;let r=0,o=0;i==Ps.DOWN?o=-s:i==Ps.LEFT?r=-s:i==Ps.RIGHT?r=s:o=s;const a=[r,o];qe(a,n.getRotation()),function(t,e,i){const n=t.getCenter();if(n){const s=[n[0]+e[0],n[1]+e[1]];t.animate_({duration:void 0!==i?i:250,easing:ii,center:t.getConstrainedCenter(s)})}}(n,a,this.duration_),t.preventDefault(),e=!0}}return!e}var Ds=class extends as{constructor(t){super({handleEvent:Fs});const e=t||{};this.defaultCondition_=function(t){return fs(t)&&vs(t)},this.condition_=void 0!==e.condition?e.condition:this.defaultCondition_,this.duration_=void 0!==e.duration?e.duration:100,this.pixelDelta_=void 0!==e.pixelDelta?e.pixelDelta:128}};function As(t){let e=!1;if(t.type==L.KEYDOWN||t.type==L.KEYPRESS){const i=t.originalEvent.charCode;if(this.condition_(t)&&(i=="+".charCodeAt(0)||i=="-".charCodeAt(0))){const n=t.map,s=i=="+".charCodeAt(0)?this.delta_:-this.delta_;os(n.getView(),s,void 0,this.duration_),t.preventDefault(),e=!0}}return!e}var bs=class extends as{constructor(t){super({handleEvent:As});const e=t||{};this.condition_=e.condition?e.condition:vs,this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:100}};const Ns={TRACKPAD:"trackpad",WHEEL:"wheel"};var Gs=class extends as{constructor(t){const e=t||{};super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==e.maxDelta?e.maxDelta:1,this.duration_=void 0!==e.duration?e.duration:250,this.timeout_=void 0!==e.timeout?e.timeout:80,this.useAnchor_=void 0===e.useAnchor||e.useAnchor,this.condition_=e.condition?e.condition:gs,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.trackpadDeltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0,this.getMap().getView().endInteraction(void 0,Math.sign(this.lastDelta_),this.lastAnchor_)}handleEvent(t){if(!this.condition_(t))return!0;const e=t.type;if(e!==L.WHEEL&&e!==L.MOUSEWHEEL)return!0;t.preventDefault();const i=t.map,n=t.originalEvent;let s;if(this.useAnchor_&&(this.lastAnchor_=t.coordinate),t.type==L.WHEEL?(s=n.deltaY,X&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=z),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)):t.type==L.MOUSEWHEEL&&(s=-n.wheelDeltaY,K&&(s/=3)),0===s)return!1;this.lastDelta_=s;const r=Date.now();if(void 0===this.startTime_&&(this.startTime_=r),(!this.mode_||r-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?Ns.TRACKPAD:Ns.WHEEL),this.mode_===Ns.TRACKPAD){const t=i.getView();return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):t.beginInteraction(),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.trackpadEventGap_),t.adjustZoom(-s/this.trackpadDeltaPerZoom_,this.lastAnchor_),this.startTime_=r,!1}this.totalDelta_+=s;const o=Math.max(this.timeout_-(r-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),o),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations(),os(e,-te(this.totalDelta_,-this.maxDelta_,this.maxDelta_),this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}};var ks=class extends Ts{constructor(t){const e=t||{},i=e;i.stopDown||(i.stopDown=R),super(i),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==e.threshold?e.threshold:.3,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],n=this.targetPointers[1],s=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(void 0!==this.lastAngle_){const t=s-this.lastAngle_;this.rotationDelta_+=t,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=t}this.lastAngle_=s;const r=t.map,o=r.getView();if(o.getConstraints().rotation===ze)return;const a=r.getViewport().getBoundingClientRect(),h=xs(this.targetPointers);h[0]-=a.left,h[1]-=a.top,this.anchor_=r.getCoordinateFromPixel(h),this.rotating_&&(r.render(),o.adjustRotation(e,this.anchor_))}handleUpEvent(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};var Ys=class extends Ts{constructor(t){const e=t||{},i=e;i.stopDown||(i.stopDown=R),super(i),this.anchor_=null,this.duration_=void 0!==e.duration?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],n=this.targetPointers[1],s=i.clientX-n.clientX,r=i.clientY-n.clientY,o=Math.sqrt(s*s+r*r);void 0!==this.lastDistance_&&(e=this.lastDistance_/o),this.lastDistance_=o;const a=t.map,h=a.getView();1!=e&&(this.lastScaleDelta_=e);const l=a.getViewport().getBoundingClientRect(),c=xs(this.targetPointers);c[0]-=l.left,c[1]-=l.top,this.anchor_=a.getCoordinateFromPixel(c),a.render(),h.adjustResolution(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const e=t.map.getView(),i=this.lastScaleDelta_>1?1:-1;return e.endInteraction(this.duration_,i),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};var Xs=class extends I{constructor(t,e,i,n,s){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=n,this.glContext=s}};const Ks=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Us=/^([a-z]*)$/i;!function(){const t={};let e=0}();function Ws(t){return t[0]=te(t[0]+.5|0,0,255),t[1]=te(t[1]+.5|0,0,255),t[2]=te(t[2]+.5|0,0,255),t[3]=te(t[3],0,1),t}function zs(t){let e=t[0];e!=(0|e)&&(e=e+.5|0);let i=t[1];i!=(0|i)&&(i=i+.5|0);let n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+i+","+n+","+(void 0===t[3]?1:t[3])+")"}class Bs{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];0!=(3&t++)||i.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const n=Zs(t,e,i);return n in this.cache_?this.cache_[n]:null}set(t,e,i,n){const s=Zs(t,e,i);this.cache_[s]=n,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Zs(t,e,i){return e+":"+t+":"+(i?function(t){return"string"==typeof t?t:zs(t)}(i):"null")}const Vs=new Bs;function js(t){return Array.isArray(t)?zs(t):t}var Hs=class{drawCustom(t,e,i){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}};var qs=class extends w{constructor(t){super(),this.highWaterMark=void 0!==t?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.getCount()>this.highWaterMark}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(L.CLEAR)}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return jt(void 0!==i,15),i===this.newest_?i.value_:(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i,i.value_)}remove(t){const e=this.entries_[t];return jt(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.key_;return t}getValues(){const t=new Array(this.count_);let e,i=0;for(e=this.newest_;e;e=e.older)t[i++]=e.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){jt(!(t in this.entries_),16);const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}};const Js="10px sans-serif",Qs="#000",$s="round",tr=[],er=0,ir="round",nr=10,sr="#000",rr="center",or="middle",ar=[0,0,0,0],hr=1,lr=new class extends qs{constructor(t){super(t),this.consumers={}}clear(){super.clear(),this.consumers={}}get(t,e){const i=super.get(t),n=r(e);return n in this.consumers||(this.consumers[n]={}),this.consumers[n][t]=!0,i}prune(){t:for(;this.canExpireCache();){const t=this.peekLastKey();for(const e in this.consumers)if(t in this.consumers[e])break t;const e=this.pop();e.width=e.height=0;for(const e in this.consumers)delete this.consumers[e][t]}}release(t){delete this.consumers[r(t)]}},cr={};let ur=null;const dr={},gr=function(){const t=60,e=cr,i="32px ",n=["monospace","serif"],s=n.length,r="wmytzilWMYTZIL@#/&?$%10";let o,a;function h(t){const e=_r();for(let o=100;o<=700;o+=300){const h=o+" ";let l=!0;for(let o=0;o<s;++o){const s=n[o];if(e.font=h+i+s,a=e.measureText(r).width,t!=s){e.font=h+i+t+","+s;const n=e.measureText(r).width;l=l&&n!=a}}if(l)return!0}return!1}function l(){let i=!0;for(const n in e)e[n]<t&&(h(n)?(e[n]=t,u(dr),ur=null,lr.clear()):(++e[n],i=!1));i&&(clearInterval(o),o=void 0)}return function(i){const n=qn(i);if(n)for(let i=0,s=n.length;i<s;++i){const s=n[i];s in e||(e[s]=t,h(s)||(e[s]=0,void 0===o&&(o=setInterval(l,32))))}}}();function _r(){return ur||(ur=bn(1,1)),ur}const pr=function(){let t;const e=dr;return function(i){let n=e[i];return null==n&&(t||((t=document.createElement("div")).innerHTML="M",t.style.margin=t.style.padding="0 !important",t.style.position="absolute !important",t.style.left="-99999px !important"),t.style.font=i,document.body.appendChild(t),n=e[i]=t.offsetHeight,document.body.removeChild(t)),n}}();function fr(t,e){const i=_r();return t!=i.font&&(i.font=t),i.measureText(e).width}function mr(t,e,i){if(e in i)return i[e];return i[e]=fr(t,e)}function vr(t,e,i,n){0!==e&&(t.translate(i,n),t.rotate(e),t.translate(-i,-n))}const yr=[1,0,0,1,0,0];function Er(t,e,i,n,s,r,o,a,h,l,c){let u;1!=i&&(u=t.globalAlpha,t.globalAlpha=u*i),e&&t.setTransform.apply(t,e),t.drawImage(n,s,r,o,a,h,l,o*c,a*c),u&&(t.globalAlpha=u),e&&t.setTransform.apply(t,yr)}function xr(t,e){Vs.expire()}var Tr=class extends T{constructor(t){super(),this.map_=t,this.declutterTree_=null,this.layerRenderers_={},this.layerRendererListeners_={}}dispatchRenderEvent(t,e){n()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;Wi(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),zi(n,i)}removeLayerRenderers(){for(const t in this.layerRenderers_)this.removeLayerRendererByKey_(t).dispose()}forEachFeatureAtCoordinate(t,e,i,n,s,o,a){let h;const l=e.viewState,c=l.resolution;function u(t,i,o){if(!(r(i)in e.skippedFeatureUids)||t)return n.call(s,i,t?o:null)}const d=l.projection;let g=t;if(d.canWrapX()){const e=d.getExtent(),i=ke(e),n=t[0];(n<e[0]||n>e[2])&&(g=[n+i*Math.ceil((e[0]-n)/i),t[1]])}const _=e.layerStatesArray,p=_.length;let f,m;for(this.declutterTree_&&(f=this.declutterTree_.all().map(function(t){return t.value})),m=p-1;m>=0;--m){const n=_[m],s=n.layer;if(Jn(n,c)&&o.call(a,s)){const r=this.getLayerRenderer(s),o=s.getSource();if(r&&o){const s=u.bind(null,n.managed);h=r.forEachFeatureAtCoordinate(o.getWrapX()?g:t,e,i,s,f)}if(h)return h}}}forEachLayerAtPixel(t,e,i,s,r){return n()}hasFeatureAtCoordinate(t,e,i,n,s){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,C,this,n,s)}getLayerRenderer(t){const e=r(t);if(e in this.layerRenderers_)return this.layerRenderers_[e];const i=t.getRenderer();return i?(this.layerRenderers_[e]=i,this.layerRendererListeners_[e]=v(i,L.CHANGE,this.handleLayerRendererChange_,this),i):null}getLayerRenderers(){return this.layerRenderers_}getMap(){return this.map_}handleLayerRendererChange_(){this.map_.render()}removeLayerRendererByKey_(t){const e=this.layerRenderers_[t];return delete this.layerRenderers_[t],x(this.layerRendererListeners_[t]),delete this.layerRendererListeners_[t],e}renderFrame(t){this.declutterTree_=function(t,e){e&&e.clear();const i=t.declutterItems;for(let t=i.length-1;t>=0;--t){const n=i[t];for(let t=0,i=n.length;t<i;t+=3)e=n[t].renderDeclutter(n[t+1],n[t+2],e)}return i.length=0,e}(t,this.declutterTree_)}scheduleExpireIconCache(t){Vs.canExpireCache()&&t.postRenderFunctions.push(xr)}scheduleRemoveUnusedLayerRenderers(t){const e=t.layerStatesArray.reduce(function(t,e){return t[r(e.layer)]=e,t},{});for(const i in this.layerRenderers_)i in e||t.postRenderFunctions.push(function(){this.removeLayerRendererByKey_(i).dispose()}.bind(this))}};var Cr=class extends Tr{constructor(t){super(t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Vn+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const n=new Xs(t,void 0,e);i.dispatchEvent(n)}}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent(Zt.PRECOMPOSE,t);const e=t.layerStatesArray,i=t.viewState.resolution;this.children_.length=0;for(let n=0,s=e.length;n<s;++n){const s=e[n];if(!Jn(s,i)||s.sourceState!=Xn.READY&&s.sourceState!=Xn.UNDEFINED)continue;const r=s.layer.render(t);if(r){const t=s.zIndex;t!==r.style.zIndex&&(r.style.zIndex=t===1/0?Number.MAX_SAFE_INTEGER:t),this.children_.push(r)}}super.renderFrame(t),function(t,e){const i=t.childNodes;for(let n=0;;++n){const s=i[n],r=e[n];if(!s&&!r)break;s!==r&&(s?r?t.insertBefore(r,s):(t.removeChild(s),--n):t.appendChild(r))}}(this.element_,this.children_),this.dispatchRenderEvent(Zt.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleRemoveUnusedLayerRenderers(t),this.scheduleExpireIconCache(t)}forEachLayerAtPixel(t,e,i,n,s){const r=e.viewState.resolution,o=e.layerStatesArray;for(let a=o.length-1;a>=0;--a){const h=o[a],l=h.layer;if(Jn(h,r)&&s(l)){const s=this.getLayerRenderer(l);if(!s)continue;const r=s.getDataAtPixel(t,e,i);if(r){const t=n(l,r);if(t)return t}}}}};var Rr=class extends zn{constructor(t){(t=c({},t)).controls||(t.controls=function(t){const e=t||{},i=new N;return(void 0===e.zoom||e.zoom)&&i.push(new ns(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&i.push(new is(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&i.push(new ts(e.attributionOptions)),i}()),t.interactions||(t.interactions=function(t){const e=t||{},i=new N,n=new ss(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&i.push(new Rs),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&i.push(new ls({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&i.push(new Cs({condition:e.onFocusOnly?ds:void 0,kinetic:n})),(void 0===e.pinchRotate||e.pinchRotate)&&i.push(new ks),(void 0===e.pinchZoom||e.pinchZoom)&&i.push(new Ys({duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(i.push(new Ds),i.push(new bs({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&i.push(new Gs({condition:e.onFocusOnly?ds:void 0,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&i.push(new Os({duration:e.zoomDuration})),i}()),super(t)}createRenderer(){return new Cr(this)}},Sr={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var Ir=class extends Qn{constructor(t){const e=t||{},i=c({},e);delete i.preload,delete i.useInterimTilesOnError,super(i),this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getPreload(){return this.get(Sr.PRELOAD)}setPreload(t){this.set(Sr.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Sr.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Sr.USE_INTERIM_TILES_ON_ERROR,t)}};class wr{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Lr(t,e,i,n,s){return void 0!==s?(s.minX=t,s.maxX=e,s.minY=i,s.maxY=n,s):new wr(t,e,i,n)}var Mr=wr,Or={IDLE:0,LOADING:1,LOADED:2,ERROR:3};var Pr=class extends M{constructor(t){super(),this.layer_=t}prepareFrame(t,e){return n()}renderFrame(t,e){return n()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return function(n,s){const r=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,s,r)}.bind(this)}forEachFeatureAtCoordinate(t,e,i,n,s){}getDataAtPixel(t,e,i){return n()}getLayer(){return this.layer_}handleImageChange_(t){t.target.getState()===Or.LOADED&&this.renderIfReadyAndVisible()}hasFeatureAtCoordinate(t,e){return!1}loadImage(t){let e=t.getState();return e!=Or.LOADED&&e!=Or.ERROR&&v(t,L.CHANGE,this.handleImageChange_,this),e==Or.IDLE&&(t.load(),e=t.getState()),e==Or.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t.getVisible()&&t.getSourceState()==Xn.READY&&t.changed()}};var Fr=class extends Pr{constructor(t){super(t),this.renderedResolution,this.tempTransform_=[1,0,0,1,0,0],this.pixelTransform_=[1,0,0,1,0,0],this.inversePixelTransform_=[1,0,0,1,0,0],this.context=bn();const e=this.context.canvas;e.style.position="absolute",e.style.transformOrigin="top left",e.className=this.getLayer().getClassName()}disposeInternal(){this.context.canvas.width=this.context.canvas.height=0,super.disposeInternal()}clip(t,e,i){const n=e.pixelRatio,s=e.size[0]*n/2,r=e.size[1]*n/2,o=e.viewState.rotation,a=Ne(i),h=Ge(i),l=Oe(i),c=Me(i);Ui(e.coordinateToPixelTransform,a),Ui(e.coordinateToPixelTransform,h),Ui(e.coordinateToPixelTransform,l),Ui(e.coordinateToPixelTransform,c),t.save(),vr(t,-o,s,r),t.beginPath(),t.moveTo(a[0]*n,a[1]*n),t.lineTo(h[0]*n,h[1]*n),t.lineTo(l[0]*n,l[1]*n),t.lineTo(c[0]*n,c[1]*n),t.clip(),vr(t,o,s,r)}clipUnrotated(t,e,i){const n=Ne(i),s=Ge(i),r=Oe(i),o=Me(i);Ui(e.coordinateToPixelTransform,n),Ui(e.coordinateToPixelTransform,s),Ui(e.coordinateToPixelTransform,r),Ui(e.coordinateToPixelTransform,o);const a=this.inversePixelTransform_;Ui(a,n),Ui(a,s),Ui(a,r),Ui(a,o),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}dispatchRenderEvent_(t,e,i){const n=this.getLayer();if(n.hasListener(t)){const s=new Xs(t,this.inversePixelTransform_,i,e,null);n.dispatchEvent(s)}}preRender(t,e){this.dispatchRenderEvent_(Zt.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(Zt.POSTRENDER,t,e)}getRenderTransform(t,e,i,n){const s=t.viewState,r=e/2,o=i/2,a=t.pixelRatio/s.resolution,h=-a,l=-s.center[0]+n,c=-s.center[1];return Wi(this.tempTransform_,r,o,a,h,-s.rotation,l,c)}getDataAtPixel(t,e,i){const n=Ui(this.inversePixelTransform_,t.slice()),s=this.context;let r;try{r=s.getImageData(Math.round(n[0]),Math.round(n[1]),1,1).data}catch(t){return"SecurityError"===t.name?new Uint8Array:r}return 0===r[3]?null:r}};class Dr extends Fr{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new Mr(0,0,0,0),this.zDirection=0}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return i==Vt.LOADED||i==Vt.EMPTY||i==Vt.ERROR&&!n}getTile(t,e,i,n){const s=n.pixelRatio,r=n.viewState.projection,o=this.getLayer();let a=o.getSource().getTile(t,e,i,s,r);return a.getState()==Vt.ERROR&&(o.getUseInterimTilesOnError()?o.getPreload()>0&&(this.newTiles_=!0):a.setState(Vt.LOADED)),this.isDrawableTile(a)||(a=a.getInterimTile()),a}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t,e){return!0}renderFrame(t,e){const i=this.context,n=t.viewState,s=n.projection,o=n.resolution,a=n.center,h=n.rotation,l=t.pixelRatio,c=this.getLayer(),u=c.getSource(),d=u.getRevision(),g=u.getTileGridForProjection(s),_=void 0===u.zDirection?this.zDirection:u.zDirection,p=g.getZForResolution(o,_),f=g.getResolution(p);let m=t.extent;e.extent&&(m=be(m,e.extent));const v=u.getTilePixelRatio(l);let y=Math.round(t.size[0]*v),E=Math.round(t.size[1]*v);if(h){y=E=Math.round(Math.sqrt(y*y+E*E))}const x=f*y/2/v,T=f*E/2/v,C=[a[0]-x,a[1]-T,a[0]+x,a[1]+T],R=g.getTileRangeForExtentAndZ(m,p),S={};S[p]={};const I=this.createLoadedTileFinder(u,s,S),w=this.tmpExtent,L=this.tmpTileRange_;this.newTiles_=!1;for(let e=R.minX;e<=R.maxX;++e)for(let i=R.minY;i<=R.maxY;++i){const n=this.getTile(p,e,i,t);if(this.isDrawableTile(n)){const e=r(this);if(n.getState()==Vt.LOADED){S[p][n.tileCoord.toString()]=n;const t=n.inTransition(e);this.newTiles_||!t&&-1!==this.renderedTiles.indexOf(n)||(this.newTiles_=!0)}if(1===n.getAlpha(e,t.time))continue}const s=g.getTileCoordChildTileRange(n.tileCoord,L,w);let o=!1;s&&(o=I(p+1,s)),o||g.forEachTileCoordParentTileRange(n.tileCoord,I,L,w)}const M=i.canvas,O=f/o;Wi(this.pixelTransform_,t.size[0]/2,t.size[1]/2,1/v,1/v,h,-y/2,-E/2),zi(this.inversePixelTransform_,this.pixelTransform_),Wi(this.tempTransform_,y/2,E/2,O,O,0,-y/2,-E/2),M.width!=y||M.height!=E?(M.width=y,M.height=E):i.clearRect(0,0,y,E),e.extent&&this.clipUnrotated(i,t,e.extent),this.preRender(i,t),this.renderedTiles.length=0;const P=Object.keys(S).map(Number);P.sort(function(t,e){return t===p?1:e===p?-1:t>e?1:t<e?-1:0});for(let e=0,i=P.length;e<i;++e){const i=P[e],n=u.getTilePixelSize(i,l,s),r=g.getResolution(i)/f,o=n[0]*r*O,a=n[1]*r*O,h=g.getTileCoordForCoordAndZ(Ne(C),i),c=g.getTileCoordExtent(h),d=Ui(this.tempTransform_,[v*(c[0]-C[0])/f,v*(C[3]-c[3])/f]),_=v*u.getGutterForProjection(s),m=S[i];for(const e in m){const n=m[e],s=n.tileCoord,r=d[0]-(h[1]-s[1])*o,l=Math.round(r+o),c=d[1]-(h[2]-s[2])*a,g=Math.round(c+a),f=Math.round(r),v=Math.round(c),y=l-f,E=g-v;this.drawTileImage(n,t,f,v,y,E,_,p===i),this.renderedTiles.push(n),this.updateUsedTiles(t.usedTiles,u,n)}}this.renderedRevision=d,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!Te(this.renderedExtent_,C),this.renderedExtent_=C,this.manageTilePyramid(t,u,g,l,s,m,p,c.getPreload()),this.updateCacheSize_(t,u),this.scheduleExpireCache(t,u),this.postRender(i,t),e.extent&&i.restore();const F=e.opacity;F!==parseFloat(M.style.opacity)&&(M.style.opacity=F);const D=Bi(this.pixelTransform_);return D!==M.style.transform&&(M.style.transform=D),M}drawTileImage(t,e,i,n,s,o,a,h){const l=this.getTileImage(t);if(!l)return;const c=r(this),u=h?t.getAlpha(c,e.time):1,d=this.getLayer().getSource();1!==u||d.getOpaque(e.viewState.projection)||this.context.clearRect(i,n,s,o);const g=u!==this.context.globalAlpha;g&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(l,a,a,l.width-2*a,l.height-2*a,i,n,s,o),g&&this.context.restore(),1!==u?e.animate=!0:h&&t.endTransition(c)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=function(t,e,i){const n=r(t);n in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[n])}.bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const n=r(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}updateCacheSize_(t,e){const i=r(e);let n=0;i in t.usedTiles&&(n+=Object.keys(t.usedTiles[i]).length),i in t.wantedTiles&&(n+=Object.keys(t.wantedTiles[i]).length);const s=e.tileCache;s.highWaterMark<n&&(s.highWaterMark=n)}manageTilePyramid(t,e,i,n,s,o,a,h,l){const c=r(e);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],d=t.tileQueue;let g,_,p,f,m,v;for(v=i.getMinZoom();v<=a;++v)for(_=i.getTileRangeForExtentAndZ(o,v,_),p=i.getResolution(v),f=_.minX;f<=_.maxX;++f)for(m=_.minY;m<=_.maxY;++m)a-v<=h?((g=e.getTile(v,f,m,n,s)).getState()==Vt.IDLE&&(u[g.getKey()]=!0,d.isKeyQueued(g.getKey())||d.enqueue([g,c,i.getTileCoordCenter(g.tileCoord),p])),void 0!==l&&l(g)):e.useTile(v,f,m,s)}}Dr.prototype.getLayer;var Ar=Dr;var br=class extends Ir{constructor(t){super(t)}createRenderer(){return new Ar(this)}};const Nr=.5,Gr=!0;var kr=class extends w{constructor(t,e,i){super();const n=i||{};this.tileCoord=t,this.state=e,this.interimTile=null,this.hifi=!0,this.key="",this.transition_=void 0===n.transition?250:n.transition,this.transitionStarts_={}}changed(){this.dispatchEvent(L.CHANGE)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==Vt.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==Vt.LOADED){t.interimTile=null;break}t.getState()==Vt.LOADING?e=t:t.getState()==Vt.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){this.state=t,this.changed()}load(){n()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else i=e,this.transitionStarts_[t]=i;const n=e-i+1e3/60;return n>=this.transition_?1:$e(n/this.transition_)}inTransition(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}};function Yr(){const t=bn(1,1);return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas}var Xr=class extends kr{constructor(t,e,i,n,s,r){super(t,e,r),this.crossOrigin_=n,this.src_=i,this.image_=new Image,null!==n&&(this.image_.crossOrigin=n),this.imageListenerKeys_=null,this.tileLoadFunction_=s}disposeInternal(){this.state==Vt.LOADING&&(this.unlistenImage_(),this.image_=Yr()),this.interimTile&&this.interimTile.dispose(),this.state=Vt.ABORT,this.changed(),super.disposeInternal()}getImage(){return this.image_}getKey(){return this.src_}handleImageError_(){this.state=Vt.ERROR,this.unlistenImage_(),this.image_=Yr(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Vt.LOADED:this.state=Vt.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==Vt.ERROR&&(this.state=Vt.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Vt.IDLE&&(this.state=Vt.LOADING,this.changed(),this.imageListenerKeys_=[y(this.image_,L.ERROR,this.handleImageError_,this),y(this.image_,L.LOAD,this.handleImageLoad_,this)],this.tileLoadFunction_(this,this.src_))}unlistenImage_(){this.imageListenerKeys_.forEach(x),this.imageListenerKeys_=null}};function Kr(t,e,i,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=i,n):[t,e,i]}function Ur(t,e,i){return t+"/"+e+"/"+i}function Wr(t){return Ur(t[0],t[1],t[2])}var zr=class extends qs{constructor(t){super(t)}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().dispose()}pruneExceptNewestZ(){if(0===this.getCount())return;const t=function(t){return t.split("/").map(Number)}(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(Wr(e.tileCoord)),e.dispose())}.bind(this))}};function Br(t,e,i,n){const s=i-t,r=n-e,o=Math.sqrt(s*s+r*r);return[Math.round(i+s/o),Math.round(n+r/o)]}function Zr(t,e,i,n,s,r,o,a,h,l,c){const u=bn(Math.round(i*t),Math.round(i*e));if(0===h.length)return u.canvas;u.scale(i,i);const d=[1/0,1/0,-1/0,-1/0];h.forEach(function(t,e,i){Ce(d,t.extent)});const g=ke(d),_=Ae(d),p=bn(Math.round(i*g/n),Math.round(i*_/n)),f=i/n;h.forEach(function(t,e,i){const n=t.extent[0]-d[0],s=-(t.extent[3]-d[3]),r=ke(t.extent),o=Ae(t.extent);p.drawImage(t.image,l,l,t.image.width-2*l,t.image.height-2*l,n*f,s*f,r*f,o*f)});const m=Ne(o);return a.getTriangles().forEach(function(t,e,s){const o=t.source,a=t.target;let h=o[0][0],l=o[0][1],c=o[1][0],g=o[1][1],_=o[2][0],f=o[2][1];const v=(a[0][0]-m[0])/r,y=-(a[0][1]-m[1])/r,E=(a[1][0]-m[0])/r,x=-(a[1][1]-m[1])/r,T=(a[2][0]-m[0])/r,C=-(a[2][1]-m[1])/r,R=h,S=l;h=0,l=0;const I=function(t){const e=t.length;for(let i=0;i<e;i++){let n=i,s=Math.abs(t[i][i]);for(let r=i+1;r<e;r++){const e=Math.abs(t[r][i]);e>s&&(s=e,n=r)}if(0===s)return null;const r=t[n];t[n]=t[i],t[i]=r;for(let n=i+1;n<e;n++){const s=-t[n][i]/t[i][i];for(let r=i;r<e+1;r++)i==r?t[n][r]=0:t[n][r]+=s*t[i][r]}}const i=new Array(e);for(let n=e-1;n>=0;n--){i[n]=t[n][e]/t[n][n];for(let s=n-1;s>=0;s--)t[s][e]-=t[s][n]*i[n]}return i}([[c-=R,g-=S,0,0,E-v],[_-=R,f-=S,0,0,T-v],[0,0,c,g,x-y],[0,0,_,f,C-y]]);if(!I)return;u.save(),u.beginPath();const w=(v+E+T)/3,L=(y+x+C)/3,M=Br(w,L,v,y),O=Br(w,L,E,x),P=Br(w,L,T,C);u.moveTo(O[0],O[1]),u.lineTo(M[0],M[1]),u.lineTo(P[0],P[1]),u.clip(),u.transform(I[0],I[2],I[1],I[3],v,y),u.translate(d[0]-R,d[3]-S),u.scale(n/i,-n/i),u.drawImage(p.canvas,0,0),u.restore()}),c&&(u.save(),u.strokeStyle="black",u.lineWidth=1,a.getTriangles().forEach(function(t,e,i){const n=t.target,s=(n[0][0]-m[0])/r,o=-(n[0][1]-m[1])/r,a=(n[1][0]-m[0])/r,h=-(n[1][1]-m[1])/r,l=(n[2][0]-m[0])/r,c=-(n[2][1]-m[1])/r;u.beginPath(),u.moveTo(a,h),u.lineTo(s,o),u.lineTo(l,c),u.closePath(),u.stroke()}),u.restore()),u.canvas}const Vr=10,jr=.25;var Hr=class{constructor(t,e,i,n,s){this.sourceProj_=t,this.targetProj_=e;let r={};const o=Ni(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){const e=t[0]+"/"+t[1];return r[e]||(r[e]=o(t)),r[e]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&ke(n)==ke(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ke(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ke(this.targetProj_.getExtent()):null;const a=Ne(i),h=Ge(i),l=Oe(i),c=Me(i),u=this.transformInv_(a),d=this.transformInv_(h),g=this.transformInv_(l),_=this.transformInv_(c);if(this.addQuad_(a,h,l,c,u,d,g,_,Vr),this.wrapsXInSource_){let t=1/0;this.triangles_.forEach(function(e,i,n){t=Math.min(t,e.source[0][0],e.source[1][0],e.source[2][0])}),this.triangles_.forEach(function(e){if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-t>this.sourceWorldWidth_/2){const i=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];i[0][0]-t>this.sourceWorldWidth_/2&&(i[0][0]-=this.sourceWorldWidth_),i[1][0]-t>this.sourceWorldWidth_/2&&(i[1][0]-=this.sourceWorldWidth_),i[2][0]-t>this.sourceWorldWidth_/2&&(i[2][0]-=this.sourceWorldWidth_);const n=Math.min(i[0][0],i[1][0],i[2][0]);Math.max(i[0][0],i[1][0],i[2][0])-n<this.sourceWorldWidth_/2&&(e.source=i)}}.bind(this))}r={}}addTriangle_(t,e,i,n,s,r){this.triangles_.push({source:[n,s,r],target:[t,e,i]})}addQuad_(t,e,i,n,s,r,o,a,h){const l=ce([s,r,o,a]),c=this.sourceWorldWidth_?ke(l)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&c>.5&&c<1;let g=!1;if(h>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(g=ke(ce([t,e,i,n]))/this.targetWorldWidth_>jr||g),!d&&this.sourceProj_.isGlobal()&&c&&(g=c>jr||g)),g||!this.maxSourceExtent_||Ye(l,this.maxSourceExtent_)){if(!(g||isFinite(s[0])&&isFinite(s[1])&&isFinite(r[0])&&isFinite(r[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1]))){if(!(h>0))return;g=!0}if(h>0){if(!g){const e=[(t[0]+i[0])/2,(t[1]+i[1])/2],n=this.transformInv_(e);let r;r=d?(re(s[0],u)+re(o[0],u))/2-re(n[0],u):(s[0]+o[0])/2-n[0];const a=(s[1]+o[1])/2-n[1];g=r*r+a*a>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const l=[(e[0]+i[0])/2,(e[1]+i[1])/2],c=this.transformInv_(l),u=[(n[0]+t[0])/2,(n[1]+t[1])/2],d=this.transformInv_(u);this.addQuad_(t,e,l,u,s,r,c,d,h-1),this.addQuad_(u,l,i,n,d,c,o,a,h-1)}else{const l=[(t[0]+e[0])/2,(t[1]+e[1])/2],c=this.transformInv_(l),u=[(i[0]+n[0])/2,(i[1]+n[1])/2],d=this.transformInv_(u);this.addQuad_(t,l,u,n,s,c,d,a,h-1),this.addQuad_(l,e,i,u,c,r,o,d,h-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,i,n,s,o,a),this.addTriangle_(t,e,i,s,r,o)}}calculateSourceExtent(){const t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach(function(e,i,n){const s=e.source;Re(t,s[0]),Re(t,s[1]),Re(t,s[2])}),t}getTriangles(){return this.triangles_}};var qr=class extends kr{constructor(t,e,i,n,s,r,o,a,h,l,c){super(s,Vt.IDLE),this.renderEdges_=void 0!==c&&c,this.pixelRatio_=o,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=r||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const u=n.getTileCoordExtent(this.wrappedTileCoord_),d=this.targetTileGrid_.getExtent();let g=this.sourceTileGrid_.getExtent();const _=d?be(u,d):u;if(0===Le(_))return void(this.state=Vt.EMPTY);const p=t.getExtent();p&&(g=g?be(g,p):p);const f=n.getResolution(this.wrappedTileCoord_[0]),m=function(t,e,i,n){const s=Gi(i,e,t);let r=Pi(e,n,i);const o=e.getMetersPerUnit();void 0!==o&&(r*=o);const a=t.getMetersPerUnit();void 0!==a&&(r/=a);const h=t.getExtent();if(!h||_e(h,s)){const e=Pi(t,r,s)/r;isFinite(e)&&e>0&&(r/=e)}return r}(t,i,Pe(_),f);if(!isFinite(m)||m<=0)return void(this.state=Vt.EMPTY);const v=void 0!==l?l:Nr;if(this.triangulation_=new Hr(t,i,_,g,m*v),0===this.triangulation_.getTriangles().length)return void(this.state=Vt.EMPTY);this.sourceZ_=e.getZForResolution(m);let y=this.triangulation_.calculateSourceExtent();if(g&&(t.canWrapX()?(y[1]=te(y[1],g[1],g[3]),y[3]=te(y[3],g[1],g[3])):y=be(y,g)),Le(y)){const t=e.getTileRangeForExtentAndZ(y,this.sourceZ_);for(let e=t.minX;e<=t.maxX;e++)for(let i=t.minY;i<=t.maxY;i++){const t=h(this.sourceZ_,e,i,o);t&&this.sourceTiles_.push(t)}0===this.sourceTiles_.length&&(this.state=Vt.EMPTY)}else this.state=Vt.EMPTY}disposeInternal(){this.state==Vt.LOADING&&this.unlistenSources_(),super.disposeInternal()}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(function(e,i,n){e&&e.getState()==Vt.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=Vt.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n="number"==typeof i?i:i[0],s="number"==typeof i?i:i[1],r=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Zr(n,s,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),r,a,this.triangulation_,t,this.gutter_,this.renderEdges_),this.state=Vt.LOADED}this.changed()}load(){if(this.state==Vt.IDLE){this.state=Vt.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,i,n){const s=e.getState();if(s==Vt.IDLE||s==Vt.LOADING){t++;const i=v(e,L.CHANGE,function(n){const s=e.getState();s!=Vt.LOADED&&s!=Vt.ERROR&&s!=Vt.EMPTY||(x(i),0==--t&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(i)}}.bind(this)),this.sourceTiles_.forEach(function(t,e,i){t.getState()==Vt.IDLE&&t.load()}),0===t&&setTimeout(this.reproject_.bind(this),0)}}unlistenSources_(){this.sourcesListenerKeys_.forEach(x),this.sourcesListenerKeys_=null}};function Jr(t,e){const i=/\{z\}/g,n=/\{x\}/g,s=/\{y\}/g,r=/\{-y\}/g;return function(o,a,h){return o?t.replace(i,o[0].toString()).replace(n,o[1].toString()).replace(s,o[2].toString()).replace(r,function(){const t=o[0],i=e.getFullTileRange(t);return jt(i,55),(i.getHeight()-o[2]-1).toString()}):void 0}}function Qr(t,e){const i=t.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=Jr(t[s],e);return function(t){if(1===t.length)return t[0];return function(e,i,n){if(e){const s=function(t){return(t[1]<<t[0])+t[2]}(e),r=re(s,t.length);return t[r](e,i,n)}}}(n)}function $r(t,e,i){}function to(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}var eo=class extends D{constructor(t){super(),this.projection_=Oi(t.projection),this.attributions_=to(t.attributions),this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,this.loading=!1,this.state_=void 0!==t.state?t.state:Xn.READY,this.wrapX_=void 0!==t.wrapX&&t.wrapX}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection_}getResolutions(){return n()}getState(){return this.state_}getWrapX(){return this.wrapX_}refresh(){this.changed()}setAttributions(t){this.attributions_=to(t),this.changed()}setState(t){this.state_=t,this.changed()}};const io=[0,0,0];var no=class{constructor(t){let e;if(this.minZoom=void 0!==t.minZoom?t.minZoom:0,this.resolutions_=t.resolutions,jt(function(t,e,i){const n=e||Mt;return t.every(function(e,s){if(0===s)return!0;const r=n(t[s-1],e);return!(r>0||i&&0===r)})}(this.resolutions_,function(t,e){return e-t},!0),17),!t.origins)for(let t=0,i=this.resolutions_.length-1;t<i;++t)if(e){if(this.resolutions_[t]/this.resolutions_[t+1]!==e){e=void 0;break}}else e=this.resolutions_[t]/this.resolutions_[t+1];this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==t.origin?t.origin:null,this.origins_=null,void 0!==t.origins&&(this.origins_=t.origins,jt(this.origins_.length==this.resolutions_.length,20));const i=t.extent;void 0===i||this.origin_||this.origins_||(this.origin_=Ne(i)),jt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==t.tileSizes&&(this.tileSizes_=t.tileSizes,jt(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:$t,jt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==i?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){return new Mr(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const n=this.getTileRangeForExtentAndZ(t,e);for(let t=n.minX,s=n.maxX;t<=s;++t)for(let s=n.minY,r=n.maxY;s<=r;++s)i([e,t,s])}forEachTileCoordParentTileRange(t,e,i,n){let s,r,o,a=null,h=t[0]-1;for(2===this.zoomFactor_?(r=t[1],o=t[2]):a=this.getTileCoordExtent(t,n);h>=this.minZoom;){if(e(h,s=2===this.zoomFactor_?Lr(r=Math.floor(r/2),r,o=Math.floor(o/2),o,i):this.getTileRangeForExtentAndZ(a,h,i)))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){const i=2*t[1],n=2*t[2];return Lr(i,i+1,n,n+1,e)}const n=this.getTileCoordExtent(t,i);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeExtent(t,e,i){const n=this.getOrigin(t),s=this.getResolution(t),r=Wn(this.getTileSize(t),this.tmpSize_),o=n[0]+e.minX*r[0]*s,a=n[0]+(e.maxX+1)*r[0]*s;return ye(o,n[1]+e.minY*r[1]*s,a,n[1]+(e.maxY+1)*r[1]*s,i)}getTileRangeForExtentAndZ(t,e,i){const n=io;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);const s=n[1],r=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),Lr(s,n[1],r,n[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=Wn(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=Wn(this.getTileSize(t[0]),this.tmpSize_),r=i[0]+t[1]*s[0]*n,o=i[1]-(t[2]+1)*s[1]*n;return ye(r,o,r+s[0]*n,o+s[1]*n,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,s){const r=this.getZForResolution(i),o=i/this.getResolution(r),a=this.getOrigin(r),h=Wn(this.getTileSize(r),this.tmpSize_),l=n?.5:0,c=n?.5:0,u=Math.floor((t-a[0])/i+l),d=Math.floor((a[1]-e)/i+c);let g=o*u/h[0],_=o*d/h[1];return n?(g=Math.ceil(g)-1,_=Math.ceil(_)-1):(g=Math.floor(g),_=Math.floor(_)),Kr(r,g,_,s)}getTileCoordForXYAndZ_(t,e,i,n,s){const r=this.getOrigin(i),o=this.getResolution(i),a=Wn(this.getTileSize(i),this.tmpSize_),h=n?.5:0,l=n?.5:0,c=Math.floor((t-r[0])/o+h),u=Math.floor((r[1]-e)/o+l);let d=c/a[0],g=u/a[1];return n?(d=Math.ceil(d)-1,g=Math.ceil(g)-1):(d=Math.floor(d),g=Math.floor(g)),Kr(i,d,g,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null}getZForResolution(t,e){return te(Ot(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i}};function so(t){let e=t.getDefaultTileGrid();return e||(e=function(t,e,i,n){return function(t,e,i,n){const s=void 0!==n?n:he.TOP_LEFT,r=ro(t,e,i);return new no({extent:t,origin:Fe(t,s),resolutions:r,tileSize:i})}(oo(t),e,i,n)}(t),t.setDefaultTileGrid(e)),e}function ro(t,e,i){const n=void 0!==e?e:Qt,s=Ae(t),r=ke(t),o=Wn(void 0!==i?i:$t),a=Math.max(r/o[0],s/o[1]),h=n+1,l=new Array(h);for(let t=0;t<h;++t)l[t]=a/Math.pow(2,t);return l}function oo(t){let e=(t=Oi(t)).getExtent();if(!e){const i=180*li[ci.DEGREES]/t.getMetersPerUnit();e=ye(-i,-i,i,i)}return e}class ao extends I{constructor(t,e){super(t),this.tile=e}}var ho=class extends eo{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX}),this.opaque_=void 0!==t.opaque&&t.opaque,this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;let e=t.cacheSize;if(void 0===e){const i=[256,256],n=t.tileGrid;n&&Wn(n.getTileSize(n.getMinZoom()),i);const s="screen"in self,r=s?screen.availWidth||screen.width:1920,o=s?screen.availHeight||screen.height:1080;e=4*Math.ceil(r/i[0])*Math.ceil(o/i[1])}this.tileCache=new zr(e),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition},this.zDirection}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,n){const s=this.getTileCacheForProjection(t);if(!s)return!1;let r,o,a,h=!0;for(let t=i.minX;t<=i.maxX;++t)for(let l=i.minY;l<=i.maxY;++l)o=Ur(e,t,l),a=!1,s.containsKey(o)&&(a=(r=s.get(o)).getState()===Vt.LOADED)&&(a=!1!==n(r)),a||(h=!1);return h}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid.getResolutions()}getTile(t,e,i,s,r){return n()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:so(t)}getTileCacheForProjection(t){const e=this.getProjection();return e&&!Ai(e,t)?null:this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(e),r=Wn(n.getTileSize(t),this.tmpSize);return 1==s?r:(o=r,a=s,void 0===(h=this.tmpSize)&&(h=[0,0]),h[0]=o[0]*a+.5|0,h[1]=o[1]*a+.5|0,h);var o,a,h}getTileCoordForTileUrlFunction(t,e){const i=void 0!==e?e:this.getProjection(),n=this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=function(t,e,i){const n=e[0],s=t.getTileCoordCenter(e),r=oo(i);if(_e(r,s))return e;{const e=ke(r),i=Math.ceil((r[0]-s[0])/e);return s[0]+=e*i,t.getTileCoordForCoordAndZ(s,n)}}(n,t,i)),function(t,e){const i=t[0],n=t[1],s=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;const r=e.getExtent();let o;return!(o=r?e.getTileRangeForExtentAndZ(r,i):e.getFullTileRange(i))||o.containsXY(n,s)}(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}useTile(t,e,i,n){}},lo={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var co=class extends ho{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible}),this.generateTileUrlFunction_=!t.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,this.tileUrlFunction=t.tileUrlFunction?t.tileUrlFunction.bind(this):$r,this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=r(e),n=e.getState();let s;n==Vt.LOADING?(this.tileLoadingKeys_[i]=!0,s=lo.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==Vt.ERROR?lo.TILELOADERROR:n==Vt.LOADED||n==Vt.ABORT?lo.TILELOADEND:void 0),null!=s&&this.dispatchEvent(new ao(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}setUrl(t){const e=this.urls=function(t){const e=[];let i=/\{([a-z])-([a-z])\}/.exec(t);if(i){const n=i[1].charCodeAt(0),s=i[2].charCodeAt(0);let r;for(r=n;r<=s;++r)e.push(t.replace(i[0],String.fromCharCode(r)));return e}if(i=i=/\{(\d+)-(\d+)\}/.exec(t)){const n=parseInt(i[2],10);for(let s=parseInt(i[1],10);s<=n;s++)e.push(t.replace(i[0],s.toString()));return e}return e.push(t),e}(t);this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(Qr(t,this.tileGrid),e):this.setKey(e)}useTile(t,e,i){const n=Ur(t,e,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}};function uo(t,e){t.getImage().src=e}var go=class extends co{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:uo,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible}),this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null,this.tileClass=void 0!==t.tileClass?t.tileClass:Xr,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(!Gr)return super.canExpireCache();if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){if(!Gr)return void super.expireCache(t,e);const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const t in this.tileCacheForProjection){const n=this.tileCacheForProjection[t];n.expireCache(n==i?e:{})}}getGutterForProjection(t){return Gr&&this.getProjection()&&t&&!Ai(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getOpaque(t){return!(Gr&&this.getProjection()&&t&&!Ai(this.getProjection(),t))&&super.getOpaque(t)}getTileGridForProjection(t){if(!Gr)return super.getTileGridForProjection(t);const e=this.getProjection();if(!this.tileGrid||e&&!Ai(e,t)){const e=r(t);return e in this.tileGridForProjection||(this.tileGridForProjection[e]=so(t)),this.tileGridForProjection[e]}return this.tileGrid}getTileCacheForProjection(t){if(!Gr)return super.getTileCacheForProjection(t);const e=this.getProjection();if(!e||Ai(e,t))return this.tileCache;{const e=r(t);return e in this.tileCacheForProjection||(this.tileCacheForProjection[e]=new zr(this.tileCache.highWaterMark)),this.tileCacheForProjection[e]}}createTile_(t,e,i,n,s,r){const o=[t,e,i],a=this.getTileCoordForTileUrlFunction(o,s),h=a?this.tileUrlFunction(a,n,s):void 0,l=new this.tileClass(o,void 0!==h?Vt.IDLE:Vt.EMPTY,void 0!==h?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return l.key=r,v(l,L.CHANGE,this.handleTileChange,this),l}getTile(t,e,i,n,s){const r=this.getProjection();if(Gr&&r&&s&&!Ai(r,s)){const o=this.getTileCacheForProjection(s),a=[t,e,i];let h;const l=Wr(a);o.containsKey(l)&&(h=o.get(l));const c=this.getKey();if(h&&h.key==c)return h;{const t=this.getTileGridForProjection(r),e=this.getTileGridForProjection(s),i=this.getTileCoordForTileUrlFunction(a,s),u=new qr(r,t,s,e,a,i,this.getTilePixelRatio(n),this.getGutter(),function(t,e,i,n){return this.getTileInternal(t,e,i,n,r)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return u.key=c,h?(u.interimTile=h,u.refreshInterimChain(),o.replace(l,u)):o.set(l,u),u}}return this.getTileInternal(t,e,i,n,r||s)}getTileInternal(t,e,i,n,s){let r=null;const o=Ur(t,e,i),a=this.getKey();if(this.tileCache.containsKey(o)){if((r=this.tileCache.get(o)).key!=a){const h=r;r=this.createTile_(t,e,i,n,s,a),h.getState()==Vt.IDLE?r.interimTile=h.interimTile:r.interimTile=h,r.refreshInterimChain(),this.tileCache.replace(o,r)}}else r=this.createTile_(t,e,i,n,s,a),this.tileCache.set(o,r);return r}setRenderReprojectionEdges(t){if(Gr&&this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(t,e){if(Gr){const i=Oi(t);if(i){const t=r(i);t in this.tileGridForProjection||(this.tileGridForProjection[t]=e)}}}};var _o=class extends go{constructor(t){const e=t||{},i=void 0!==e.projection?e.projection:"EPSG:3857",n=void 0!==e.tileGrid?e.tileGrid:function(t){const e=t||{},i=e.extent||Oi("EPSG:3857").getExtent(),n={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:ro(i,e.maxZoom,e.tileSize)};return new no(n)}({extent:oo(i),maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,opaque:e.opaque,projection:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible})}};const po='&#169; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.';var fo=class extends _o{constructor(t){const e=t||{};let i;i=void 0!==e.attributions?e.attributions:[po];const n=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",s=void 0!==e.url?e.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:i,cacheSize:e.cacheSize,crossOrigin:n,opaque:void 0===e.opaque||e.opaque,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,url:s,wrapX:e.wrapX,attributionsCollapsible:!1})}},mo={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};function vo(t,e){return function(t,e,i,n){return function(s,r,o){const a=new XMLHttpRequest;a.open("GET","function"==typeof t?t(s,r,o):t,!0),e.getType()==mo.ARRAY_BUFFER&&(a.responseType="arraybuffer"),a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){const t=e.getType();let r;t==mo.JSON||t==mo.TEXT?r=a.responseText:t==mo.XML?(r=a.responseXML)||(r=(new DOMParser).parseFromString(a.responseText,"application/xml")):t==mo.ARRAY_BUFFER&&(r=a.response),r?i.call(this,e.readFeatures(r,{extent:s,featureProjection:o}),e.readProjection(r)):n.call(this)}else n.call(this)}.bind(this),a.onerror=function(){n.call(this)}.bind(this),a.send()}}(t,e,function(t,e){const i=this;"function"==typeof i.addFeatures&&i.addFeatures(t)},S)}function yo(t,e){return[[-1/0,-1/0,1/0,1/0]]}var Eo={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"},xo=i(0),To=i.n(xo);var Co=class{constructor(t){this.rbush_=To()(t,void 0),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[r(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,s=e.length;n<s;n++){const s=t[n],o=e[n],a={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:o};i[n]=a,this.items_[r(o)]=a}this.rbush_.load(i)}remove(t){const e=r(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)}update(t,e){const i=this.items_[r(e)];Te([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(t){return t.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,s=t.length;n<s;n++)if(i=e(t[n]))return i;return i}isEmpty(){return g(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return ye(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}};class Ro extends I{constructor(t,e){super(t),this.feature=e}}var So=class extends eo{constructor(t){const e=t||{};super({attributions:e.attributions,projection:void 0,state:Xn.READY,wrapX:void 0===e.wrapX||e.wrapX}),this.loader_=S,this.format_=e.format,this.overlaps_=null==e.overlaps||e.overlaps,this.url_=e.url,void 0!==e.loader?this.loader_=e.loader:void 0!==this.url_&&(jt(this.format_,7),this.loader_=vo(this.url_,this.format_)),this.strategy_=void 0!==e.strategy?e.strategy:yo;const i=void 0===e.useSpatialIndex||e.useSpatialIndex;let n,s;this.featuresRtree_=i?new Co:null,this.loadedExtentsRtree_=new Co,this.nullGeometryFeatures_={},this.idIndex_={},this.undefIdIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(e.features)?s=e.features:e.features&&(s=(n=e.features).getArray()),i||void 0!==n||(n=new N(s)),void 0!==s&&this.addFeaturesInternal(s),void 0!==n&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=r(t);if(!this.addToIndex_(e,t))return;this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const e=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(e,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Ro(Eo.ADDFEATURE,t))}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[v(e,L.CHANGE,this.handleFeatureChange_,this),v(e,l.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const n=e.getId();return void 0!==n?n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e:(jt(!(t in this.undefIdIndex_),30),this.undefIdIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let e=0,n=t.length;e<n;e++){const n=t[e],s=r(n);this.addToIndex_(s,n)&&i.push(n)}for(let t=0,s=i.length;t<s;t++){const s=i[t],o=r(s);this.setupChangeEvents_(o,s);const a=s.getGeometry();if(a){const t=a.getExtent();e.push(t),n.push(s)}else this.nullGeometryFeatures_[o]=s}this.featuresRtree_&&this.featuresRtree_.load(e,n);for(let t=0,e=i.length;t<e;t++)this.dispatchEvent(new Ro(Eo.ADDFEATURE,i[t]))}bindFeaturesCollection_(t){let e=!1;v(this,Eo.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),v(this,Eo.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),v(t,h.ADD,function(t){e||(e=!0,this.addFeature(t.element),e=!1)},this),v(t,h.REMOVE,function(t){e||(e=!0,this.removeFeature(t.element),e=!1)},this),this.featuresCollection_=t}clear(t){if(t){for(const t in this.featureChangeKeys_)this.featureChangeKeys_[t].forEach(x);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.undefIdIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this));for(const t in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[t])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Ro(Eo.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(i){return i.getGeometry().intersectsCoordinate(t)?e(i):void 0})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){const t=e(i);if(t)return t}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray():this.featuresRtree_&&(t=this.featuresRtree_.getAll(),g(this.nullGeometryFeatures_)||Ft(t,d(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)}),e}getFeaturesInExtent(t){return this.featuresRtree_.getInExtent(t)}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let s=null;const r=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0],h=e||C;return this.featuresRtree_.forEachInExtent(a,function(t){if(h(t)){const e=t.getGeometry(),h=o;if((o=e.closestPointXY(i,n,r,o))<h){s=t;const e=Math.sqrt(o);a[0]=i-e,a[1]=n-e,a[2]=i+e,a[3]=n+e}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return void 0!==e?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=r(e),n=e.getGeometry();if(n){const t=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(t,e)):this.featuresRtree_&&this.featuresRtree_.update(t,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);const s=e.getId();if(void 0!==s){const t=s.toString();i in this.undefIdIndex_?(delete this.undefIdIndex_[i],this.idIndex_[t]=e):this.idIndex_[t]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[t]=e)}else i in this.undefIdIndex_||(this.removeFromIdIndex_(e),this.undefIdIndex_[i]=e);this.changed(),this.dispatchEvent(new Ro(Eo.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return void 0!==e?e in this.idIndex_:r(t)in this.undefIdIndex_}isEmpty(){return this.featuresRtree_.isEmpty()&&g(this.nullGeometryFeatures_)}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,s=this.strategy_(t,e);this.loading=!1;for(let t=0,r=s.length;t<r;++t){const r=s[t];n.forEachInExtent(r,function(t){return pe(t.extent,r)})||(this.loader_.call(this,r,e,i),n.insert(r,{extent:r.slice()}),this.loading=this.loader_!==S)}}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(e){if(Te(e.extent,t))return i=e,!0}),i&&e.remove(i)}removeFeature(t){const e=r(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t),this.changed()}removeFeatureInternal(t){const e=r(t);this.featureChangeKeys_[e].forEach(x),delete this.featureChangeKeys_[e];const i=t.getId();void 0!==i?delete this.idIndex_[i.toString()]:delete this.undefIdIndex_[e],this.dispatchEvent(new Ro(Eo.REMOVEFEATURE,t))}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){jt(this.format_,7),this.setLoader(vo(t,this.format_))}};class Io{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale}clone(){return new Io({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getAnchor(){return n()}getImage(t){return n()}getHitDetectionImage(t){return n()}getImageState(){return n()}getImageSize(){return n()}getHitDetectionImageSize(){return n()}getOrigin(){return n()}getSize(){return n()}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t}listenImageChange(t,e){return n()}load(){n()}unlistenImageChange(t,e){n()}}var wo=Io;class Lo extends wo{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:1}),this.canvas_=null,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.anchor_=null,this.size_=null,this.imageSize_=null,this.hitDetectionImageSize_=null,this.render_()}clone(){const t=new Lo({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t}getAnchor(){return this.anchor_}getAngle(){return this.angle_}getFill(){return this.fill_}getHitDetectionImage(t){return this.hitDetectionCanvas_}getImage(t){return this.canvas_}getImageSize(){return this.imageSize_}getHitDetectionImageSize(){return this.hitDetectionImageSize_}getImageState(){return Or.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}listenImageChange(t,e){}load(){}unlistenImageChange(t,e){}render_(){let t,e="",i="",n=0,s=null,r=0,o=0;this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=sr),t=js(t),void 0===(o=this.stroke_.getWidth())&&(o=hr),s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset(),void 0===(i=this.stroke_.getLineJoin())&&(i=ir),void 0===(e=this.stroke_.getLineCap())&&(e=$s),void 0===(n=this.stroke_.getMiterLimit())&&(n=nr));let a=2*(this.radius_+o)+1;const h={strokeStyle:t,strokeWidth:o,size:a,lineCap:e,lineDash:s,lineDashOffset:r,lineJoin:i,miterLimit:n},l=bn(a,a);this.canvas_=l.canvas;const c=a=this.canvas_.width;this.draw_(h,l,0,0),this.createHitDetectionCanvas_(h),this.anchor_=[a/2,a/2],this.size_=[a,a],this.imageSize_=[c,c]}draw_(t,e,i,n){let s,r,o;e.setTransform(1,0,0,1,0,0),e.translate(i,n),e.beginPath();let a=this.points_;if(a===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{const i=void 0!==this.radius2_?this.radius2_:this.radius_;for(i!==this.radius_&&(a*=2),s=0;s<=a;s++)r=2*s*Math.PI/a-Math.PI/2+this.angle_,o=s%2==0?this.radius_:i,e.lineTo(t.size/2+o*Math.cos(r),t.size/2+o*Math.sin(r))}if(this.fill_){let t=this.fill_.getColor();null===t&&(t=Qs),e.fillStyle=js(t),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke()),e.closePath()}createHitDetectionCanvas_(t){if(this.hitDetectionImageSize_=[t.size,t.size],this.fill_)return void(this.hitDetectionCanvas_=this.canvas_);const e=bn(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e,0,0)}drawHitDetectionCanvas_(t,e,i,n){e.setTransform(1,0,0,1,0,0),e.translate(i,n),e.beginPath();let s=this.points_;if(s===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{const i=void 0!==this.radius2_?this.radius2_:this.radius_;let n,r,o;for(i!==this.radius_&&(s*=2),n=0;n<=s;n++)o=2*n*Math.PI/s-Math.PI/2+this.angle_,r=n%2==0?this.radius_:i,e.lineTo(t.size/2+r*Math.cos(o),t.size/2+r*Math.sin(o))}e.fillStyle=Qs,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.stroke()),e.closePath()}}var Mo=Lo;class Oo extends Mo{constructor(t){const e=t||{};super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke})}clone(){const t=new Oo({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius()});return t.setOpacity(this.getOpacity()),t.setScale(this.getScale()),t}setRadius(t){this.radius_=t}}var Po=Oo;class Fo{constructor(t){const e=t||{};this.color_=void 0!==e.color?e.color:null}clone(){const t=this.getColor();return new Fo({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}var Do=Fo;class Ao{constructor(t){const e=t||{};this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const t=this.getColor();return new Ao({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}var bo=Ao;class No{constructor(t){const e=t||{};this.geometry_=null,this.geometryFunction_=Yo,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}clone(){let t=this.getGeometry();return t&&"object"==typeof t&&(t=t.clone()),new No({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Yo,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let Go=null;function ko(t,e){if(!Go){const t=new Do({color:"rgba(255,255,255,0.4)"}),e=new bo({color:"#3399CC",width:1.25});Go=[new No({image:new Po({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return Go}function Yo(t){return t.getGeometry()}const Xo={RENDER_ORDER:"renderOrder"};var Ko=class extends Qn{constructor(t){const e=t||{},i=c({},e);delete i.style,delete i.renderBuffer,delete i.updateWhileAnimating,delete i.updateWhileInteracting,super(i),this.declutter_=void 0!==e.declutter&&e.declutter,this.renderBuffer_=void 0!==e.renderBuffer?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=void 0!==e.updateWhileAnimating&&e.updateWhileAnimating,this.updateWhileInteracting_=void 0!==e.updateWhileInteracting&&e.updateWhileInteracting}getDeclutter(){return this.declutter_}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Xo.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}setRenderOrder(t){this.set(Xo.RENDER_ORDER,t)}setStyle(t){this.style_=void 0!==t?t:ko,this.styleFunction_=null===t?void 0:function(t){let e;if("function"==typeof t)e=t;else{let i;Array.isArray(t)?i=t:(jt("function"==typeof t.getZIndex,41),i=[t]),e=function(){return i}}return e}(this.style_),this.changed()}};const Uo={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Wo=[Uo.FILL],zo=[Uo.STROKE],Bo=[Uo.BEGIN_PATH],Zo=[Uo.CLOSE_PATH];var Vo=Uo;var jo=class extends Hs{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})}appendFlatCoordinates(t,e,i,n,s,r){let o=this.coordinates.length;const a=this.getBufferedMaxExtent();r&&(e+=n);let h=t[e],l=t[e+1];const c=this.tmpCoordinate_;let u,d,g,_=!0;for(u=e+n;u<i;u+=n)c[0]=t[u],c[1]=t[u+1],(g=me(a,c))!==d?(_&&(this.coordinates[o++]=h,this.coordinates[o++]=l),this.coordinates[o++]=c[0],this.coordinates[o++]=c[1],_=!1):g===le.INTERSECTING?(this.coordinates[o++]=c[0],this.coordinates[o++]=c[1],_=!1):_=!0,h=c[0],l=c[1],d=g;return(s&&_||u===e+n)&&(this.coordinates[o++]=h,this.coordinates[o++]=l),o}drawCustomCoordinates_(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){const o=i[r],a=this.appendFlatCoordinates(t,e,o,n,!1,!1);s.push(a),e=o}return e}drawCustom(t,e,i){this.beginGeometry(e);const n=t.getType(),s=t.getStride(),r=this.coordinates.length;let o,a,h,l,c;if(n==ni.MULTI_POLYGON){o=(t=t).getOrientedFlatCoordinates(),l=[];const e=t.getEndss();c=0;for(let t=0,i=e.length;t<i;++t){const i=[];c=this.drawCustomCoordinates_(o,c,e[t],s,i),l.push(i)}this.instructions.push([Vo.CUSTOM,r,l,t,i,hn])}else n==ni.POLYGON||n==ni.MULTI_LINE_STRING?(h=[],o=n==ni.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),c=this.drawCustomCoordinates_(o,0,t.getEnds(),s,h),this.instructions.push([Vo.CUSTOM,r,h,t,i,an])):n==ni.LINE_STRING||n==ni.MULTI_POINT?(o=t.getFlatCoordinates(),a=this.appendFlatCoordinates(o,0,o.length,s,!1,!1),this.instructions.push([Vo.CUSTOM,r,a,t,i,on])):n==ni.POINT&&(o=t.getFlatCoordinates(),this.coordinates.push(o[0],o[1]),a=this.coordinates.length,this.instructions.push([Vo.CUSTOM,r,a,t,i]));this.endGeometry(e)}beginGeometry(t){this.beginGeometryInstruction1_=[Vo.BEGIN_GEOMETRY,t,0],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Vo.BEGIN_GEOMETRY,t,0],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let n,s,r=-1;for(e=0;e<i;++e)(s=(n=t[e])[0])==Vo.END_GEOMETRY?r=e:s==Vo.BEGIN_GEOMETRY&&(n[2]=e,Pt(this.hitDetectionInstructions,r,e),r=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const e=t.getColor();i.fillStyle=js(e||Qs)}else i.fillStyle=void 0;if(e){const t=e.getColor();i.strokeStyle=js(t||sr);const n=e.getLineCap();i.lineCap=void 0!==n?n:$s;const s=e.getLineDash();i.lineDash=s?s.slice():tr;const r=e.getLineDashOffset();i.lineDashOffset=r||er;const o=e.getLineJoin();i.lineJoin=void 0!==o?o:ir;const a=e.getWidth();i.lineWidth=void 0!==a?a:hr;const h=e.getMiterLimit();i.miterLimit=void 0!==h?h:nr,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[Vo.SET_FILL_STYLE,e];return"string"!=typeof e&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[Vo.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;"string"==typeof i&&t.currentFillStyle==i||(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,s=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,a=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||s!=t.currentLineDash&&!Dt(t.currentLineDash,s)||t.currentLineDashOffset!=r||t.currentLineJoin!=o||t.currentLineWidth!=a||t.currentMiterLimit!=h)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=a,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[Vo.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=de(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ue(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}};var Ho=class extends jo{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const s=this.state,r=void 0!==s.fillStyle,o=null!=s.strokeStyle,a=i.length;this.instructions.push(Bo),this.hitDetectionInstructions.push(Bo);for(let s=0;s<a;++s){const r=i[s],a=this.coordinates.length,h=this.appendFlatCoordinates(t,e,r,n,!0,!o),l=[Vo.MOVE_TO_LINE_TO,a,h];this.instructions.push(l),this.hitDetectionInstructions.push(l),o&&(this.instructions.push(Zo),this.hitDetectionInstructions.push(Zo)),e=r}return r&&(this.instructions.push(Wo),this.hitDetectionInstructions.push(Wo)),o&&(this.instructions.push(zo),this.hitDetectionInstructions.push(zo)),e}drawCircle(t,e){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(void 0===n&&void 0===s)return;this.setFillStrokeStyles_(),this.beginGeometry(e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Vo.SET_FILL_STYLE,Qs]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Vo.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const r=t.getFlatCoordinates(),o=t.getStride(),a=this.coordinates.length;this.appendFlatCoordinates(r,0,r.length,o,!1,!1);const h=[Vo.CIRCLE,a];this.instructions.push(Bo,h),this.hitDetectionInstructions.push(Bo,h),this.hitDetectionInstructions.push(Wo),void 0!==i.fillStyle&&this.instructions.push(Wo),void 0!==i.strokeStyle&&(this.instructions.push(zo),this.hitDetectionInstructions.push(zo)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(void 0===n&&void 0===s)return;this.setFillStrokeStyles_(),this.beginGeometry(e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Vo.SET_FILL_STYLE,Qs]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Vo.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const r=t.getEnds(),o=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(o,0,r,a),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(void 0===n&&void 0===s)return;this.setFillStrokeStyles_(),this.beginGeometry(e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Vo.SET_FILL_STYLE,Qs]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Vo.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const r=t.getEndss(),o=t.getOrientedFlatCoordinates(),a=t.getStride();let h=0;for(let t=0,e=r.length;t<e;++t)h=this.drawFlatCoordinatess_(o,h,r[t],a);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=cn(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};function qo(t,e,i,n,s){let r,o,a,h,l,c,u,d,g,_,p=i,f=i,m=0,v=0,y=i;for(o=i;o<n;o+=s){const i=e[o],n=e[o+1];void 0!==l&&(g=i-l,_=n-c,h=Math.sqrt(g*g+_*_),void 0!==u&&(v+=a,(r=Math.acos((u*g+d*_)/(a*h)))>t&&(v>m&&(m=v,p=y,f=o),v=0,y=o-s)),a=h,u=g,d=_),l=i,c=n}return(v+=h)>m?[y,o]:[p,f]}var Jo={POINT:"point",LINE:"line"};const Qo={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};const $o={Circle:Ho,Default:jo,Image:class extends jo{constructor(t,e,i,n){super(t,e,i,n),this.declutterGroup_=null,this.hitDetectionImage_=null,this.image_=null,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0}drawCoordinates_(t,e,i,n){return this.appendFlatCoordinates(t,e,i,n,!1,!1)}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,r=this.drawCoordinates_(i,0,i.length,n);this.instructions.push([Vo.DRAW_IMAGE,s,r,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Vo.DRAW_IMAGE,s,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,r=this.drawCoordinates_(i,0,i.length,n);this.instructions.push([Vo.DRAW_IMAGE,s,r,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Vo.DRAW_IMAGE,s,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),s=t.getHitDetectionImage(1),r=t.getImage(1),o=t.getOrigin();this.anchorX_=i[0],this.anchorY_=i[1],this.declutterGroup_=e,this.hitDetectionImage_=s,this.image_=r,this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScale(),this.width_=n[0]}},LineString:class extends jo{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const s=this.coordinates.length,r=this.appendFlatCoordinates(t,e,i,n,!1,!1),o=[Vo.MOVE_TO_LINE_TO,s,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e){const i=this.state,n=i.strokeStyle,s=i.lineWidth;if(void 0===n||void 0===s)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e),this.hitDetectionInstructions.push([Vo.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Bo);const r=t.getFlatCoordinates(),o=t.getStride();this.drawFlatCoordinates_(r,0,r.length,o),this.hitDetectionInstructions.push(zo),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state,n=i.strokeStyle,s=i.lineWidth;if(void 0===n||void 0===s)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(e),this.hitDetectionInstructions.push([Vo.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Bo);const r=t.getEnds(),o=t.getFlatCoordinates(),a=t.getStride();let h=0;for(let t=0,e=r.length;t<e;++t)h=this.drawFlatCoordinates_(o,h,r[t],a);this.hitDetectionInstructions.push(zo),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(zo),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(zo),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Bo)}},Polygon:Ho,Text:class extends jo{constructor(t,e,i,n){super(t,e,i,n),this.declutterGroup_,this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",lr.prune()}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const i=this.textFillState_,n=this.textStrokeState_,s=this.textState_;if(""===this.text_||!s||!i&&!n)return;let r=this.coordinates.length;const o=t.getType();let a,h,l=null,c=2,u=2;if(s.placement===Jo.LINE){if(!Ye(this.getBufferedMaxExtent(),t.getExtent()))return;let i;if(l=t.getFlatCoordinates(),u=t.getStride(),o==ni.LINE_STRING)i=[l.length];else if(o==ni.MULTI_LINE_STRING)i=t.getEnds();else if(o==ni.POLYGON)i=t.getEnds().slice(0,1);else if(o==ni.MULTI_POLYGON){const e=t.getEndss();for(i=[],a=0,h=e.length;a<h;++a)i.push(e[a][0])}this.beginGeometry(e);const n=s.textAlign;let d,g=0;for(let t=0,e=i.length;t<e;++t){if(null==n){const e=qo(s.maxAngle,l,g,i[t],u);g=e[0],d=e[1]}else d=i[t];for(a=g;a<d;a+=u)this.coordinates.push(l[a],l[a+1]);c=this.coordinates.length,g=i[t],this.drawChars_(r,c,this.declutterGroup_),r=c}this.endGeometry(e)}else{let i=null;switch(s.overflow||(i=[]),o){case ni.POINT:case ni.MULTI_POINT:c=(l=t.getFlatCoordinates()).length;break;case ni.LINE_STRING:l=t.getFlatMidpoint();break;case ni.CIRCLE:l=t.getCenter();break;case ni.MULTI_LINE_STRING:c=(l=t.getFlatMidpoints()).length;break;case ni.POLYGON:l=t.getFlatInteriorPoint(),s.overflow||i.push(l[2]/this.resolution),u=3;break;case ni.MULTI_POLYGON:const e=t.getFlatInteriorPoints();for(l=[],a=0,h=e.length;a<h;a+=3)s.overflow||i.push(e[a+2]/this.resolution),l.push(e[a],e[a+1]);if(0==(c=l.length))return}c=this.appendFlatCoordinates(l,0,c,u,!1,!1),this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e);const n=this.pixelRatio;this.instructions.push([Vo.DRAW_IMAGE,r,c,null,NaN,NaN,this.declutterGroup_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1,NaN,s.padding==ar?ar:s.padding.map(function(t){return t*n}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,i]),this.hitDetectionInstructions.push([Vo.DRAW_IMAGE,r,c,null,NaN,NaN,this.declutterGroup_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1/this.pixelRatio,NaN,s.padding,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,i]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||rr,textBaseline:e.textBaseline||or,scale:e.scale});const r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))}drawChars_(t,e,i){const n=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const h=this.pixelRatio,l=Qo[s.textBaseline],c=this.textOffsetY_*h,u=this.text_,d=s.scale,g=n?n.lineWidth*d/2:0;this.instructions.push([Vo.DRAW_CHARS,t,e,l,i,s.overflow,a,s.maxAngle,h,c,r,g*h,u,o,1]),this.hitDetectionInstructions.push([Vo.DRAW_CHARS,t,e,l,i,s.overflow,a,s.maxAngle,1,c,r,g,u,o,1/h])}setTextStyle(t,e){let i,n,s;if(t){this.declutterGroup_=e;const o=t.getFill();o?((n=this.textFillState_)||(n=this.textFillState_={}),n.fillStyle=js(o.getColor()||Qs)):n=this.textFillState_=null;const a=t.getStroke();if(a){(s=this.textStrokeState_)||(s=this.textStrokeState_={});const t=a.getLineDash(),e=a.getLineDashOffset(),i=a.getWidth(),n=a.getMiterLimit();s.lineCap=a.getLineCap()||$s,s.lineDash=t?t.slice():tr,s.lineDashOffset=void 0===e?er:e,s.lineJoin=a.getLineJoin()||ir,s.lineWidth=void 0===i?hr:i,s.miterLimit=void 0===n?nr:n,s.strokeStyle=js(a.getColor()||sr)}else s=this.textStrokeState_=null;i=this.textState_;const h=t.getFont()||Js;gr(h);const l=t.getScale();i.overflow=t.getOverflow(),i.font=h,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.textBaseline=t.getTextBaseline()||or,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||ar,i.scale=void 0===l?1:l;const c=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===c?0:c,this.textOffsetY_=void 0===u?0:u,this.textRotateWithView_=void 0!==d&&d,this.textRotation_=void 0===g?0:g,this.strokeKey_=s?("string"==typeof s.strokeStyle?s.strokeStyle:r(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+r(n.fillStyle):""}else this.text_=""}}};var ta=class{constructor(t,e,i,n,s){this.declutter_=s,this.declutterGroup_=null,this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}addDeclutter(t){let e=null;return this.declutter_&&(t?(e=this.declutterGroup_)[4]++:(e=this.declutterGroup_=[1/0,1/0,-1/0,-1/0]).push(1)),e}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const s=i[n].finish();t[e][n]=s}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():"0";let n=this.buildersByZIndex_[i];void 0===n&&(n={},this.buildersByZIndex_[i]=n);let s=n[e];return void 0===s&&(s=new(0,$o[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=s),s}},ea={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function ia(t,e,i,n){let s=t[e],r=t[e+1],o=0;for(let a=e+n;a<i;a+=n){const e=t[a],i=t[a+1];o+=Math.sqrt((e-s)*(e-s)+(i-r)*(i-r)),s=e,r=i}return o}function na(t,e,i,n,s,r,o,a,h,l,c){const u=[],d=t[e]>t[i-n],g=s.length;let _,p,f,m=t[e],v=t[e+1],y=t[e+=n],E=t[e+1],x=0,T=Math.sqrt(Math.pow(y-m,2)+Math.pow(E-v,2)),C="",R=0;for(let S=0;S<g;++S){p=d?g-S-1:S;const I=s.charAt(p),w=a*h(l,C=d?I+C:C+I,c)-R;R+=w;const L=r+w/2;for(;e<i-n&&x+T<L;)m=y,v=E,y=t[e+=n],E=t[e+1],x+=T,T=Math.sqrt(Math.pow(y-m,2)+Math.pow(E-v,2));const M=L-x;let O=Math.atan2(E-v,y-m);if(d&&(O+=O>0?-Math.PI:Math.PI),void 0!==f){let t=O-f;if(t+=t>Math.PI?-2*Math.PI:t<-Math.PI?2*Math.PI:0,Math.abs(t)>o)return null}const P=M/T,F=oe(m,y,P),D=oe(v,E,P);f==O?(d&&(_[0]=F,_[1]=D,_[2]=w/2),_[4]=C):(R=w,_=[F,D,w/2,O,C=I],d?u.unshift(_):u.push(_),f=O),r+=w}return u}const sa=[1/0,1/0,-1/0,-1/0],ra=[1,0,0,1,0,0],oa=[],aa=[],ha=[],la=[];var ca=class extends T{constructor(t,e,i,n){super(),this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.declutterItems=[],this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={}}disposeInternal(){lr.release(this),super.disposeInternal()}getTextImage(t,e,i,n){let s;const r=n+e+t+i+this.pixelRatio;if(!lr.containsKey(r)){const o=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,h=this.textStates[e],l=this.pixelRatio,c=h.scale*l,u=Qo[h.textAlign||rr],d=n&&o.lineWidth?o.lineWidth:0,g=t.split("\n"),_=g.length,p=[],f=function(t,e,i){const n=e.length;let s=0;for(let r=0;r<n;++r){const n=fr(t,e[r]);s=Math.max(s,n),i.push(n)}return s}(h.font,g,p),m=pr(h.font),v=m*_,y=f+d,E=bn(Math.ceil(y*c),Math.ceil((v+d)*c));s=E.canvas,lr.set(r,s),1!=c&&E.scale(c,c),E.font=h.font,n&&(E.strokeStyle=o.strokeStyle,E.lineWidth=d,E.lineCap=o.lineCap,E.lineJoin=o.lineJoin,E.miterLimit=o.miterLimit,E.setLineDash&&o.lineDash.length&&(E.setLineDash(o.lineDash),E.lineDashOffset=o.lineDashOffset)),i&&(E.fillStyle=a.fillStyle),E.textBaseline="middle",E.textAlign="center";const x=.5-u,T=u*s.width/c+x*d;let C;if(n)for(C=0;C<_;++C)E.strokeText(g[C],T+x*p[C],.5*(d+m)+C*m);if(i)for(C=0;C<_;++C)E.fillText(g[C],T+x*p[C],.5*(d+m)+C*m)}return lr.get(r,this)}replayTextBackground_(t,e,i,n,s,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),r&&(this.alignFill_=r[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}replayImage_(t,e,i,n,s,r,o,a,h,l,c,u,d,g,_,p,f,m){const v=f||m;e-=s*=d,i-=r*=d;const y=_+l>n.width?n.width-l:_,E=a+c>n.height?n.height-c:a,x=p[3]+y*d+p[1],T=p[0]+E*d+p[2],C=e-p[3],R=i-p[0];(v||0!==u)&&(oa[0]=la[0]=C,oa[1]=aa[1]=R,aa[0]=ha[0]=C+x,ha[1]=la[1]=R+T);let S=null;if(0!==u){const t=e+s,n=i+r;S=Wi(ra,t,n,1,1,u,-t,-n),Ui(ra,oa),Ui(ra,aa),Ui(ra,ha),Ui(ra,la),ye(Math.min(oa[0],aa[0],ha[0],la[0]),Math.min(oa[1],aa[1],ha[1],la[1]),Math.max(oa[0],aa[0],ha[0],la[0]),Math.max(oa[1],aa[1],ha[1],la[1]),sa)}else ye(C,R,C+x,R+T,sa);const I=t.canvas,w=m?m[2]*d/2:0,L=sa[0]-w<=I.width&&sa[2]+w>=0&&sa[1]-w<=I.height&&sa[3]+w>=0;if(g&&(e=Math.round(e),i=Math.round(i)),o){if(!L&&1==o[4])return;Ce(o,sa);const s=L?[t,S?S.slice(0):null,h,n,l,c,y,E,e,i,d]:null;s&&v&&s.push(f,m,oa,aa,ha,la),o.push(s)}else L&&(v&&this.replayTextBackground_(t,oa,aa,ha,la,f,m),Er(t,S,h,n,l,c,y,E,e,i,d))}fill_(t){if(this.alignFill_){const e=Ui(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))}renderDeclutter(t,e,i){if(t&&t.length>5){const n=t[4];if(1==n||n==t.length-5){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};if(i||(i=To()(9,void 0)),!i.collides(n)){i.insert(n);for(let e=5,i=t.length;e<i;++e){const i=t[e];i&&(i.length>11&&this.replayTextBackground_(i[0],i[13],i[14],i[15],i[16],i[11],i[12]),Er.apply(void 0,i))}}t.length=5,Ee(t)}}return i}drawTextImageWithPointPlacement_(t,e,i,n){const s=this.textStates[e],r=this.getTextImage(t,e,n,i),o=this.strokeStates[i],a=this.pixelRatio,h=Qo[s.textAlign||rr],l=Qo[s.textBaseline||or],c=o&&o.lineWidth?o.lineWidth:0;return{label:r,anchorX:h*r.width/a+2*(.5-h)*c,anchorY:l*r.height/a+2*(.5-l)*c}}execute_(t,e,i,n,s,o,a){let h;var l,c;this.declutterItems.length=0,this.pixelCoordinates_&&Dt(e,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=ri(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_),l=this.renderedTransform_,c=e,l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5]);const u=!g(i);let d=0;const _=n.length;let p,f,m,v,y,E,x,T,C,R,S,I,w,L=0,M=0,O=0,P=null,F=null;const D=this.coordinateCache_,A=this.viewRotation_,b={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:A},N=this.instructions!=n||this.overlaps?0:200;let G,k,Y;for(;d<_;){const e=n[d];switch(e[0]){case Vo.BEGIN_GEOMETRY:G=e[1],u&&i[r(G)]||!G.getGeometry()?d=e[2]:void 0===a||Ye(a,G.getGeometry().getExtent())?++d:d=e[2]+1;break;case Vo.BEGIN_PATH:M>N&&(this.fill_(t),M=0),O>N&&(t.stroke(),O=0),M||O||(t.beginPath(),v=y=NaN),++d;break;case Vo.CIRCLE:const n=h[L=e[1]],l=h[L+1],c=h[L+2]-n,g=h[L+3]-l,_=Math.sqrt(c*c+g*g);t.moveTo(n+_,l),t.arc(n,l,_,0,2*Math.PI,!0),++d;break;case Vo.CLOSE_PATH:t.closePath(),++d;break;case Vo.CUSTOM:L=e[1],p=e[2];const X=e[3],K=e[4],U=6==e.length?e[5]:void 0;b.geometry=X,b.feature=G,d in D||(D[d]=[]);const W=D[d];U?U(h,L,p,2,W):(W[0]=h[L],W[1]=h[L+1],W.length=2),K(W,b),++d;break;case Vo.DRAW_IMAGE:L=e[1],p=e[2],C=e[3],f=e[4],m=e[5],T=o?null:e[6];let z=e[7];const B=e[8],Z=e[9],V=e[10],j=e[11];let H=e[12];const q=e[13];let J,Q,$,tt,et=e[14];if(!C&&e.length>=19){R=e[18],S=e[19],I=e[20],w=e[21];const t=this.drawTextImageWithPointPlacement_(R,S,I,w);C=e[3]=t.label;const i=e[22];f=e[4]=(t.anchorX-i)*this.pixelRatio;const n=e[23];m=e[5]=(t.anchorY-n)*this.pixelRatio,z=e[7]=C.height,et=e[14]=C.width}e.length>24&&(J=e[24]),e.length>16?(Q=e[15],$=e[16],tt=e[17]):(Q=ar,$=tt=!1),j&&(H+=A);let it=0;for(;L<p;L+=2)J&&J[it++]<et/this.pixelRatio||this.replayImage_(t,h[L],h[L+1],C,f,m,T,z,B,Z,V,H,q,s,et,Q,$?P:null,tt?F:null);this.declutterItems.push(this,T,G),++d;break;case Vo.DRAW_CHARS:const nt=e[1],st=e[2],rt=e[3];T=o?null:e[4];const ot=e[5];w=e[6];const at=e[7],ht=e[8],lt=e[9];I=e[10];const ct=e[11];R=e[12],S=e[13];const ut=e[14],dt=this.textStates[S],gt=dt.font,_t=dt.scale*ht;let pt;pt=gt in this.widths_?this.widths_[gt]:this.widths_[gt]={};const ft=ia(h,nt,st,2),mt=_t*mr(gt,R,pt);if(ot||mt<=ft){const e=this.textStates[S].textAlign,i=na(h,nt,st,2,R,(ft-mt)*Qo[e],at,_t,mr,gt,pt);if(i){let e,n,s,r,o;if(I)for(e=0,n=i.length;e<n;++e)s=(o=i[e])[4],r=this.getTextImage(s,S,"",I),f=o[2]+ct,m=rt*r.height+2*(.5-rt)*ct-lt,this.replayImage_(t,o[0],o[1],r,f,m,T,r.height,1,0,0,o[3],ut,!1,r.width,ar,null,null);if(w)for(e=0,n=i.length;e<n;++e)s=(o=i[e])[4],r=this.getTextImage(s,S,w,""),f=o[2],m=rt*r.height-lt,this.replayImage_(t,o[0],o[1],r,f,m,T,r.height,1,0,0,o[3],ut,!1,r.width,ar,null,null)}}this.declutterItems.push(this,T,G),++d;break;case Vo.END_GEOMETRY:if(void 0!==o){const t=o(G=e[1]);if(t)return t}++d;break;case Vo.FILL:N?M++:this.fill_(t),++d;break;case Vo.MOVE_TO_LINE_TO:for(L=e[1],p=e[2],k=h[L],x=(Y=h[L+1])+.5|0,(E=k+.5|0)===v&&x===y||(t.moveTo(k,Y),v=E,y=x),L+=2;L<p;L+=2)E=(k=h[L])+.5|0,x=(Y=h[L+1])+.5|0,L!=p-2&&E===v&&x===y||(t.lineTo(k,Y),v=E,y=x);++d;break;case Vo.SET_FILL_STYLE:P=e,this.alignFill_=e[2],M&&(this.fill_(t),M=0,O&&(t.stroke(),O=0)),t.fillStyle=e[1],++d;break;case Vo.SET_STROKE_STYLE:F=e,O&&(t.stroke(),O=0),this.setStrokeStyle_(t,e),++d;break;case Vo.STROKE:N?O++:t.stroke(),++d;break;default:++d}}M&&this.fill_(t),O&&t.stroke()}execute(t,e,i,n,s){this.viewRotation_=i,this.execute_(t,e,n,this.instructions,s,void 0,void 0)}executeHitDetection(t,e,i,n,s,r){return this.viewRotation_=i,this.execute_(t,e,n,this.hitDetectionInstructions,!0,s,r)}};const ua=[ea.POLYGON,ea.CIRCLE,ea.LINE_STRING,ea.IMAGE,ea.TEXT,ea.DEFAULT];const da={0:[[!0]]};function ga(t,e,i){let n;const s=Math.floor(t.length/2);if(e>=s)for(n=s;n<e;n++)t[n][i]=!0;else if(e<s)for(n=e+1;n<s;n++)t[n][i]=!0}var _a=class extends T{constructor(t,e,i,n,s,r){super(),this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=bn(1,1),this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(s)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];void 0===i&&(this.executorsByZIndex_[e]=i={});const n=t[e];for(const t in n){const e=n[t];i[t]=new ca(this.resolution_,this.pixelRatio_,this.overlaps_,e)}}}disposeInternal(){for(const t in this.executorsByZIndex_){const e=this.executorsByZIndex_[t];for(const t in e)e[t].disposeInternal()}const t=this.hitDetectionContext_.canvas;t.width=t.height=0,super.disposeInternal()}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let e=0,n=t.length;e<n;++e)if(t[e]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,s,r,o){const a=2*(n=Math.round(n))+1,h=Wi(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),l=this.hitDetectionContext_;let c;l.canvas.width!==a||l.canvas.height!==a?(l.canvas.width=a,l.canvas.height=a):l.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(Re(c=[1/0,1/0,-1/0,-1/0],t),ue(c,e*(this.renderBuffer_+n),c));const u=function(t){if(void 0!==da[t])return da[t];const e=2*t+1,i=new Array(e);for(let t=0;t<e;t++)i[t]=new Array(e);let n=t,s=0,r=0;for(;n>=s;)ga(i,t+n,t+s),ga(i,t+s,t+n),ga(i,t-s,t+n),ga(i,t-n,t+s),ga(i,t-n,t-s),ga(i,t-s,t-n),ga(i,t+s,t-n),ga(i,t+n,t-s),2*((r+=1+2*++s)-n)+1>0&&(r+=1-2*(n-=1));return da[t]=i,i}(n);let d;function g(t){const e=l.getImageData(0,0,a,a).data;for(let i=0;i<a;i++)for(let n=0;n<a;n++)if(u[i][n]&&e[4*(n*a+i)+3]>0){let e;return(!o||d!=ea.IMAGE&&d!=ea.TEXT||-1!==o.indexOf(t))&&(e=r(t)),e||void l.clearRect(0,0,a,a)}}const _=Object.keys(this.executorsByZIndex_).map(Number);let p,f,m,v,y;for(_.sort(Mt),p=_.length-1;p>=0;--p){const t=_[p].toString();for(m=this.executorsByZIndex_[t],f=ua.length-1;f>=0;--f)if(void 0!==(v=m[d=ua[f]])&&(y=v.executeHitDetection(l,h,i,s,g,c)))return y}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],s=e[2],r=e[3],o=[i,n,i,r,s,r,s,n];return ri(o,0,8,2,t,o),o}isEmpty(){return g(this.executorsByZIndex_)}execute(t,e,i,n,s,r,o){const a=Object.keys(this.executorsByZIndex_).map(Number);a.sort(Mt),this.maxExtent_&&(t.save(),this.clip(t,e));const h=r||ua;let l,c,u,d,g,_;for(l=0,c=a.length;l<c;++l){const r=a[l].toString();for(g=this.executorsByZIndex_[r],u=0,d=h.length;u<d;++u){const a=h[u];if(void 0!==(_=g[a]))if(!o||a!=ea.IMAGE&&a!=ea.TEXT)_.execute(t,e,i,n,s);else{const t=o[r];t?t.push(_,e.slice(0)):o[r]=[_,e.slice(0)]}}}this.maxExtent_&&t.restore()}};const pa=.5,fa={Point:function(t,e,i,n){const s=i.getImage();if(s){if(s.getImageState()!=Or.LOADED)return;const r=t.getBuilder(i.getZIndex(),ea.IMAGE);r.setImageStyle(s,t.addDeclutter(!1)),r.drawPoint(e,n)}const r=i.getText();if(r){const o=t.getBuilder(i.getZIndex(),ea.TEXT);o.setTextStyle(r,t.addDeclutter(!!s)),o.drawText(e,n)}},LineString:function(t,e,i,n){const s=i.getStroke();if(s){const r=t.getBuilder(i.getZIndex(),ea.LINE_STRING);r.setFillStrokeStyle(null,s),r.drawLineString(e,n)}const r=i.getText();if(r){const s=t.getBuilder(i.getZIndex(),ea.TEXT);s.setTextStyle(r,t.addDeclutter(!1)),s.drawText(e,n)}},Polygon:function(t,e,i,n){const s=i.getFill(),r=i.getStroke();if(s||r){const o=t.getBuilder(i.getZIndex(),ea.POLYGON);o.setFillStrokeStyle(s,r),o.drawPolygon(e,n)}const o=i.getText();if(o){const s=t.getBuilder(i.getZIndex(),ea.TEXT);s.setTextStyle(o,t.addDeclutter(!1)),s.drawText(e,n)}},MultiPoint:function(t,e,i,n){const s=i.getImage();if(s){if(s.getImageState()!=Or.LOADED)return;const r=t.getBuilder(i.getZIndex(),ea.IMAGE);r.setImageStyle(s,t.addDeclutter(!1)),r.drawMultiPoint(e,n)}const r=i.getText();if(r){const o=t.getBuilder(i.getZIndex(),ea.TEXT);o.setTextStyle(r,t.addDeclutter(!!s)),o.drawText(e,n)}},MultiLineString:function(t,e,i,n){const s=i.getStroke();if(s){const r=t.getBuilder(i.getZIndex(),ea.LINE_STRING);r.setFillStrokeStyle(null,s),r.drawMultiLineString(e,n)}const r=i.getText();if(r){const s=t.getBuilder(i.getZIndex(),ea.TEXT);s.setTextStyle(r,t.addDeclutter(!1)),s.drawText(e,n)}},MultiPolygon:function(t,e,i,n){const s=i.getFill(),r=i.getStroke();if(r||s){const o=t.getBuilder(i.getZIndex(),ea.POLYGON);o.setFillStrokeStyle(s,r),o.drawMultiPolygon(e,n)}const o=i.getText();if(o){const s=t.getBuilder(i.getZIndex(),ea.TEXT);s.setTextStyle(o,t.addDeclutter(!1)),s.drawText(e,n)}},GeometryCollection:function(t,e,i,n){const s=e.getGeometriesArray();let r,o;for(r=0,o=s.length;r<o;++r){const e=fa[s[r].getType()];e(t,s[r],i,n)}},Circle:function(t,e,i,n){const s=i.getFill(),r=i.getStroke();if(s||r){const o=t.getBuilder(i.getZIndex(),ea.CIRCLE);o.setFillStrokeStyle(s,r),o.drawCircle(e,n)}const o=i.getText();if(o){const s=t.getBuilder(i.getZIndex(),ea.TEXT);s.setTextStyle(o,t.addDeclutter(!1)),s.drawText(e,n)}}};function ma(t,e){return parseInt(r(t),10)-parseInt(r(e),10)}function va(t,e){const i=ya(t,e);return i*i}function ya(t,e){return pa*t/e}function Ea(t,e,i,n,s,r){let o=!1;const a=i.getImage();if(a){let t=a.getImageState();t==Or.LOADED||t==Or.ERROR?a.unlistenImageChange(s,r):(t==Or.IDLE&&a.load(),t=a.getImageState(),a.listenImageChange(s,r),o=!0)}return function(t,e,i,n){const s=i.getGeometryFunction()(e);if(!s)return;const r=s.getSimplifiedGeometry(n);if(i.getRenderer())!function t(e,i,n,s){if(i.getType()==ni.GEOMETRY_COLLECTION){const r=i.getGeometries();for(let i=0,o=r.length;i<o;++i)t(e,r[i],n,s);return}const r=e.getBuilder(n.getZIndex(),ea.DEFAULT);r.drawCustom(i,s,n.getRenderer())}(t,r,i,e);else{const n=fa[r.getType()];n(t,r,i,e)}}(t,e,i,n),o}var xa=class extends Fr{constructor(t){super(t),this.dirty_=!1,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,v(lr,L.CLEAR,this.handleFontsChanged_,this)}disposeInternal(){E(lr,L.CLEAR,this.handleFontsChanged_,this),super.disposeInternal()}renderFrame(t,e){const i=this.context,n=i.canvas,s=this.replayGroup_;if(!s||s.isEmpty())return n.width>0&&(n.width=0),n;const r=t.pixelRatio;Ki(this.pixelTransform_,1/r,0,0,1/r,0,0),zi(this.inversePixelTransform_,this.pixelTransform_);const o=Math.round(t.size[0]*r),a=Math.round(t.size[1]*r);if(n.width!=o||n.height!=a){n.width=o,n.height=a;const t=Bi(this.pixelTransform_);n.style.transform!==t&&(n.style.transform=t)}else i.clearRect(0,0,o,a);this.preRender(i,t);const h=t.extent,l=t.viewState,c=l.projection,u=l.rotation,d=c.getExtent(),g=this.getLayer().getSource(),_=e.extent,p=void 0!==_;p&&this.clip(i,t,_);const f=t.viewHints,m=!(f[Ze.ANIMATING]||f[Ze.INTERACTING]),v=this.getRenderTransform(t,o,a,0),y=e.managed?t.skippedFeatureUids:{},E=this.getLayer().getDeclutter()?{}:null;if(s.execute(i,v,u,y,m,void 0,E),g.getWrapX()&&c.canWrapX()&&!pe(d,h)){let e=h[0];const n=ke(d);let r,l=0;for(;e<d[0];){r=n*--l;const h=this.getRenderTransform(t,o,a,r);s.execute(i,h,u,y,m,void 0,E),e+=n}for(l=0,e=h[2];e>d[2];){r=n*++l;const h=this.getRenderTransform(t,o,a,r);s.execute(i,h,u,y,m,void 0,E),e-=n}}if(E){const e=t.viewHints;!function(t,e,i,n,s){const r=Object.keys(t).map(Number).sort(Mt),o={};for(let a=0,h=r.length;a<h;++a){const h=t[r[a].toString()];let l;for(let t=0,r=h.length;t<r;){const r=h[t++];r!==l&&(l=r,s.push(r.declutterItems));const a=h[t++];r.execute(e,a,i,o,n)}}}(E,i,u,!(e[Ze.ANIMATING]||e[Ze.INTERACTING]),t.declutterItems)}p&&i.restore(),this.postRender(i,t);const x=e.opacity;return x!==parseFloat(n.style.opacity)&&(n.style.opacity=x),n}forEachFeatureAtCoordinate(t,e,i,n,s){if(this.replayGroup_){const o=e.viewState.resolution,a=e.viewState.rotation,h=this.getLayer(),l={};return this.replayGroup_.forEachFeatureAtCoordinate(t,o,a,i,{},function(t){const e=r(t);if(!(e in l))return l[e]=!0,n(t,h)},h.getDeclutter()?s:null)}}handleFontsChanged_(t){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t,e){const i=this.getLayer(),n=i.getSource(),s=t.viewHints[Ze.ANIMATING],r=t.viewHints[Ze.INTERACTING],o=i.getUpdateWhileAnimating(),a=i.getUpdateWhileInteracting();if(!this.dirty_&&!o&&s||!a&&r)return!0;const h=t.extent,l=t.viewState,c=l.projection,u=l.resolution,d=t.pixelRatio,g=i.getRevision(),_=i.getRenderBuffer();let p=i.getRenderOrder();void 0===p&&(p=ma);const f=ue(h,_*u),m=l.projection.getExtent();if(n.getWrapX()&&l.projection.canWrapX()&&!pe(m,t.extent)){const t=ke(m),e=Math.max(ke(f)/2,t);f[0]=m[0]-e,f[2]=m[2]+e}if(!this.dirty_&&this.renderedResolution_==u&&this.renderedRevision_==g&&this.renderedRenderOrder_==p&&pe(this.renderedExtent_,f))return this.replayGroupChanged=!1,!0;this.replayGroup_&&this.replayGroup_.dispose(),this.replayGroup_=null,this.dirty_=!1;const v=new ta(ya(u,d),f,u,d,i.getDeclutter());n.loadFeatures(f,u,c);const y=function(t){let e;const n=t.getStyleFunction()||i.getStyleFunction();if(n&&(e=n(t,u)),e){const i=this.renderFeature(t,u,d,e,v);this.dirty_=this.dirty_||i}}.bind(this);if(p){const t=[];n.forEachFeatureInExtent(f,function(e){t.push(e)}),t.sort(p);for(let e=0,i=t.length;e<i;++e)y(t[e])}else n.forEachFeatureInExtent(f,y);const E=v.finish(),x=new _a(f,u,d,n.getOverlaps(),E,i.getRenderBuffer());return this.renderedResolution_=u,this.renderedRevision_=g,this.renderedRenderOrder_=p,this.renderedExtent_=f,this.replayGroup_=x,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,s){if(!n)return!1;let r=!1;if(Array.isArray(n))for(let o=0,a=n.length;o<a;++o)r=Ea(s,t,n[o],va(e,i),this.handleStyleImageChange_,this)||r;else r=Ea(s,t,n,va(e,i),this.handleStyleImageChange_,this);return r}};var Ta=class extends Ko{constructor(t){super(t)}createRenderer(){return new xa(this)}};class Ca extends D{constructor(t){if(super(),this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,v(this,F(this.geometryName_),this.handleGeometryChanged_,this),t)if("function"==typeof t.getSimplifiedGeometry){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Ca(this.getProperties());t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(x(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=v(t,L.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(t){if("function"==typeof t)return t;{let e;if(Array.isArray(t))e=t;else{jt("function"==typeof t.getZIndex,41);const i=t;e=[i]}return function(){return e}}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){E(this,F(this.geometryName_),this.handleGeometryChanged_,this),this.geometryName_=t,v(this,F(this.geometryName_),this.handleGeometryChanged_,this),this.handleGeometryChanged_()}}var Ra=Ca;const Sa=0,Ia=1,wa={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class La extends I{constructor(t,e,i){super(t),this.features=e,this.mapBrowserEvent=i}}function Ma(t,e){return t.index-e.index}function Oa(t,e,i=1){const n=e.geometry,s=n.getType();if(s===ni.CIRCLE){const i=n;if(e.index===Ia){const e=Je(i.getCenter(),t),n=Math.sqrt(e)-i.getRadius();return n*n}}else if(s===ni.POINT){const e=Je(n.getCoordinates(),t);return Math.sqrt(e)*i}return r=t,o=e.segment,Je(r,je(r,o));var r,o}function Pa(t,e){const i=e.geometry;return i.getType()===ni.CIRCLE&&e.index===Ia?i.getClosestPoint(t):je(t,e.segment)}function Fa(){const t=function(){const t={},e=[255,255,255,1],i=[0,153,255,1];return t[ni.POLYGON]=[new No({fill:new Do({color:[255,255,255,.5]})})],t[ni.MULTI_POLYGON]=t[ni.POLYGON],t[ni.LINE_STRING]=[new No({stroke:new bo({color:e,width:5})}),new No({stroke:new bo({color:i,width:3})})],t[ni.MULTI_LINE_STRING]=t[ni.LINE_STRING],t[ni.CIRCLE]=t[ni.POLYGON].concat(t[ni.LINE_STRING]),t[ni.POINT]=[new No({image:new Po({radius:6,fill:new Do({color:i}),stroke:new bo({color:e,width:1.5})}),zIndex:1/0})],t[ni.MULTI_POINT]=t[ni.POINT],t[ni.GEOMETRY_COLLECTION]=t[ni.POLYGON].concat(t[ni.LINE_STRING],t[ni.POINT]),t}();return function(e,i){return t[ni.POINT]}}var Da=class extends Ts{constructor(t){let e;if(super(t),this.condition_=t.condition?t.condition:Es,this.defaultDeleteCondition_=function(t){return cs(t)&&ps(t)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:gs,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.modified_=!1,this.rBush_=new Co,this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Ta({source:new So({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:Fa(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_},this.source_=null,t.source?(this.source_=t.source,e=new N(this.source_.getFeatures()),v(this.source_,Eo.ADDFEATURE,this.handleSourceAdd_,this),v(this.source_,Eo.REMOVEFEATURE,this.handleSourceRemove_,this)):e=t.features,!e)throw new Error("The modify interaction requires features or a source");this.features_=e,this.features_.forEach(this.addFeature_.bind(this)),v(this.features_,h.ADD,this.handleFeatureAdd_,this),v(this.features_,h.REMOVE,this.handleFeatureRemove_,this),this.lastPointerEvent_=null}addFeature_(t){const e=t.getGeometry();e&&e.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[e.getType()].call(this,t,e);const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),v(t,L.CHANGE,this.handleFeatureChange_,this)}willModifyFeatures_(t){this.modified_||(this.modified_=!0,this.dispatchEvent(new La(wa.MODIFYSTART,this.features_,t)))}removeFeature_(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),E(t,L.CHANGE,this.handleFeatureChange_,this)}removeFeatureSegmentData_(t){const e=this.rBush_,i=[];e.forEach(function(e){t===e.feature&&i.push(e)});for(let t=i.length-1;t>=0;--t){const n=i[t];for(let t=this.dragSegments_.length-1;t>=0;--t)this.dragSegments_[t][0]===n&&this.dragSegments_.splice(t,1);e.remove(n)}}setActive(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(t)}setMap(t){this.overlay_.setMap(t),super.setMap(t)}getOverlay(){return this.overlay_}handleSourceAdd_(t){t.feature&&this.features_.push(t.feature)}handleSourceRemove_(t){t.feature&&this.features_.remove(t.feature)}handleFeatureAdd_(t){this.addFeature_(t.element)}handleFeatureChange_(t){if(!this.changingFeature_){const e=t.target;this.removeFeature_(e),this.addFeature_(e)}}handleFeatureRemove_(t){const e=t.element;this.removeFeature_(e)}writePointGeometry_(t,e){const i=e.getCoordinates(),n={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),n)}writeMultiPointGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const s=i[n],r={feature:t,geometry:e,depth:[n],index:n,segment:[s,s]};this.rBush_.insert(e.getExtent(),r)}}writeLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length-1;n<s;++n){const s=i.slice(n,n+2),r={feature:t,geometry:e,index:n,segment:s};this.rBush_.insert(ce(s),r)}}writeMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const s=i[n];for(let i=0,r=s.length-1;i<r;++i){const r=s.slice(i,i+2),o={feature:t,geometry:e,depth:[n],index:i,segment:r};this.rBush_.insert(ce(r),o)}}}writePolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const s=i[n];for(let i=0,r=s.length-1;i<r;++i){const r=s.slice(i,i+2),o={feature:t,geometry:e,depth:[n],index:i,segment:r};this.rBush_.insert(ce(r),o)}}}writeMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const s=i[n];for(let i=0,r=s.length;i<r;++i){const r=s[i];for(let s=0,o=r.length-1;s<o;++s){const o=r.slice(s,s+2),a={feature:t,geometry:e,depth:[i,n],index:s,segment:o};this.rBush_.insert(ce(o),a)}}}}writeCircleGeometry_(t,e){const i=e.getCenter(),n={feature:t,geometry:e,index:Sa,segment:[i,i]},s={feature:t,geometry:e,index:Ia,segment:[i,i]},r=[n,s];n.featureSegments=s.featureSegments=r,this.rBush_.insert(xe(i),n),this.rBush_.insert(e.getExtent(),s)}writeGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let e=0;e<i.length;++e)this.SEGMENT_WRITERS_[i[e].getType()].call(this,t,i[e])}createOrUpdateVertexFeature_(t){let e=this.vertexFeature_;return e?e.getGeometry().setCoordinates(t):(e=new Ra(new fn(t)),this.vertexFeature_=e,this.overlay_.getSource().addFeature(e)),e}handleEvent(t){if(!t.pointerEvent)return!0;let e;return this.lastPointerEvent_=t,t.map.getView().getInteracting()||t.type!=j.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(e=!(t.type!=j.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==j.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(t)&&!e}handleDragEvent(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t);const e=t.coordinate;for(let t=0,i=this.dragSegments_.length;t<i;++t){const i=this.dragSegments_[t],n=i[0],s=n.depth,r=n.geometry;let o;const a=n.segment,h=i[1];for(;e.length<r.getStride();)e.push(a[h][e.length]);switch(r.getType()){case ni.POINT:o=e,a[0]=a[1]=e;break;case ni.MULTI_POINT:(o=r.getCoordinates())[n.index]=e,a[0]=a[1]=e;break;case ni.LINE_STRING:(o=r.getCoordinates())[n.index+h]=e,a[h]=e;break;case ni.MULTI_LINE_STRING:case ni.POLYGON:(o=r.getCoordinates())[s[0]][n.index+h]=e,a[h]=e;break;case ni.MULTI_POLYGON:(o=r.getCoordinates())[s[1]][s[0]][n.index+h]=e,a[h]=e;break;case ni.CIRCLE:a[0]=a[1]=e,n.index===Sa?(this.changingFeature_=!0,r.setCenter(e),this.changingFeature_=!1):(this.changingFeature_=!0,r.setRadius(Qe(r.getCenter(),e)),this.changingFeature_=!1)}o&&this.setGeometryCoordinates_(r,o)}this.createOrUpdateVertexFeature_(e)}handleDownEvent(t){if(!this.condition_(t))return!1;this.handlePointerAtPixel_(t.pixel,t.map);const e=t.map.getCoordinateFromPixel(t.pixel);this.dragSegments_.length=0,this.modified_=!1;const i=this.vertexFeature_;if(i){const n=[],s=i.getGeometry().getCoordinates(),o=ce([s]),a=this.rBush_.getInExtent(o),h={};a.sort(Ma);for(let i=0,o=a.length;i<o;++i){const o=a[i],l=o.segment;let c=r(o.feature);const u=o.depth;if(u&&(c+="-"+u.join("-")),h[c]||(h[c]=new Array(2)),o.geometry.getType()===ni.CIRCLE&&o.index===Ia)He(Pa(e,o),s)&&!h[c][0]&&(this.dragSegments_.push([o,0]),h[c][0]=o);else if(He(l[0],s)&&!h[c][0])this.dragSegments_.push([o,0]),h[c][0]=o;else if(He(l[1],s)&&!h[c][1]){if((o.geometry.getType()===ni.LINE_STRING||o.geometry.getType()===ni.MULTI_LINE_STRING)&&h[c][0]&&0===h[c][0].index)continue;this.dragSegments_.push([o,1]),h[c][1]=o}else r(l)in this.vertexSegments_&&!h[c][0]&&!h[c][1]&&this.insertVertexCondition_(t)&&n.push([o,s])}n.length&&this.willModifyFeatures_(t);for(let t=n.length-1;t>=0;--t)this.insertVertex_.apply(this,n[t])}return!!this.vertexFeature_}handleUpEvent(t){for(let t=this.dragSegments_.length-1;t>=0;--t){const e=this.dragSegments_[t][0],i=e.geometry;if(i.getType()===ni.CIRCLE){const t=i.getCenter(),n=e.featureSegments[0],s=e.featureSegments[1];n.segment[0]=n.segment[1]=t,s.segment[0]=s.segment[1]=t,this.rBush_.update(xe(t),n),this.rBush_.update(i.getExtent(),s)}else this.rBush_.update(ce(e.segment),e)}return this.modified_&&(this.dispatchEvent(new La(wa.MODIFYEND,this.features_,t)),this.modified_=!1),!1}handlePointerMove_(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map)}handlePointerAtPixel_(t,e){const i=e.getCoordinateFromPixel(t),n=this.pixelTolerance_,s=function(t,e){return Oa(i,t,n)-Oa(i,e,n)},o=ue(xe(i),e.getView().getResolution()*this.pixelTolerance_),a=this.rBush_.getInExtent(o);if(a.length>0){a.sort(s);const n=a[0],o=n.segment;let h=Pa(i,n);const l=e.getPixelFromCoordinate(h);let c=Qe(t,l);if(c<=this.pixelTolerance_){const t={};if(n.geometry.getType()===ni.CIRCLE&&n.index===Ia)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(h);else{const i=e.getPixelFromCoordinate(o[0]),n=e.getPixelFromCoordinate(o[1]),s=Je(l,i),u=Je(l,n);c=Math.sqrt(Math.min(s,u)),this.snappedToVertex_=c<=this.pixelTolerance_,this.snappedToVertex_&&(h=s>u?o[1]:o[0]),this.createOrUpdateVertexFeature_(h);for(let e=1,i=a.length;e<i;++e){const i=a[e].segment;if(!(He(o[0],i[0])&&He(o[1],i[1])||He(o[0],i[1])&&He(o[1],i[0])))break;t[r(i)]=!0}}return t[r(o)]=!0,void(this.vertexSegments_=t)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(t,e){const i=t.segment,n=t.feature,s=t.geometry,r=t.depth,o=t.index;let a;for(;e.length<s.getStride();)e.push(0);switch(s.getType()){case ni.MULTI_LINE_STRING:case ni.POLYGON:(a=s.getCoordinates())[r[0]].splice(o+1,0,e);break;case ni.MULTI_POLYGON:(a=s.getCoordinates())[r[1]][r[0]].splice(o+1,0,e);break;case ni.LINE_STRING:(a=s.getCoordinates()).splice(o+1,0,e);break;default:return}this.setGeometryCoordinates_(s,a);const h=this.rBush_;h.remove(t),this.updateSegmentIndices_(s,o,r,1);const l={segment:[i[0],e],feature:n,geometry:s,depth:r,index:o};h.insert(ce(l.segment),l),this.dragSegments_.push([l,1]);const c={segment:[e,i[1]],feature:n,geometry:s,depth:r,index:o+1};h.insert(ce(c.segment),c),this.dragSegments_.push([c,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=j.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t);const e=this.removeVertex_();return this.dispatchEvent(new La(wa.MODIFYEND,this.features_,t)),this.modified_=!1,e}return!1}removeVertex_(){const t=this.dragSegments_,e={};let i,n,s,o,a,h,l,c,u,d,g,_=!1;for(a=t.length-1;a>=0;--a)g=r((d=(s=t[a])[0]).feature),d.depth&&(g+="-"+d.depth.join("-")),g in e||(e[g]={}),0===s[1]?(e[g].right=d,e[g].index=d.index):1==s[1]&&(e[g].left=d,e[g].index=d.index+1);for(g in e){switch(u=e[g].right,l=e[g].left,(c=(h=e[g].index)-1)<0&&(c=0),i=n=(o=(d=void 0!==l?l:u).geometry).getCoordinates(),_=!1,o.getType()){case ni.MULTI_LINE_STRING:n[d.depth[0]].length>2&&(n[d.depth[0]].splice(h,1),_=!0);break;case ni.LINE_STRING:n.length>2&&(n.splice(h,1),_=!0);break;case ni.MULTI_POLYGON:i=i[d.depth[1]];case ni.POLYGON:(i=i[d.depth[0]]).length>4&&(h==i.length-1&&(h=0),i.splice(h,1),_=!0,0===h&&(i.pop(),i.push(i[0]),c=i.length-1))}if(_){this.setGeometryCoordinates_(o,n);const e=[];if(void 0!==l&&(this.rBush_.remove(l),e.push(l.segment[0])),void 0!==u&&(this.rBush_.remove(u),e.push(u.segment[1])),void 0!==l&&void 0!==u){const t={depth:d.depth,feature:d.feature,geometry:d.geometry,index:c,segment:e};this.rBush_.insert(ce(t.segment),t)}this.updateSegmentIndices_(o,h,d.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return _}setGeometryCoordinates_(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1}updateSegmentIndices_(t,e,i,n){this.rBush_.forEachInExtent(t.getExtent(),function(s){s.geometry===t&&(void 0===i||void 0===s.depth||Dt(s.depth,i))&&s.index>e&&(s.index+=n)})}};function Aa(t,e,i,n,s,r){let o=NaN,a=NaN;const h=(i-e)/n;if(1===h)o=t[e],a=t[e+1];else if(2==h)o=(1-s)*t[e]+s*t[e+n],a=(1-s)*t[e+1]+s*t[e+n+1];else if(0!==h){let r=t[e],h=t[e+1],l=0;const c=[0];for(let s=e+n;s<i;s+=n){const e=t[s],i=t[s+1];l+=Math.sqrt((e-r)*(e-r)+(i-h)*(i-h)),c.push(l),r=e,h=i}const u=s*l,d=function(t,e,i){let n,s;const r=i||Mt;let o=0,a=t.length,h=!1;for(;o<a;)(s=+r(t[n=o+(a-o>>1)],e))<0?o=n+1:(a=n,h=!s);return h?o:~o}(c,u);if(d<0){const i=(u-c[-d-2])/(c[-d-1]-c[-d-2]),s=e+(-d-2)*n;o=oe(t[s],t[s+n],i),a=oe(t[s+1],t[s+n+1],i)}else o=t[e+d*n],a=t[e+d*n+1]}return r?(r[0]=o,r[1]=a,r):[o,a]}function ba(t,e,i,n,s,r){if(i==e)return null;let o;if(s<t[e+n-1])return r?((o=t.slice(e,e+n))[n-1]=s,o):null;if(t[i-1]<s)return r?((o=t.slice(i-n,i))[n-1]=s,o):null;if(s==t[e+n-1])return t.slice(e,e+n);let a=e/n,h=i/n;for(;a<h;){const e=a+h>>1;s<t[(e+1)*n-1]?h=e:a=e+1}const l=t[a*n-1];if(s==l)return t.slice((a-1)*n,(a-1)*n+n);const c=(s-l)/(t[(a+1)*n-1]-l);o=[];for(let e=0;e<n-1;++e)o.push(oe(t[(a-1)*n+e],t[a*n+e],c));return o.push(s),o}class Na extends Hi{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}appendCoordinate(t){this.flatCoordinates?Ft(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){return new Na(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<ge(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($i(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),en(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))}forEachSegment(t){return xn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){if(this.layout!=si.XYM&&this.layout!=si.XYZM)return null;const i=void 0!==e&&e;return ba(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i)}getCoordinates(){return on(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Aa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e)}getLength(){return ia(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=ln(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Na(e,si.XY)}getType(){return ni.LINE_STRING}intersectsExtent(t){return Tn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=sn(this.flatCoordinates,0,t,this.stride),this.changed()}}var Ga=Na;let ka=new So;const Ya=new Ta({source:ka});let Xa=new Rr({target:"map",layers:[new br({source:new fo}),Ya],view:new An({center:[0,0],zoom:2})}),Ka=new Da({source:ka});Xa.addInteraction(Ka);const Ua=[0,0],Wa=[1e6,0];ka.addFeature(new Ra({geometry:new Ga([Ua,Wa])})),ka.addFeature(new Ra({geometry:new fn([(Ua[0]+Wa[0])/2,(Ua[1]+Wa[1])/2]),id:1})),ka.addFeature(new Ra({geometry:new fn([Ua[0]+.3*(Wa[0]-Ua[0]),Ua[1]+.3*(Wa[1]-Ua[1])]),id:2})),ka.addFeature(new Ra({geometry:new fn([Ua[0]+.7*(Wa[0]-Ua[0]),Ua[1]+.7*(Wa[1]-Ua[1])]),id:3}))},9:function(t,e,i){t.exports=function(){"use strict";function t(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function e(t,e){return t<e?-1:t>e?1:0}return function(i,n,s,r,o){!function e(i,n,s,r,o){for(;r>s;){if(r-s>600){var a=r-s+1,h=n-s+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(h-a/2<0?-1:1),d=Math.max(s,Math.floor(n-h*c/a+u)),g=Math.min(r,Math.floor(n+(a-h)*c/a+u));e(i,n,d,g,o)}var _=i[n],p=s,f=r;for(t(i,s,n),o(i[r],_)>0&&t(i,s,r);p<f;){for(t(i,p,f),p++,f--;o(i[p],_)<0;)p++;for(;o(i[f],_)>0;)f--}0===o(i[s],_)?t(i,s,f):t(i,++f,r),f<=n&&(s=f+1),n<=f&&(r=f-1)}}(i,n,s||0,r||i.length-1,o||e)}}()}});